<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Shared Storage API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 859efb4bd, updated Fri Jan 27 16:04:01 2023 -0800" name="generator">
  <link href="https://github.com/WICG/shared-storage" rel="canonical">
  <meta content="b1ca1cacf9b9908d7e6a79cbf18787ff9f1e5e2a" name="document-revision">
<style>
/* .XXX from https://resources.whatwg.org/standard.css */
.XXX {
  color: #D50606;
  background: white;
  border: solid #D50606;
}
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Shared Storage API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2023-02-06">6 February 2023</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://github.com/WICG/shared-storage">https://github.com/WICG/shared-storage</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/shared-storage/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:cammie@chromium.org">Camillia Smith Barnes</a> (<a class="p-org org" href="https://google.com">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 the Contributors to the Shared Storage API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Shared Storage is a storage API that is intentionally not partitioned by top-frame site (though still partitioned by context origin of course!). To limit cross-site reidentification of users, data in Shared Storage may only be read in a restricted environment that has carefully constructed output gates.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#worklet"><span class="secno">2</span> <span class="content">The <code class="idl"><span>SharedStorageWorklet</span></code> Interface</span></a>
     <ol class="toc">
      <li><a href="#register-worklet"><span class="secno">2.1</span> <span class="content">Registering a Worklet</span></a>
     </ol>
    <li>
     <a href="#shared-storage"><span class="secno">3</span> <span class="content">The <code class="idl"><span>SharedStorage</span></code> Interface</span></a>
     <ol class="toc">
      <li><a href="#run-op"><span class="secno">3.1</span> <span class="content">Run Operation Methods</span></a>
      <li><a href="#setter"><span class="secno">3.2</span> <span class="content">Setter/Deleter Methods</span></a>
      <li><a href="#getter"><span class="secno">3.3</span> <span class="content">Getter Methods</span></a>
      <li><a href="#iterator"><span class="secno">3.4</span> <span class="content"><code class="idl"><span>SharedStorageIterator</span></code> Interface Methods</span></a>
     </ol>
    <li><a href="#privacy"><span class="secno">4</span> <span class="content">Privacy Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <em>This section is not normative.</em> 
   <p>In order to prevent cross-site user tracking, browsers are partitioning all forms of storage by top-frame site. But, there are many legitimate use cases currently relying on unpartitioned storage.</p>
   <p>This document introduces a new storage API that is intentionally not partitioned by top-frame site (though still partitioned by context origin), in order to serve a number of the use cases needing unpartitioned storage. To limit cross-site reidentification of users, data in Shared Storage may only be read in a restricted environment that has carefully constructed output gates. Over time, we hope to design and add additional gates.</p>
   <div class="example" id="example-a8c448c3">
    <a class="self-link" href="#example-a8c448c3"></a> <code>a.example</code> randomly assigns users to groups in a way that is consistent cross-site. 
    <p>Inside an <code>a.example</code> iframe:</p>
<pre class="lang-js highlight"><c- a>function</c-> generateSeed<c- p>()</c-> <c- p>{</c-> … <c- p>}</c->
<c- k>await</c-> window<c- p>.</c->sharedStorage<c- p>.</c->worklet<c- p>.</c->addModule<c- p>(</c-><c- t>'experiment.js'</c-><c- p>);</c->

<c- c1>// Only write a cross-site seed to a.example’s storage if there isn’t one yet.</c->
window<c- p>.</c->sharedStorage<c- p>.</c->set<c- p>(</c-><c- t>'seed'</c-><c- p>,</c-> generateSeed<c- p>(),</c-> <c- p>{</c-> ignoreIfPresent<c- o>:</c-> <c- kc>true</c-> <c- p>});</c->

<c- c1>// opaqueURL will be of the form urn:uuid and will be created by privileged code to</c->
<c- c1>// avoid leaking the chosen input URL back to the document.</c->

<c- a>const</c-> opaqueURL <c- o>=</c-> <c- k>await</c-> window<c- p>.</c->sharedStorage<c- p>.</c->selectURL<c- p>(</c->
  <c- t>'select-url-for-experiment'</c-><c- p>,</c->
  <c- p>[</c->
    <c- p>{</c->url<c- o>:</c-> <c- u>"blob:https://a.example/123…"</c-><c- p>,</c-> reportingMetadata<c- o>:</c-> <c- p>{</c-><c- u>"click"</c-><c- o>:</c-> <c- u>"https://report.example/1..."</c-><c- p>}},</c->
    <c- p>{</c->url<c- o>:</c-> <c- u>"blob:https://b.example/abc…"</c-><c- p>,</c-> reportingMetadata<c- o>:</c-> <c- p>{</c-><c- u>"click"</c-><c- o>:</c-> <c- u>"https://report.example/a..."</c-><c- p>}},</c->
    <c- p>{</c->url<c- o>:</c-> <c- u>"blob:https://c.example/789…"</c-><c- p>}</c->
  <c- p>],</c->
  <c- p>{</c-> data<c- o>:</c-> <c- p>{</c-> name<c- o>:</c-> <c- t>'experimentA'</c-> <c- p>}</c-> <c- p>}</c->
<c- p>);</c->

document<c- p>.</c->getElementById<c- p>(</c-><c- t>'my-fenced-frame'</c-><c- p>).</c->src <c- o>=</c-> opaqueURL<c- p>;</c->
</pre>
    <p>inside the <code>experiment.js</code> worklet script:</p>
<pre class="lang-js highlight"><c- a>class</c-> SelectURLOperation <c- p>{</c->
  hash<c- p>(</c->experimentName<c- p>,</c-> seed<c- p>)</c-> <c- p>{</c-> … <c- p>}</c->

  <c- k>async</c-> run<c- p>(</c->data<c- p>,</c-> urls<c- p>)</c-> <c- p>{</c->
    <c- a>const</c-> seed <c- o>=</c-> <c- k>await</c-> <c- k>this</c-><c- p>.</c->sharedStorage<c- p>.</c->get<c- p>(</c-><c- t>'seed'</c-><c- p>);</c->
    <c- k>return</c-> hash<c- p>(</c->data<c- p>.</c->name<c- p>,</c-> seed<c- p>)</c-> <c- o>%</c-> urls<c- p>.</c->length<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
register<c- p>(</c-><c- t>'select-url-for-experiment'</c-><c- p>,</c-> SelectURLOperation<c- p>);</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="2" id="worklet"><span class="secno">2. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet">SharedStorageWorklet</a></code> Interface</span><a class="self-link" href="#worklet"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageworklet"><code><c- g>SharedStorageWorklet</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet"><c- n>Worklet</c-></a> {
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet①">SharedStorageWorklet</a></code> object allows developers to supply scripts to process Shared Storage data on a separate thread and then output the result through one or more of the output gates. Currently there are two output gates, the private aggregation output gate and the URL selection output gate.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet②">SharedStorageWorklet</a></code>'s worklet global scope type is <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope">SharedStorageWorkletGlobalScope</a></code>. The scripts should define and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-identity/#dom-rtcidentityproviderregistrar-register" id="ref-for-dom-rtcidentityproviderregistrar-register">register</a></code> one or more <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation">SharedStorageOperation</a></code>s.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global" id="ref-for-Global"><c- g>Global</c-></a>=<a data-link-type="idl-name" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet③"><c- n>SharedStorageWorklet</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageworkletglobalscope"><code><c- g>SharedStorageWorkletGlobalScope</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sharedstorageworkletglobalscope-register" id="ref-for-dom-sharedstorageworkletglobalscope-register"><c- g>register</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageWorkletGlobalScope/register(name, operationCtor)" data-dfn-type="argument" data-export id="dom-sharedstorageworkletglobalscope-register-name-operationctor-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-sharedstorageworkletglobalscope-register-name-operationctor-name"></a></dfn>,
                     <a data-link-type="idl-name" href="#callbackdef-sharedstorageoperationconstructor" id="ref-for-callbackdef-sharedstorageoperationconstructor"><c- n>SharedStorageOperationConstructor</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageWorkletGlobalScope/register(name, operationCtor)" data-dfn-type="argument" data-export id="dom-sharedstorageworkletglobalscope-register-name-operationctor-operationctor"><code><c- g>operationCtor</c-></code><a class="self-link" href="#dom-sharedstorageworkletglobalscope-register-name-operationctor-operationctor"></a></dfn>);
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-sharedstorageoperationconstructor"><code><c- g>SharedStorageOperationConstructor</c-></code></dfn> = <a data-link-type="idl-name" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation①"><c- n>SharedStorageOperation</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageOperationConstructor" data-dfn-type="argument" data-export id="dom-sharedstorageoperationconstructor-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-sharedstorageoperationconstructor-options"></a></dfn>);

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageoperation"><code><c- g>SharedStorageOperation</c-></code></dfn> {
};
</pre>
   <p>Currently each <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation②">SharedStorageOperation</a></code> registered via <code class="idl"><a data-link-type="idl" href="#dom-sharedstorageworkletglobalscope-register" id="ref-for-dom-sharedstorageworkletglobalscope-register①">register()</a></code> must be one of the following two types:</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="#sharedstoragerunoperation" id="ref-for-sharedstoragerunoperation">SharedStorageRunOperation</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="#sharedstorageselecturloperation" id="ref-for-sharedstorageselecturloperation">SharedStorageSelectURLOperation</a></code></p>
   </ul>
   <p>A <code class="idl"><a data-link-type="idl" href="#sharedstoragerunoperation" id="ref-for-sharedstoragerunoperation①">SharedStorageRunOperation</a></code> is an <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation③">SharedStorageOperation</a></code> that has no JavaScript return value, and hence is especially suited for calling into the private aggregation service.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#sharedstorageselecturloperation" id="ref-for-sharedstorageselecturloperation①">SharedStorageSelectURLOperation</a></code> is an <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation④">SharedStorageOperation</a></code> that takes in a list of <code class="idl"><a data-link-type="idl" href="#dictdef-sharedstorageurlwithmetadata" id="ref-for-dictdef-sharedstorageurlwithmetadata">SharedStorageUrlWithMetadata</a></code> dictionaries (i.e. URLs each wrapped with metadata) and returns a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long">long</a></code> integer index specifying which of these URLs should be selected.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstoragerunoperation"><code><c- g>SharedStorageRunOperation</c-></code></dfn> : <a data-link-type="idl-name" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation⑤"><c- n>SharedStorageOperation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorageRunOperation" data-dfn-type="method" data-export data-lt="run(data)" id="dom-sharedstoragerunoperation-run"><code><c- g>run</c-></code><a class="self-link" href="#dom-sharedstoragerunoperation-run"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object①"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageRunOperation/run(data)" data-dfn-type="argument" data-export id="dom-sharedstoragerunoperation-run-data-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-sharedstoragerunoperation-run-data-data"></a></dfn>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed④"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageselecturloperation"><code><c- g>SharedStorageSelectURLOperation</c-></code></dfn> : <a data-link-type="idl-name" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation⑥"><c- n>SharedStorageOperation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long①"><c- b>long</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorageSelectURLOperation" data-dfn-type="method" data-export data-lt="run(data, urls)" id="dom-sharedstorageselecturloperation-run"><code><c- g>run</c-></code><a class="self-link" href="#dom-sharedstorageselecturloperation-run"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object②"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageSelectURLOperation/run(data, urls)" data-dfn-type="argument" data-export id="dom-sharedstorageselecturloperation-run-data-urls-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-sharedstorageselecturloperation-run-data-urls-data"></a></dfn>,
                    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array" id="ref-for-idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-sharedstorageurlwithmetadata" id="ref-for-dictdef-sharedstorageurlwithmetadata①"><c- n>SharedStorageUrlWithMetadata</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorageSelectURLOperation/run(data, urls)" data-dfn-type="argument" data-export id="dom-sharedstorageselecturloperation-run-data-urls-urls"><code><c- g>urls</c-></code><a class="self-link" href="#dom-sharedstorageselecturloperation-run-data-urls-urls"></a></dfn>);
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sharedstorageurlwithmetadata"><code><c- g>SharedStorageUrlWithMetadata</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageUrlWithMetadata" data-dfn-type="dict-member" data-export data-type="USVString " id="dom-sharedstorageurlwithmetadata-url"><code><c- g>url</c-></code><a class="self-link" href="#dom-sharedstorageurlwithmetadata-url"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object③"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageUrlWithMetadata" data-dfn-type="dict-member" data-export data-type="object " id="dom-sharedstorageurlwithmetadata-reportingmetadata"><code><c- g>reportingMetadata</c-></code><a class="self-link" href="#dom-sharedstorageurlwithmetadata-reportingmetadata"></a></dfn>;
};
</pre>
   <h3 class="heading settled" data-level="2.1" id="register-worklet"><span class="secno">2.1. </span><span class="content">Registering a Worklet</span><a class="self-link" href="#register-worklet"></a></h3>
   <p>We define a <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope①">SharedStorageWorkletGlobalScope</a></code>'s internal <dfn class="dfn-paneled" data-dfn-for="SharedStorageWorkletGlobalScope" data-dfn-type="dfn" data-noexport id="sharedstorageworkletglobalscope-operation-map">operation map</dfn> as an <a data-link-type="dfn" href="https://infra.spec.whatwg.org#ordered-map" id="ref-for-ordered-map">ordered map</a> of operation name strings to class contructors.</p>
   <div class="algorithm" data-algorithm="register(name, operationCtor)" data-algorithm-for="SharedStorageWorkletGlobalScope">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorageWorkletGlobalScope" data-dfn-type="method" data-export id="dom-sharedstorageworkletglobalscope-register"><code>register(<var>name</var>, <var>operationCtor</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>If <var>name</var> is missing or empty, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>operationMap</var> be this <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope②">SharedStorageWorkletGlobalScope</a></code>'s <a data-link-type="dfn" href="#sharedstorageworkletglobalscope-operation-map" id="ref-for-sharedstorageworkletglobalscope-operation-map">operation map</a>.</p>
     <li data-md>
      <p>If <var>name</var> already exists as a key in <var>operationMap</var>, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
     <li data-md>
      <p>If <var>operationCtor</var> is missing or not a constructor, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>prototype</var> be <var>operationCtor</var>’s class prototype.</p>
     <li data-md>
      <p>If <var>prototype</var> is not an object, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>run</var> be <var>prototype</var>’s "run" method.</p>
     <li data-md>
      <p>If <var>run</var> is missing or not a function, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror④">TypeError</a></code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-set" id="ref-for-map-set">Set</a> the value of <var>name</var> to <var>run</var> in <var>operationMap</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="3" id="shared-storage"><span class="secno">3. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#sharedstorage" id="ref-for-sharedstorage">SharedStorage</a></code> Interface</span><a class="self-link" href="#shared-storage"></a></h2>
    The <code class="idl"><a data-link-type="idl" href="#sharedstorage" id="ref-for-sharedstorage①">SharedStorage</a></code> interface is exposed to both the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code> and the <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet④">SharedStorageWorklet</a></code>, with some of its methods only exposed to one or the other. 
   <p>Methods that allow the setting and/or deleting of data are exposed to both the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①">Window</a></code> and the <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑤">SharedStorageWorklet</a></code>. This makes it possible to modify the data in Shared Storage from multiple contexts.</p>
   <p>Meanwhile, methods for running <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation⑦">SharedStorageOperation</a></code>s, along with the <code class="idl"><a data-link-type="idl" href="#dom-sharedstorage-worklet" id="ref-for-dom-sharedstorage-worklet">worklet</a></code> attribute which is used to call <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule">addModule()</a></code>, are exposed to the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window②">Window</a></code> only, as these are the means by which the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window③">Window</a></code> interacts with the <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑥">SharedStorageWorklet</a></code>.</p>
   <p>In order to carefully control the flow of data read from Shared Storage, methods for getting data from the database backend are exposed to the <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑦">SharedStorageWorklet</a></code> only.</p>
   <p>Because bits of entropy can leak via <code class="idl"><a data-link-type="idl" href="#dom-sharedstorage-selecturl" id="ref-for-dom-sharedstorage-selecturl">selectURL()</a></code> if a user activates the fenced frame that navigates to the resulting opaque URL, we impose on each origin a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bit-budget">bit budget</dfn>, i.e. a maximum allowance of entropy bits that are permitted to leak during a given <a data-link-type="dfn" href="#epoch" id="ref-for-epoch">epoch</a>, where we define an <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="epoch">epoch</dfn> as a time period whose duration is a fixed pretermined length. When a leak occurs, its value in entropy bits is calculated and stored as a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bit-debit">bit debit</dfn> with a timestamp, and only <a data-link-type="dfn" href="#bit-debit" id="ref-for-bit-debit">bit debit</a>s whose timestamps are within the current <a data-link-type="dfn" href="#epoch" id="ref-for-epoch①">epoch</a> are used to determine an origin’s remaining budget. When an origin has insufficient remaining budget, <code class="idl"><a data-link-type="idl" href="#dom-sharedstorage-selecturl" id="ref-for-dom-sharedstorage-selecturl①">selectURL()</a></code> will return its default value.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑤"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorage"><code><c- g>SharedStorage</c-></code></dfn> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑥"><c- g>Exposed</c-></a>=(<c- n>Window</c->)] 
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-run" id="ref-for-dom-sharedstorage-run"><c- g>run</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/run(name, options), SharedStorage/run(name)" data-dfn-type="argument" data-export id="dom-sharedstorage-run-name-options-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-sharedstorage-run-name-options-name"></a></dfn>,
                   <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragerunoperationmethodoptions" id="ref-for-dictdef-sharedstoragerunoperationmethodoptions"><c- n>SharedStorageRunOperationMethodOptions</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/run(name, options), SharedStorage/run(name)" data-dfn-type="argument" data-export id="dom-sharedstorage-run-name-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-sharedstorage-run-name-options-options"></a></dfn> = {});

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑦"><c- g>Exposed</c-></a>=(<c- n>Window</c->)] 
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise③"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-selecturl" id="ref-for-dom-sharedstorage-selecturl②"><c- g>selectURL</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/selectURL(name, urls, options), SharedStorage/selectURL(name, urls)" data-dfn-type="argument" data-export id="dom-sharedstorage-selecturl-name-urls-options-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-sharedstorage-selecturl-name-urls-options-name"></a></dfn>,
                               <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array" id="ref-for-idl-frozen-array①"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-sharedstorageurlwithmetadata" id="ref-for-dictdef-sharedstorageurlwithmetadata②"><c- n>SharedStorageUrlWithMetadata</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorage/selectURL(name, urls, options), SharedStorage/selectURL(name, urls)" data-dfn-type="argument" data-export id="dom-sharedstorage-selecturl-name-urls-options-urls"><code><c- g>urls</c-></code><a class="self-link" href="#dom-sharedstorage-selecturl-name-urls-options-urls"></a></dfn>,
                               <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragerunoperationmethodoptions" id="ref-for-dictdef-sharedstoragerunoperationmethodoptions①"><c- n>SharedStorageRunOperationMethodOptions</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/selectURL(name, urls, options), SharedStorage/selectURL(name, urls)" data-dfn-type="argument" data-export id="dom-sharedstorage-selecturl-name-urls-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-sharedstorage-selecturl-name-urls-options-options"></a></dfn> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise④"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-set" id="ref-for-dom-sharedstorage-set"><c- g>set</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/set(key, value, options), SharedStorage/set(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-set-key-value-options-key"><code><c- g>key</c-></code><a class="self-link" href="#dom-sharedstorage-set-key-value-options-key"></a></dfn>,
                   <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/set(key, value, options), SharedStorage/set(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-set-key-value-options-value"><code><c- g>value</c-></code><a class="self-link" href="#dom-sharedstorage-set-key-value-options-value"></a></dfn>,
                   <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragesetmethodoptions" id="ref-for-dictdef-sharedstoragesetmethodoptions"><c- n>SharedStorageSetMethodOptions</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/set(key, value, options), SharedStorage/set(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-set-key-value-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-sharedstorage-set-key-value-options-options"></a></dfn> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑤"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-append" id="ref-for-dom-sharedstorage-append"><c- g>append</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑤"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/append(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-append-key-value-key"><code><c- g>key</c-></code><a class="self-link" href="#dom-sharedstorage-append-key-value-key"></a></dfn>,
                      <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑥"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/append(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-append-key-value-value"><code><c- g>value</c-></code><a class="self-link" href="#dom-sharedstorage-append-key-value-value"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑥"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any③"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-delete" id="ref-for-dom-sharedstorage-delete"><c- g>delete</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑦"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/delete(key)" data-dfn-type="argument" data-export id="dom-sharedstorage-delete-key-key"><code><c- g>key</c-></code><a class="self-link" href="#dom-sharedstorage-delete-key-key"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑦"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any④"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-clear" id="ref-for-dom-sharedstorage-clear"><c- g>clear</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑧"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑧"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑧"><c- b>DOMString</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-get" id="ref-for-dom-sharedstorage-get"><c- g>get</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑨"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/get(key)" data-dfn-type="argument" data-export id="dom-sharedstorage-get-key-key"><code><c- g>key</c-></code><a class="self-link" href="#dom-sharedstorage-get-key-key"></a></dfn>);

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑨"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑨"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-length" id="ref-for-dom-sharedstorage-length"><c- g>length</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①⓪"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①⓪"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-remainingbudget" id="ref-for-dom-sharedstorage-remainingbudget"><c- g>remainingBudget</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①①"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a data-link-type="idl-name" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator"><c- n>SharedStorageIterator</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-keys" id="ref-for-dom-sharedstorage-keys"><c- g>keys</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①②"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a data-link-type="idl-name" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator①"><c- n>SharedStorageIterator</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-entries" id="ref-for-dom-sharedstorage-entries"><c- g>entries</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①③"><c- g>Exposed</c-></a>=(<c- n>Window</c->)] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑧"><c- n>SharedStorageWorklet</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="attribute" data-export data-readonly data-type="SharedStorageWorklet" id="dom-sharedstorage-worklet"><code><c- g>worklet</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sharedstoragesetmethodoptions"><code><c- g>SharedStorageSetMethodOptions</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageSetMethodOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-sharedstoragesetmethodoptions-ignoreifpresent"><code><c- g>ignoreIfPresent</c-></code><a class="self-link" href="#dom-sharedstoragesetmethodoptions-ignoreifpresent"></a></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sharedstoragerunoperationmethodoptions"><code><c- g>SharedStorageRunOperationMethodOptions</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object④"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageRunOperationMethodOptions" data-dfn-type="dict-member" data-export data-type="object " id="dom-sharedstoragerunoperationmethodoptions-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-sharedstoragerunoperationmethodoptions-data"></a></dfn>;
};

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-iteratormode"><code><c- g>IteratorMode</c-></code></dfn> { <dfn class="dfn-paneled idl-code" data-dfn-for="IteratorMode" data-dfn-type="enum-value" data-export id="dom-iteratormode-key"><code><c- s>"key"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="IteratorMode" data-dfn-type="enum-value" data-export id="dom-iteratormode-keyvalue"><code><c- s>"keyValue"</c-></code></dfn> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①④"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageiterator"><code><c- g>SharedStorageIterator</c-></code></dfn> {
  <dfn class="idl-code" data-dfn-for="SharedStorageIterator" data-dfn-type="constructor" data-export data-lt="SharedStorageIterator(mode)|constructor(mode)" id="dom-sharedstorageiterator-sharedstorageiterator"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-sharedstorageiterator-sharedstorageiterator"></a></dfn>(<a data-link-type="idl-name" href="#enumdef-iteratormode" id="ref-for-enumdef-iteratormode"><c- n>IteratorMode</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageIterator/SharedStorageIterator(mode), SharedStorageIterator/constructor(mode)" data-dfn-type="argument" data-export id="dom-sharedstorageiterator-sharedstorageiterator-mode-mode"><code><c- g>mode</c-></code><a class="self-link" href="#dom-sharedstorageiterator-sharedstorageiterator-mode-mode"></a></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object⑤"><c- b>object</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorageiterator-next" id="ref-for-dom-sharedstorageiterator-next"><c- g>next</c-></a>();
};
</pre>
   <h3 class="heading settled" data-level="3.1" id="run-op"><span class="secno">3.1. </span><span class="content">Run Operation Methods</span><a class="self-link" href="#run-op"></a></h3>
   <div class="algorithm" data-algorithm="run(name, options)" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export data-lt="run(name, options)|run(name)" id="dom-sharedstorage-run"><code>run(<var>name</var>, <var>options</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule①">addModule()</a></code> has not yet been called, reject <var>promise</var>.</p>
       <li data-md>
        <p>Let <var>outsideSettings</var> be worklet’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>.</p>
       <li data-md>
        <p>Let <var>agent</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#obtain-a-worklet-agent" id="ref-for-obtain-a-worklet-agent">obtaining a worklet agent</a> given <var>outsideSettings</var>. Run the rest of these steps in <var>agent</var>.</p>
       <li data-md>
        <p>If module script has been loaded for this worklet:</p>
        <ol>
         <li data-md>
          <p>Let <var>operationMap</var> be this <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope③">SharedStorageWorkletGlobalScope</a></code>'s operation map.</p>
         <li data-md>
          <p>Let <var>operation</var> be the operation registered to <var>name</var> in <var>operationMap</var>, if <var>operation</var> exists.</p>
         <li data-md>
          <p>If <var>operation</var> exists:</p>
          <ol>
           <li data-md>
            <p>If <var>options</var> contains <var>data</var>, invoke <var>operation</var> with argument <var>data</var>.</p>
           <li data-md>
            <p>Otherwise, invoke <var>operation</var> with an empty argument list.</p>
          </ol>
        </ol>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="selectURL(name, urls, options)" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export data-lt="selectURL(name, urls, options)|selectURL(name, urls)" id="dom-sharedstorage-selecturl"><code>selectURL(<var>name</var>, <var>urls</var>, <var>options</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>configPromise</var> be a new promise.</p>
     <li data-md>
      <p>If <var>urls</var> is empty or exceeds the maximum allowed length, reject <var>configPromise</var>.</p>
     <li data-md>
      <p>Let <var>urlList</var> be an empty <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/input.html#dom-input-list" id="ref-for-dom-input-list">list</a></code>.</p>
     <li data-md>
      <p>For each <var>urlWithMetadata</var> in <var>urls</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>urlWithMetadata</var> has no field "<var>url</var>", reject <var>configPromise</var>.</p>
       <li data-md>
        <p>Otherwise, let <var>urlString</var> be <var>urlWithMetadata</var>["<var>url</var>"].</p>
       <li data-md>
        <p>Let <var>url</var> be the result of running a <a data-link-type="dfn" href="https://url.spec.whatwg.org#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on <var>urlString</var>.</p>
       <li data-md>
        <p>If <var>url</var> is not a valid <code class="idl"><a data-link-type="idl" href="https://url.spec.whatwg.org/#url" id="ref-for-url">URL</a></code>, reject <var>configPromise</var>.</p>
       <li data-md>
        <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">append</a> <var>urlString</var> to <var>urlList</var>.</p>
       <li data-md>
        <p>If <var>urlWithMetadata</var> has field "<var>reportingMetadata</var>":</p>
        <ol>
         <li data-md>
          <p>Let <var>reportingMetadata</var> be <var>urlWithMetadata</var>["<var>reportingMetadata</var>"].</p>
         <li data-md>
          <p>If <var>reportingMetadata</var> is invalid, reject <var>configPromise</var>.</p>
        </ol>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule②">addModule()</a></code> has not yet been called, reject <var>configPromise</var>.</p>
       <li data-md>
        <p>Let <var>pendingUrl</var> be a newly generated <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc4122#urnuuid" id="ref-for-urnuuid">urn:uuid</a>.</p>
       <li data-md>
        <p>Let <var>fencedFrameConfig</var> be a <a data-link-type="dfn" href="https://wicg.github.io/fenced-frame/#fencedframeconfig" id="ref-for-fencedframeconfig">FencedFrameConfig</a> constructed from <var>pendingUrl</var>.</p>
       <li data-md>
        <p>Resolve <var>configPromise</var> as <var>fencedFrameConfig</var>.</p>
       <li data-md>
        <p>Let <var>indexPromise</var> be a new promise.</p>
       <li data-md>
        <p>Let <var>outsideSettings</var> be worklet’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>.</p>
       <li data-md>
        <p>Let <var>agent</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#obtain-a-worklet-agent" id="ref-for-obtain-a-worklet-agent①">obtaining a worklet agent</a> given <var>outsideSettings</var>. Run the following steps in <var>agent</var>:</p>
        <ol>
         <li data-md>
          <p>Let <var>index</var> be 0.</p>
         <li data-md>
          <p>If module script has been loaded for this worklet:</p>
          <ol>
           <li data-md>
            <p>Let <var>operationMap</var> be the operation map in the associated <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope④">SharedStorageWorkletGlobalScope</a></code>.</p>
           <li data-md>
            <p>Let <var>operation</var> be the operation registered to <var>name</var> in <var>operationMap</var>, if <var>operation</var> exists.</p>
           <li data-md>
            <p>If <var>operation</var> exists:</p>
            <ol>
             <li data-md>
              <p>If <var>options</var> contains <var>data</var>, let <var>operationResult</var> be the result of invoking <var>operation</var> with arguments <var>urlList</var> and <var>data</var>.</p>
             <li data-md>
              <p>Otherwise, let <var>operationResult</var> be the result of invoking <var>operation</var> with argument <var>urlList</var>.</p>
             <li data-md>
              <p>If there are no errors:</p>
              <ol>
               <li data-md>
                <p>Set <var>index</var> to the result of casting <var>operationResult</var> to an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①">unsigned long</a></code>. If this throws an exception, catch it and set <var>index</var> back to 0.</p>
               <li data-md>
                <p>If <var>index</var> > <var>urlList</var>.<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a>, then set <var>index</var> back to 0.</p>
              </ol>
            </ol>
          </ol>
         <li data-md>
          <p>Resolve <var>indexPromise</var> with <var>index</var>.</p>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org#upon-fulfillment" id="ref-for-upon-fulfillment">Upon fulfillment</a> of <var>indexPromise</var>, perform the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>resultIndex</var> be its numerical value.</p>
         <li data-md>
          <p>Let <var>remainingBudget</var> be the numerical result from <code class="idl"><a data-link-type="idl" href="#dom-sharedstorage-remainingbudget" id="ref-for-dom-sharedstorage-remainingbudget①">remainingBudget()</a></code>.</p>
         <li data-md>
          <p>Let <var>currentDebit</var> be log_2(<var>urlList</var>.<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a>).</p>
         <li data-md>
          <p>If <var>currentDebit</var> > <var>remainingBudget</var>, set <var>resultIndex</var> to 0.</p>
         <li data-md>
          <p>Store <var>currentDebit</var> so that it can be withdrawn from the database in the event of a frame created from <var>fencedFrameConfig</var> triggering a top-frame navigation.</p>
         <li data-md>
          <p>Internally map <var>pendingUrl</var> to <var>urlList</var>[<var>resultIndex</var>].</p>
        </ol>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.2" id="setter"><span class="secno">3.2. </span><span class="content">Setter/Deleter Methods</span><a class="self-link" href="#setter"></a></h3>
   <div class="algorithm" data-algorithm="set(key, value, options)" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export data-lt="set(key, value, options)|set(key, value)" id="dom-sharedstorage-set"><code>set(<var>key</var>, <var>value</var>, <var>options</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps②">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>value</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror①">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>options</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror②">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>options</var> is empty, create <var>options</var> with "<var>ignoreIfPresent</var>" set to false.</p>
       <li data-md>
        <p>Perform a database query to determine whether an <var>entry</var> for <var>key</var> already exists in the database for this context’s origin.</p>
       <li data-md>
        <p>If <var>entry</var> exists:</p>
        <ol>
         <li data-md>
          <p>If <var>options</var>["<var>ignoreIfPresent</var>"] is true, resolve <var>promise</var> as undefined.</p>
         <li data-md>
          <p>Otherwise, perform a database query to update <var>entry</var> with <var>key</var> and <var>value</var>.</p>
         <li data-md>
          <p>Resolve <var>promise</var> as undefined.</p>
        </ol>
       <li data-md>
        <p>Otherwise, perform a database query to insert an <var>entry</var> with <var>key</var> and <var>value</var> into the database for this context’s origin.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="append(key, value)" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export id="dom-sharedstorage-append"><code>append(<var>key</var>, <var>value</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps③">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror③">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>value</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror④">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
       <li data-md>
        <p>Perform a database query to determine whether an <var>entry</var> for <var>key</var> already exists in the database for this context’s origin.</p>
       <li data-md>
        <p>If <var>entry</var> exists:</p>
        <ol>
         <li data-md>
          <p>Let <var>currentValue</var> be the current value of <var>entry</var>.</p>
         <li data-md>
          <p>Perform a database query to update <var>entry</var> with <var>key</var> and (<var>currentValue</var> + <var>value</var>).</p>
         <li data-md>
          <p>Resolve <var>promise</var> as undefined.</p>
        </ol>
       <li data-md>
        <p>Otherwise, perform a database query to insert an <var>entry</var> with <var>key</var> and <var>value</var> into the database for this context’s origin.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="delete(key)" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export id="dom-sharedstorage-delete"><code>delete(<var>key</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps④">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror⑤">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
       <li data-md>
        <p>Perform a database query to delete any entry for <var>key</var> in the database for this context’s origin.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="clear()" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export id="dom-sharedstorage-clear"><code>clear()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑤">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>Perform a database query to delete all entries in the database for this context’s origin.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.3" id="getter"><span class="secno">3.3. </span><span class="content">Getter Methods</span><a class="self-link" href="#getter"></a></h3>
   <div class="algorithm" data-algorithm="get(key)" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export id="dom-sharedstorage-get"><code>get(<var>key</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑥">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror⑥">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>.</p>
       <li data-md>
        <p>Perform a database query to determine whether an <var>entry</var> for <var>key</var> exists in the database for this context’s origin.</p>
       <li data-md>
        <p>If <var>entry</var> exists:</p>
        <ol>
         <li data-md>
          <p>Let <var>value</var> be the value of <var>entry</var>.</p>
         <li data-md>
          <p>Resolve <var>promise</var> as <var>value</var>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="length()" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export id="dom-sharedstorage-length"><code>length()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑦">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>numEntries</var> be the number of entries in the database for this context’s origin, as determined by a database query to count them.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as <var>numEntries</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="remainingBudget()" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export id="dom-sharedstorage-remainingbudget"><code>remainingBudget()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑧">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>totalBudget</var> be the allotted total <a data-link-type="dfn" href="#bit-budget" id="ref-for-bit-budget">bit budget</a> per <a data-link-type="dfn" href="#epoch" id="ref-for-epoch②">epoch</a>.</p>
       <li data-md>
        <p>Perform a database query to retrieve the <var>debitSum</var> for the context’s origin, i.e. the sum of the <a data-link-type="dfn" href="#bit-debit" id="ref-for-bit-debit①">bit debit</a>s whose timestamps are within the current <a data-link-type="dfn" href="#epoch" id="ref-for-epoch③">epoch</a>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as (<var>totalBudget</var> - <var>debitSum</var>).</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="keys()" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export id="dom-sharedstorage-keys"><code>keys()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>mode</var> be "<code class="idl"><a data-link-type="idl" href="#dom-iteratormode-key" id="ref-for-dom-iteratormode-key">key</a></code>".</p>
     <li data-md>
      <p>Construct a <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator②">SharedStorageIterator</a></code> object <var>iterator</var> with <var>mode</var>.</p>
     <li data-md>
      <p>Return <var>iterator</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="entries()" data-algorithm-for="SharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export id="dom-sharedstorage-entries"><code>entries()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>mode</var> be "<code class="idl"><a data-link-type="idl" href="#dom-iteratormode-keyvalue" id="ref-for-dom-iteratormode-keyvalue">keyValue</a></code>".</p>
     <li data-md>
      <p>Construct a <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator③">SharedStorageIterator</a></code> object <var>iterator</var> with <var>mode</var>.</p>
     <li data-md>
      <p>Return <var>iterator</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.4" id="iterator"><span class="secno">3.4. </span><span class="content"><code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator④">SharedStorageIterator</a></code> Interface Methods</span><a class="self-link" href="#iterator"></a></h3>
   <div class="algorithm" data-algorithm="constructor(mode)" data-algorithm-for="SharedStorageIterator">
     The <dfn class="idl-code" data-dfn-for="SharedStorageIterator" data-dfn-type="method" data-export id="dom-sharedstorageiterator-constructor"><code>constructor(<var>mode</var>)</code><a class="self-link" href="#dom-sharedstorageiterator-constructor"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Create an internal queue <var>pendingEntries</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑨">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>mode</var> is "<code class="idl"><a data-link-type="idl" href="#dom-iteratormode-key" id="ref-for-dom-iteratormode-key①">key</a></code>":</p>
        <ol>
         <li data-md>
          <p>Query the database for all <var>keys</var> with context origin.</p>
         <li data-md>
          <p>Queue <var>keys</var> in <var>pendingEntries</var>, to be returned individually with the <code class="idl"><a data-link-type="idl" href="#dom-sharedstorageiterator-next" id="ref-for-dom-sharedstorageiterator-next①">next()</a></code> method.</p>
        </ol>
       <li data-md>
        <p>Otherwise:</p>
        <ol>
         <li data-md>
          <p>Query the database for all key-value pairs <var>entries</var> with context origin.</p>
         <li data-md>
          <p>Queue <var>entries</var> in <var>pendingEntries</var>, to be returned individually with the <code class="idl"><a data-link-type="idl" href="#dom-sharedstorageiterator-next" id="ref-for-dom-sharedstorageiterator-next②">next()</a></code> method.</p>
        </ol>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="next()" data-algorithm-for="SharedStorageIterator">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorageIterator" data-dfn-type="method" data-export id="dom-sharedstorageiterator-next"><code>next()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①⓪">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If there was an error in retrieving entries, reject <var>promise</var>.</p>
       <li data-md>
        <p>If the internal entry queue <var>pendingEntries</var> is empty:</p>
        <ol>
         <li data-md>
          <p>Create an object <var>doneObject</var> flagging that iteration has finished.</p>
         <li data-md>
          <p>Resolve <var>promise</var> with <var>doneObject</var>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, let <var>entry</var> be the entry at the front of <var>pendingEntries</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as <var>entry</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="4" id="privacy"><span class="secno">4. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p> <span class="XXX">TODO: Add privacy considerations.</span> </p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-sharedstorage-append">append(key, value)</a><span>, in § 3.2</span>
   <li><a href="#bit-budget">bit budget</a><span>, in § 3</span>
   <li><a href="#bit-debit">bit debit</a><span>, in § 3</span>
   <li><a href="#dom-sharedstorage-clear">clear()</a><span>, in § 3.2</span>
   <li>
    constructor(mode)
    <ul>
     <li><a href="#dom-sharedstorageiterator-sharedstorageiterator">constructor for SharedStorageIterator</a><span>, in § 3</span>
     <li><a href="#dom-sharedstorageiterator-constructor">method for SharedStorageIterator</a><span>, in § 3.4</span>
    </ul>
   <li><a href="#dom-sharedstoragerunoperationmethodoptions-data">data</a><span>, in § 3</span>
   <li><a href="#dom-sharedstorage-delete">delete(key)</a><span>, in § 3.2</span>
   <li><a href="#dom-sharedstorage-entries">entries()</a><span>, in § 3.3</span>
   <li><a href="#epoch">epoch</a><span>, in § 3</span>
   <li><a href="#dom-sharedstorage-get">get(key)</a><span>, in § 3.3</span>
   <li><a href="#dom-sharedstoragesetmethodoptions-ignoreifpresent">ignoreIfPresent</a><span>, in § 3</span>
   <li><a href="#enumdef-iteratormode">IteratorMode</a><span>, in § 3</span>
   <li><a href="#dom-iteratormode-key">"key"</a><span>, in § 3</span>
   <li><a href="#dom-sharedstorage-keys">keys()</a><span>, in § 3.3</span>
   <li><a href="#dom-iteratormode-keyvalue">"keyValue"</a><span>, in § 3</span>
   <li><a href="#dom-sharedstorage-length">length()</a><span>, in § 3.3</span>
   <li><a href="#dom-sharedstorageiterator-next">next()</a><span>, in § 3.4</span>
   <li><a href="#sharedstorageworkletglobalscope-operation-map">operation map</a><span>, in § 2.1</span>
   <li><a href="#dom-sharedstorageworkletglobalscope-register">register(name, operationCtor)</a><span>, in § 2.1</span>
   <li><a href="#dom-sharedstorage-remainingbudget">remainingBudget()</a><span>, in § 3.3</span>
   <li><a href="#dom-sharedstorageurlwithmetadata-reportingmetadata">reportingMetadata</a><span>, in § 2</span>
   <li><a href="#dom-sharedstoragerunoperation-run">run(data)</a><span>, in § 2</span>
   <li><a href="#dom-sharedstorageselecturloperation-run">run(data, urls)</a><span>, in § 2</span>
   <li><a href="#dom-sharedstorage-run">run(name)</a><span>, in § 3.1</span>
   <li><a href="#dom-sharedstorage-run">run(name, options)</a><span>, in § 3.1</span>
   <li><a href="#dom-sharedstorage-selecturl">selectURL(name, urls)</a><span>, in § 3.1</span>
   <li><a href="#dom-sharedstorage-selecturl">selectURL(name, urls, options)</a><span>, in § 3.1</span>
   <li><a href="#dom-sharedstorage-set">set(key, value)</a><span>, in § 3.2</span>
   <li><a href="#dom-sharedstorage-set">set(key, value, options)</a><span>, in § 3.2</span>
   <li><a href="#sharedstorage">SharedStorage</a><span>, in § 3</span>
   <li><a href="#sharedstorageiterator">SharedStorageIterator</a><span>, in § 3</span>
   <li><a href="#dom-sharedstorageiterator-sharedstorageiterator">SharedStorageIterator(mode)</a><span>, in § 3</span>
   <li><a href="#sharedstorageoperation">SharedStorageOperation</a><span>, in § 2</span>
   <li><a href="#callbackdef-sharedstorageoperationconstructor">SharedStorageOperationConstructor</a><span>, in § 2</span>
   <li><a href="#sharedstoragerunoperation">SharedStorageRunOperation</a><span>, in § 2</span>
   <li><a href="#dictdef-sharedstoragerunoperationmethodoptions">SharedStorageRunOperationMethodOptions</a><span>, in § 3</span>
   <li><a href="#sharedstorageselecturloperation">SharedStorageSelectURLOperation</a><span>, in § 2</span>
   <li><a href="#dictdef-sharedstoragesetmethodoptions">SharedStorageSetMethodOptions</a><span>, in § 3</span>
   <li><a href="#dictdef-sharedstorageurlwithmetadata">SharedStorageUrlWithMetadata</a><span>, in § 2</span>
   <li><a href="#sharedstorageworklet">SharedStorageWorklet</a><span>, in § 2</span>
   <li><a href="#sharedstorageworkletglobalscope">SharedStorageWorkletGlobalScope</a><span>, in § 2</span>
   <li><a href="#dom-sharedstorageurlwithmetadata-url">url</a><span>, in § 2</span>
   <li><a href="#dom-sharedstorage-worklet">worklet</a><span>, in § 3</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window">https://html.spec.whatwg.org/multipage/nav-history-apis.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">3. The SharedStorage Interface</a> <a href="#ref-for-window①">(2)</a> <a href="#ref-for-window②">(3)</a> <a href="#ref-for-window③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-worklet">
   <a href="https://html.spec.whatwg.org/multipage/worklets.html#worklet">https://html.spec.whatwg.org/multipage/worklets.html#worklet</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-worklet">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-workletglobalscope">
   <a href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope">https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workletglobalscope">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-worklet-addmodule">
   <a href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule">https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-worklet-addmodule">3. The SharedStorage Interface</a>
    <li><a href="#ref-for-dom-worklet-addmodule①">3.1. Run Operation Methods</a> <a href="#ref-for-dom-worklet-addmodule②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-enqueue-the-following-steps">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps">https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enqueue-the-following-steps">3.1. Run Operation Methods</a> <a href="#ref-for-enqueue-the-following-steps①">(2)</a>
    <li><a href="#ref-for-enqueue-the-following-steps②">3.2. Setter/Deleter Methods</a> <a href="#ref-for-enqueue-the-following-steps③">(2)</a> <a href="#ref-for-enqueue-the-following-steps④">(3)</a> <a href="#ref-for-enqueue-the-following-steps⑤">(4)</a>
    <li><a href="#ref-for-enqueue-the-following-steps⑥">3.3. Getter Methods</a> <a href="#ref-for-enqueue-the-following-steps⑦">(2)</a> <a href="#ref-for-enqueue-the-following-steps⑧">(3)</a>
    <li><a href="#ref-for-enqueue-the-following-steps⑨">3.4. SharedStorageIterator Interface Methods</a> <a href="#ref-for-enqueue-the-following-steps①⓪">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fencedframeconfig">
   <a href="https://wicg.github.io/fenced-frame/#fencedframeconfig">https://wicg.github.io/fenced-frame/#fencedframeconfig</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fencedframeconfig">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-input-list">
   <a href="https://html.spec.whatwg.org/multipage/input.html#dom-input-list">https://html.spec.whatwg.org/multipage/input.html#dom-input-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-input-list">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-obtain-a-worklet-agent">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#obtain-a-worklet-agent">https://html.spec.whatwg.org/multipage/webappapis.html#obtain-a-worklet-agent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-obtain-a-worklet-agent">3.1. Run Operation Methods</a> <a href="#ref-for-obtain-a-worklet-agent①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-map">
   <a href="https://infra.spec.whatwg.org#ordered-map">https://infra.spec.whatwg.org#ordered-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-map">2.1. Registering a Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relevant-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relevant-settings-object">3.1. Run Operation Methods</a> <a href="#ref-for-relevant-settings-object①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-set">
   <a href="https://infra.spec.whatwg.org#map-set">https://infra.spec.whatwg.org#map-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-set">2.1. Registering a Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-upon-fulfillment">
   <a href="https://webidl.spec.whatwg.org#upon-fulfillment">https://webidl.spec.whatwg.org#upon-fulfillment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-upon-fulfillment">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-parser">
   <a href="https://url.spec.whatwg.org#concept-url-parser">https://url.spec.whatwg.org#concept-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-parser">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-urnuuid">
   <a href="https://www.rfc-editor.org/rfc/rfc4122#urnuuid">https://www.rfc-editor.org/rfc/rfc4122#urnuuid</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-urnuuid">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-append">
   <a href="https://infra.spec.whatwg.org/#list-append">https://infra.spec.whatwg.org/#list-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-append">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-size">
   <a href="https://infra.spec.whatwg.org/#list-size">https://infra.spec.whatwg.org/#list-size</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-size">3.1. Run Operation Methods</a> <a href="#ref-for-list-size①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-url">
   <a href="https://url.spec.whatwg.org/#url">https://url.spec.whatwg.org/#url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-url">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMException">https://webidl.spec.whatwg.org/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">3.2. Setter/Deleter Methods</a> <a href="#ref-for-idl-DOMException①">(2)</a> <a href="#ref-for-idl-DOMException②">(3)</a> <a href="#ref-for-idl-DOMException③">(4)</a> <a href="#ref-for-idl-DOMException④">(5)</a> <a href="#ref-for-idl-DOMException⑤">(6)</a>
    <li><a href="#ref-for-idl-DOMException⑥">3.3. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMString">https://webidl.spec.whatwg.org/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-idl-DOMString①">3. The SharedStorage Interface</a> <a href="#ref-for-idl-DOMString②">(2)</a> <a href="#ref-for-idl-DOMString③">(3)</a> <a href="#ref-for-idl-DOMString④">(4)</a> <a href="#ref-for-idl-DOMString⑤">(5)</a> <a href="#ref-for-idl-DOMString⑥">(6)</a> <a href="#ref-for-idl-DOMString⑦">(7)</a> <a href="#ref-for-idl-DOMString⑧">(8)</a> <a href="#ref-for-idl-DOMString⑨">(9)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dataerror">
   <a href="https://webidl.spec.whatwg.org/#dataerror">https://webidl.spec.whatwg.org/#dataerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dataerror">3.2. Setter/Deleter Methods</a> <a href="#ref-for-dataerror①">(2)</a> <a href="#ref-for-dataerror②">(3)</a> <a href="#ref-for-dataerror③">(4)</a> <a href="#ref-for-dataerror④">(5)</a> <a href="#ref-for-dataerror⑤">(6)</a>
    <li><a href="#ref-for-dataerror⑥">3.3. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://webidl.spec.whatwg.org/#Exposed">https://webidl.spec.whatwg.org/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-Exposed①">(2)</a> <a href="#ref-for-Exposed②">(3)</a> <a href="#ref-for-Exposed③">(4)</a> <a href="#ref-for-Exposed④">(5)</a>
    <li><a href="#ref-for-Exposed⑤">3. The SharedStorage Interface</a> <a href="#ref-for-Exposed⑥">(2)</a> <a href="#ref-for-Exposed⑦">(3)</a> <a href="#ref-for-Exposed⑧">(4)</a> <a href="#ref-for-Exposed⑨">(5)</a> <a href="#ref-for-Exposed①⓪">(6)</a> <a href="#ref-for-Exposed①①">(7)</a> <a href="#ref-for-Exposed①②">(8)</a> <a href="#ref-for-Exposed①③">(9)</a> <a href="#ref-for-Exposed①④">(10)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-frozen-array">
   <a href="https://webidl.spec.whatwg.org/#idl-frozen-array">https://webidl.spec.whatwg.org/#idl-frozen-array</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-frozen-array">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-idl-frozen-array①">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Global">
   <a href="https://webidl.spec.whatwg.org/#Global">https://webidl.spec.whatwg.org/#Global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Global">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://webidl.spec.whatwg.org/#idl-promise">https://webidl.spec.whatwg.org/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-idl-promise①">(2)</a>
    <li><a href="#ref-for-idl-promise②">3. The SharedStorage Interface</a> <a href="#ref-for-idl-promise③">(2)</a> <a href="#ref-for-idl-promise④">(3)</a> <a href="#ref-for-idl-promise⑤">(4)</a> <a href="#ref-for-idl-promise⑥">(5)</a> <a href="#ref-for-idl-promise⑦">(6)</a> <a href="#ref-for-idl-promise⑧">(7)</a> <a href="#ref-for-idl-promise⑨">(8)</a> <a href="#ref-for-idl-promise①⓪">(9)</a> <a href="#ref-for-idl-promise①①">(10)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror">https://webidl.spec.whatwg.org/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">2.1. Registering a Worklet</a> <a href="#ref-for-exceptiondef-typeerror①">(2)</a> <a href="#ref-for-exceptiondef-typeerror②">(3)</a> <a href="#ref-for-exceptiondef-typeerror③">(4)</a> <a href="#ref-for-exceptiondef-typeerror④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-USVString">
   <a href="https://webidl.spec.whatwg.org/#idl-USVString">https://webidl.spec.whatwg.org/#idl-USVString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-USVString">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-idl-USVString①">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-any">
   <a href="https://webidl.spec.whatwg.org/#idl-any">https://webidl.spec.whatwg.org/#idl-any</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-any">3. The SharedStorage Interface</a> <a href="#ref-for-idl-any①">(2)</a> <a href="#ref-for-idl-any②">(3)</a> <a href="#ref-for-idl-any③">(4)</a> <a href="#ref-for-idl-any④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-boolean">
   <a href="https://webidl.spec.whatwg.org/#idl-boolean">https://webidl.spec.whatwg.org/#idl-boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-boolean">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-double">
   <a href="https://webidl.spec.whatwg.org/#idl-double">https://webidl.spec.whatwg.org/#idl-double</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-double">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-long">
   <a href="https://webidl.spec.whatwg.org/#idl-long">https://webidl.spec.whatwg.org/#idl-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-long">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-idl-long①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-object">
   <a href="https://webidl.spec.whatwg.org/#idl-object">https://webidl.spec.whatwg.org/#idl-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-object">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-idl-object①">(2)</a> <a href="#ref-for-idl-object②">(3)</a> <a href="#ref-for-idl-object③">(4)</a>
    <li><a href="#ref-for-idl-object④">3. The SharedStorage Interface</a> <a href="#ref-for-idl-object⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://webidl.spec.whatwg.org/#idl-undefined">https://webidl.spec.whatwg.org/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-idl-undefined①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-long">
   <a href="https://webidl.spec.whatwg.org/#idl-unsigned-long">https://webidl.spec.whatwg.org/#idl-unsigned-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-long">3. The SharedStorage Interface</a>
    <li><a href="#ref-for-idl-unsigned-long①">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-rtcidentityproviderregistrar-register">
   <a href="https://w3c.github.io/webrtc-identity/#dom-rtcidentityproviderregistrar-register">https://w3c.github.io/webrtc-identity/#dom-rtcidentityproviderregistrar-register</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-rtcidentityproviderregistrar-register">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-worklet">Worklet</span>
     <li><span class="dfn-paneled" id="term-for-workletglobalscope">WorkletGlobalScope</span>
     <li><span class="dfn-paneled" id="term-for-dom-worklet-addmodule">addModule(moduleURL, options)</span>
     <li><span class="dfn-paneled" id="term-for-enqueue-the-following-steps">enqueue the following steps</span>
     <li><span class="dfn-paneled" id="term-for-fencedframeconfig">fencedframeconfig</span>
     <li><span class="dfn-paneled" id="term-for-dom-input-list">list</span>
     <li><span class="dfn-paneled" id="term-for-obtain-a-worklet-agent">obtaining a worklet agent</span>
     <li><span class="dfn-paneled" id="term-for-ordered-map">ordered map</span>
     <li><span class="dfn-paneled" id="term-for-relevant-settings-object">relevant settings object</span>
     <li><span class="dfn-paneled" id="term-for-map-set">set</span>
     <li><span class="dfn-paneled" id="term-for-upon-fulfillment">upon fulfillment</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-parser">url parser</span>
     <li><span class="dfn-paneled" id="term-for-urnuuid">urn:uuid</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-list-append">append</span>
     <li><span class="dfn-paneled" id="term-for-list-size">size</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-url">URL</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-dataerror">DataError</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-idl-frozen-array">FrozenArray</span>
     <li><span class="dfn-paneled" id="term-for-Global">Global</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-idl-USVString">USVString</span>
     <li><span class="dfn-paneled" id="term-for-idl-any">any</span>
     <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-idl-double">double</span>
     <li><span class="dfn-paneled" id="term-for-idl-long">long</span>
     <li><span class="dfn-paneled" id="term-for-idl-object">object</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-long">unsigned long</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBRTC-IDENTITY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-rtcidentityproviderregistrar-register">register()</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
   <dt id="biblio-webrtc-identity">[WEBRTC-IDENTITY]
   <dd>Cullen Jennings; Martin Thomson. <a href="https://w3c.github.io/webrtc-identity/"><cite>Identity for WebRTC 1.0</cite></a>. URL: <a href="https://w3c.github.io/webrtc-identity/">https://w3c.github.io/webrtc-identity/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->)]
<c- b>interface</c-> <a href="#sharedstorageworklet"><code><c- g>SharedStorageWorklet</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet"><c- n>Worklet</c-></a> {
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global"><c- g>Global</c-></a>=<a data-link-type="idl-name" href="#sharedstorageworklet"><c- n>SharedStorageWorklet</c-></a>]
<c- b>interface</c-> <a href="#sharedstorageworkletglobalscope"><code><c- g>SharedStorageWorkletGlobalScope</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sharedstorageworkletglobalscope-register"><c- g>register</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorageworkletglobalscope-register-name-operationctor-name"><code><c- g>name</c-></code></a>,
                     <a data-link-type="idl-name" href="#callbackdef-sharedstorageoperationconstructor"><c- n>SharedStorageOperationConstructor</c-></a> <a href="#dom-sharedstorageworkletglobalscope-register-name-operationctor-operationctor"><code><c- g>operationCtor</c-></code></a>);
};

<c- b>callback</c-> <a href="#callbackdef-sharedstorageoperationconstructor"><code><c- g>SharedStorageOperationConstructor</c-></code></a> = <a data-link-type="idl-name" href="#sharedstorageoperation"><c- n>SharedStorageOperation</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-sharedstorageoperationconstructor-options"><code><c- g>options</c-></code></a>);

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <a href="#sharedstorageoperation"><code><c- g>SharedStorageOperation</c-></code></a> {
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <a href="#sharedstoragerunoperation"><code><c- g>SharedStorageRunOperation</c-></code></a> : <a data-link-type="idl-name" href="#sharedstorageoperation"><c- n>SharedStorageOperation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a href="#dom-sharedstoragerunoperation-run"><code><c- g>run</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-sharedstoragerunoperation-run-data-data"><code><c- g>data</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <a href="#sharedstorageselecturloperation"><code><c- g>SharedStorageSelectURLOperation</c-></code></a> : <a data-link-type="idl-name" href="#sharedstorageoperation"><c- n>SharedStorageOperation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a>> <a href="#dom-sharedstorageselecturloperation-run"><code><c- g>run</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-sharedstorageselecturloperation-run-data-urls-data"><code><c- g>data</c-></code></a>,
                    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-sharedstorageurlwithmetadata"><c- n>SharedStorageUrlWithMetadata</c-></a>> <a href="#dom-sharedstorageselecturloperation-run-data-urls-urls"><code><c- g>urls</c-></code></a>);
};

<c- b>dictionary</c-> <a href="#dictdef-sharedstorageurlwithmetadata"><code><c- g>SharedStorageUrlWithMetadata</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-type="USVString " href="#dom-sharedstorageurlwithmetadata-url"><code><c- g>url</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a data-type="object " href="#dom-sharedstorageurlwithmetadata-reportingmetadata"><code><c- g>reportingMetadata</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <a href="#sharedstorage"><code><c- g>SharedStorage</c-></code></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->)] 
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-run"><c- g>run</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-run-name-options-name"><code><c- g>name</c-></code></a>,
                   <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragerunoperationmethodoptions"><c- n>SharedStorageRunOperationMethodOptions</c-></a> <a href="#dom-sharedstorage-run-name-options-options"><code><c- g>options</c-></code></a> = {});

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->)] 
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-selecturl"><c- g>selectURL</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-selecturl-name-urls-options-name"><code><c- g>name</c-></code></a>,
                               <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-sharedstorageurlwithmetadata"><c- n>SharedStorageUrlWithMetadata</c-></a>> <a href="#dom-sharedstorage-selecturl-name-urls-options-urls"><code><c- g>urls</c-></code></a>,
                               <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragerunoperationmethodoptions"><c- n>SharedStorageRunOperationMethodOptions</c-></a> <a href="#dom-sharedstorage-selecturl-name-urls-options-options"><code><c- g>options</c-></code></a> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-set"><c- g>set</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-set-key-value-options-key"><code><c- g>key</c-></code></a>,
                   <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-set-key-value-options-value"><code><c- g>value</c-></code></a>,
                   <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragesetmethodoptions"><c- n>SharedStorageSetMethodOptions</c-></a> <a href="#dom-sharedstorage-set-key-value-options-options"><code><c- g>options</c-></code></a> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-append"><c- g>append</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-append-key-value-key"><code><c- g>key</c-></code></a>,
                      <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-append-key-value-value"><code><c- g>value</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-delete"><c- g>delete</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-delete-key-key"><code><c- g>key</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-clear"><c- g>clear</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-get"><c- g>get</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-get-key-key"><code><c- g>key</c-></code></a>);

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-length"><c- g>length</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-remainingbudget"><c- g>remainingBudget</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a data-link-type="idl-name" href="#sharedstorageiterator"><c- n>SharedStorageIterator</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-keys"><c- g>keys</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)] <a data-link-type="idl-name" href="#sharedstorageiterator"><c- n>SharedStorageIterator</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sharedstorage-entries"><c- g>entries</c-></a>();

  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->)] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#sharedstorageworklet"><c- n>SharedStorageWorklet</c-></a> <a data-readonly data-type="SharedStorageWorklet" href="#dom-sharedstorage-worklet"><code><c- g>worklet</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-sharedstoragesetmethodoptions"><code><c- g>SharedStorageSetMethodOptions</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-type="boolean " href="#dom-sharedstoragesetmethodoptions-ignoreifpresent"><code><c- g>ignoreIfPresent</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-sharedstoragerunoperationmethodoptions"><code><c- g>SharedStorageRunOperationMethodOptions</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a data-type="object " href="#dom-sharedstoragerunoperationmethodoptions-data"><code><c- g>data</c-></code></a>;
};

<c- b>enum</c-> <a href="#enumdef-iteratormode"><code><c- g>IteratorMode</c-></code></a> { <a href="#dom-iteratormode-key"><code><c- s>"key"</c-></code></a>, <a href="#dom-iteratormode-keyvalue"><code><c- s>"keyValue"</c-></code></a> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <a href="#sharedstorageiterator"><code><c- g>SharedStorageIterator</c-></code></a> {
  <a href="#dom-sharedstorageiterator-sharedstorageiterator"><code><c- g>constructor</c-></code></a>(<a data-link-type="idl-name" href="#enumdef-iteratormode"><c- n>IteratorMode</c-></a> <a href="#dom-sharedstorageiterator-sharedstorageiterator-mode-mode"><code><c- g>mode</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorageiterator-next"><c- g>next</c-></a>();
};

</pre>
  <aside class="dfn-panel" data-for="sharedstorageworklet">
   <b><a href="#sharedstorageworklet">#sharedstorageworklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageworklet">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstorageworklet①">(2)</a> <a href="#ref-for-sharedstorageworklet②">(3)</a> <a href="#ref-for-sharedstorageworklet③">(4)</a>
    <li><a href="#ref-for-sharedstorageworklet④">3. The SharedStorage Interface</a> <a href="#ref-for-sharedstorageworklet⑤">(2)</a> <a href="#ref-for-sharedstorageworklet⑥">(3)</a> <a href="#ref-for-sharedstorageworklet⑦">(4)</a> <a href="#ref-for-sharedstorageworklet⑧">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageworkletglobalscope">
   <b><a href="#sharedstorageworkletglobalscope">#sharedstorageworkletglobalscope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageworkletglobalscope">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope①">2.1. Registering a Worklet</a> <a href="#ref-for-sharedstorageworkletglobalscope②">(2)</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope③">3.1. Run Operation Methods</a> <a href="#ref-for-sharedstorageworkletglobalscope④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="callbackdef-sharedstorageoperationconstructor">
   <b><a href="#callbackdef-sharedstorageoperationconstructor">#callbackdef-sharedstorageoperationconstructor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-callbackdef-sharedstorageoperationconstructor">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageoperation">
   <b><a href="#sharedstorageoperation">#sharedstorageoperation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageoperation">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstorageoperation①">(2)</a> <a href="#ref-for-sharedstorageoperation②">(3)</a> <a href="#ref-for-sharedstorageoperation③">(4)</a> <a href="#ref-for-sharedstorageoperation④">(5)</a> <a href="#ref-for-sharedstorageoperation⑤">(6)</a> <a href="#ref-for-sharedstorageoperation⑥">(7)</a>
    <li><a href="#ref-for-sharedstorageoperation⑦">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstoragerunoperation">
   <b><a href="#sharedstoragerunoperation">#sharedstoragerunoperation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstoragerunoperation">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstoragerunoperation①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageselecturloperation">
   <b><a href="#sharedstorageselecturloperation">#sharedstorageselecturloperation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageselecturloperation">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstorageselecturloperation①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sharedstorageurlwithmetadata">
   <b><a href="#dictdef-sharedstorageurlwithmetadata">#dictdef-sharedstorageurlwithmetadata</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sharedstorageurlwithmetadata">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-dictdef-sharedstorageurlwithmetadata①">(2)</a>
    <li><a href="#ref-for-dictdef-sharedstorageurlwithmetadata②">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageworkletglobalscope-operation-map">
   <b><a href="#sharedstorageworkletglobalscope-operation-map">#sharedstorageworkletglobalscope-operation-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageworkletglobalscope-operation-map">2.1. Registering a Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorageworkletglobalscope-register">
   <b><a href="#dom-sharedstorageworkletglobalscope-register">#dom-sharedstorageworkletglobalscope-register</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorageworkletglobalscope-register">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-dom-sharedstorageworkletglobalscope-register①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bit-budget">
   <b><a href="#bit-budget">#bit-budget</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bit-budget">3.3. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="epoch">
   <b><a href="#epoch">#epoch</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-epoch">3. The SharedStorage Interface</a> <a href="#ref-for-epoch①">(2)</a>
    <li><a href="#ref-for-epoch②">3.3. Getter Methods</a> <a href="#ref-for-epoch③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bit-debit">
   <b><a href="#bit-debit">#bit-debit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bit-debit">3. The SharedStorage Interface</a>
    <li><a href="#ref-for-bit-debit①">3.3. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorage">
   <b><a href="#sharedstorage">#sharedstorage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorage">3. The SharedStorage Interface</a> <a href="#ref-for-sharedstorage①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-worklet">
   <b><a href="#dom-sharedstorage-worklet">#dom-sharedstorage-worklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-worklet">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sharedstoragesetmethodoptions">
   <b><a href="#dictdef-sharedstoragesetmethodoptions">#dictdef-sharedstoragesetmethodoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sharedstoragesetmethodoptions">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sharedstoragerunoperationmethodoptions">
   <b><a href="#dictdef-sharedstoragerunoperationmethodoptions">#dictdef-sharedstoragerunoperationmethodoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sharedstoragerunoperationmethodoptions">3. The SharedStorage Interface</a> <a href="#ref-for-dictdef-sharedstoragerunoperationmethodoptions①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-iteratormode">
   <b><a href="#enumdef-iteratormode">#enumdef-iteratormode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-iteratormode">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-iteratormode-key">
   <b><a href="#dom-iteratormode-key">#dom-iteratormode-key</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-iteratormode-key">3.3. Getter Methods</a>
    <li><a href="#ref-for-dom-iteratormode-key①">3.4. SharedStorageIterator Interface Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-iteratormode-keyvalue">
   <b><a href="#dom-iteratormode-keyvalue">#dom-iteratormode-keyvalue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-iteratormode-keyvalue">3.3. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageiterator">
   <b><a href="#sharedstorageiterator">#sharedstorageiterator</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageiterator">3. The SharedStorage Interface</a> <a href="#ref-for-sharedstorageiterator①">(2)</a>
    <li><a href="#ref-for-sharedstorageiterator②">3.3. Getter Methods</a> <a href="#ref-for-sharedstorageiterator③">(2)</a>
    <li><a href="#ref-for-sharedstorageiterator④">3.4. SharedStorageIterator Interface Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-run">
   <b><a href="#dom-sharedstorage-run">#dom-sharedstorage-run</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-run">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-selecturl">
   <b><a href="#dom-sharedstorage-selecturl">#dom-sharedstorage-selecturl</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-selecturl">3. The SharedStorage Interface</a> <a href="#ref-for-dom-sharedstorage-selecturl①">(2)</a> <a href="#ref-for-dom-sharedstorage-selecturl②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-set">
   <b><a href="#dom-sharedstorage-set">#dom-sharedstorage-set</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-set">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-append">
   <b><a href="#dom-sharedstorage-append">#dom-sharedstorage-append</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-append">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-delete">
   <b><a href="#dom-sharedstorage-delete">#dom-sharedstorage-delete</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-delete">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-clear">
   <b><a href="#dom-sharedstorage-clear">#dom-sharedstorage-clear</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-clear">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-get">
   <b><a href="#dom-sharedstorage-get">#dom-sharedstorage-get</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-get">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-length">
   <b><a href="#dom-sharedstorage-length">#dom-sharedstorage-length</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-length">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-remainingbudget">
   <b><a href="#dom-sharedstorage-remainingbudget">#dom-sharedstorage-remainingbudget</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-remainingbudget">3. The SharedStorage Interface</a>
    <li><a href="#ref-for-dom-sharedstorage-remainingbudget①">3.1. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-keys">
   <b><a href="#dom-sharedstorage-keys">#dom-sharedstorage-keys</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-keys">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorage-entries">
   <b><a href="#dom-sharedstorage-entries">#dom-sharedstorage-entries</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorage-entries">3. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorageiterator-next">
   <b><a href="#dom-sharedstorageiterator-next">#dom-sharedstorageiterator-next</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorageiterator-next">3. The SharedStorage Interface</a>
    <li><a href="#ref-for-dom-sharedstorageiterator-next①">3.4. SharedStorageIterator Interface Methods</a> <a href="#ref-for-dom-sharedstorageiterator-next②">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    "use strict";
    {
        document.addEventListener("click", e=>{
            if(e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>