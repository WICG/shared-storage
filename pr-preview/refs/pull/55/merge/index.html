<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Shared Storage API</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 859efb4bd, updated Fri Jan 27 16:04:01 2023 -0800" name="generator">
  <link href="https://github.com/WICG/shared-storage" rel="canonical">
  <meta content="488cb53d0598a61433c4debf8d500f413e2b2d27" name="document-revision">
<style>
/* .XXX from https://resources.whatwg.org/standard.css */
.XXX {
  color: #D50606;
  background: white;
  border: solid #D50606;
}
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Shared Storage API</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2023-02-09">9 February 2023</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://github.com/WICG/shared-storage">https://github.com/WICG/shared-storage</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/shared-storage/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:cammie@chromium.org">Camillia Smith Barnes</a> (<a class="p-org org" href="https://google.com">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2023 the Contributors to the Shared Storage API Specification, published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>.
A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is available. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Shared Storage is a storage API that is intentionally not partitioned by top-frame site (though still partitioned by context origin of course!). To limit cross-site reidentification of users, data in Shared Storage may only be read in a restricted environment that has carefully constructed output gates.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#worklet"><span class="secno">2</span> <span class="content">The <code class="idl"><span>SharedStorageWorklet</span></code> Interface</span></a>
     <ol class="toc">
      <li><a href="#register-worklet"><span class="secno">2.1</span> <span class="content">Registering a Worklet</span></a>
     </ol>
    <li>
     <a href="#database"><span class="secno">3</span> <span class="content">The <span>Shared Storage Database</span></span></a>
     <ol class="toc">
      <li><a href="#monkey-patch"><span class="secno">3.1</span> <span class="content">Monkey Patch for the <span>Storage Model</span></span></a>
     </ol>
    <li>
     <a href="#shared-storage-interface"><span class="secno">4</span> <span class="content">The <code class="idl"><span>SharedStorage</span></code> Interface</span></a>
     <ol class="toc">
      <li>
       <a href="#window"><span class="secno">4.1</span> <span class="content">The <code class="idl"><span>WindowSharedStorage</span></code> interface</span></a>
       <ol class="toc">
        <li><a href="#window-setter"><span class="secno">4.1.1</span> <span class="content">Window Setter/Deleter Methods</span></a>
        <li><a href="#budget"><span class="secno">4.1.2</span> <span class="content">Entropy Budget</span></a>
        <li><a href="#run-op"><span class="secno">4.1.3</span> <span class="content">Run Operation Methods</span></a>
       </ol>
      <li>
       <a href="#worklet-shared-storage"><span class="secno">4.2</span> <span class="content">The <code class="idl"><span>WorkletSharedStorage</span></code> interface</span></a>
       <ol class="toc">
        <li><a href="#worklet-setter"><span class="secno">4.2.1</span> <span class="content">Worklet Setter/Deleter Methods</span></a>
        <li><a href="#getter"><span class="secno">4.2.2</span> <span class="content">Getter Methods</span></a>
       </ol>
      <li><a href="#iterator"><span class="secno">4.3</span> <span class="content">The <code class="idl"><span>SharedStorageIterator</span></code> Interface</span></a>
     </ol>
    <li><a href="#privacy"><span class="secno">5</span> <span class="content">Privacy Considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
    <em>This section is not normative.</em> 
   <p>In order to prevent cross-site user tracking, browsers are partitioning all forms of storage by top-frame site; see .<a data-link-type="dfn" href="https://privacycg.github.io/storage-partitioning/#client-side-storage-partitioning" id="ref-for-client-side-storage-partitioning">Client-Side Storage Partitioning</a>. But, there are many legitimate use cases currently relying on unpartitioned storage.</p>
   <p>This document introduces a new storage API that is intentionally not partitioned by top-frame site (though still partitioned by context origin), in order to serve a number of the use cases needing unpartitioned storage. To limit cross-site reidentification of users, data in Shared Storage may only be read in a restricted environment that has carefully constructed output gates. Over time, there may be additional ouput gates included in the standard.</p>
   <div class="example" id="example-a8c448c3">
    <a class="self-link" href="#example-a8c448c3"></a> <code>a.example</code> randomly assigns users to groups in a way that is consistent cross-site. 
    <p>Inside an <code>a.example</code> iframe:</p>
<pre class="lang-js highlight"><c- a>function</c-> generateSeed<c- p>()</c-> <c- p>{</c-> … <c- p>}</c->
<c- k>await</c-> window<c- p>.</c->sharedStorage<c- p>.</c->worklet<c- p>.</c->addModule<c- p>(</c-><c- t>'experiment.js'</c-><c- p>);</c->

<c- c1>// Only write a cross-site seed to a.example’s storage if there isn’t one yet.</c->
window<c- p>.</c->sharedStorage<c- p>.</c->set<c- p>(</c-><c- t>'seed'</c-><c- p>,</c-> generateSeed<c- p>(),</c-> <c- p>{</c-> ignoreIfPresent<c- o>:</c-> <c- kc>true</c-> <c- p>});</c->

<c- c1>// opaqueURL will be of the form urn:uuid and will be created by privileged code to</c->
<c- c1>// avoid leaking the chosen input URL back to the document.</c->

<c- a>const</c-> opaqueURL <c- o>=</c-> <c- k>await</c-> window<c- p>.</c->sharedStorage<c- p>.</c->selectURL<c- p>(</c->
  <c- t>'select-url-for-experiment'</c-><c- p>,</c->
  <c- p>[</c->
    <c- p>{</c->url<c- o>:</c-> <c- u>"blob:https://a.example/123…"</c-><c- p>,</c-> reportingMetadata<c- o>:</c-> <c- p>{</c-><c- u>"click"</c-><c- o>:</c-> <c- u>"https://report.example/1..."</c-><c- p>}},</c->
    <c- p>{</c->url<c- o>:</c-> <c- u>"blob:https://b.example/abc…"</c-><c- p>,</c-> reportingMetadata<c- o>:</c-> <c- p>{</c-><c- u>"click"</c-><c- o>:</c-> <c- u>"https://report.example/a..."</c-><c- p>}},</c->
    <c- p>{</c->url<c- o>:</c-> <c- u>"blob:https://c.example/789…"</c-><c- p>}</c->
  <c- p>],</c->
  <c- p>{</c-> data<c- o>:</c-> <c- p>{</c-> name<c- o>:</c-> <c- t>'experimentA'</c-> <c- p>}</c-> <c- p>}</c->
<c- p>);</c->

document<c- p>.</c->getElementById<c- p>(</c-><c- t>'my-fenced-frame'</c-><c- p>).</c->src <c- o>=</c-> opaqueURL<c- p>;</c->
</pre>
    <p>inside the <code>experiment.js</code> worklet script:</p>
<pre class="lang-js highlight"><c- a>class</c-> SelectURLOperation <c- p>{</c->
  hash<c- p>(</c->experimentName<c- p>,</c-> seed<c- p>)</c-> <c- p>{</c-> … <c- p>}</c->

  <c- k>async</c-> run<c- p>(</c->data<c- p>,</c-> urls<c- p>)</c-> <c- p>{</c->
    <c- a>const</c-> seed <c- o>=</c-> <c- k>await</c-> <c- k>this</c-><c- p>.</c->sharedStorage<c- p>.</c->get<c- p>(</c-><c- t>'seed'</c-><c- p>);</c->
    <c- k>return</c-> hash<c- p>(</c->data<c- p>.</c->name<c- p>,</c-> seed<c- p>)</c-> <c- o>%</c-> urls<c- p>.</c->length<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
register<c- p>(</c-><c- t>'select-url-for-experiment'</c-><c- p>,</c-> SelectURLOperation<c- p>);</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="2" id="worklet"><span class="secno">2. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet">SharedStorageWorklet</a></code> Interface</span><a class="self-link" href="#worklet"></a></h2>
    The <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet①">SharedStorageWorklet</a></code> object allows developers to supply <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#module-script" id="ref-for-module-script">module scripts</a> to process <a data-link-type="dfn" href="#shared-storage" id="ref-for-shared-storage">Shared Storage</a> data and then output the result through one or more of the output gates. Currently there are two output gates, the <a data-link-type="dfn" href="https://github.com/patcg-individual-drafts/private-aggregation-api/blob/main/README.md#private-aggregation" id="ref-for-private-aggregation">private aggregation</a> output gate and the <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-selecturl" id="ref-for-dom-windowsharedstorage-selecturl">URL-selection</a></code> output gate. 
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageworklet"><code><c- g>SharedStorageWorklet</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet" id="ref-for-worklet"><c- n>Worklet</c-></a> {
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet②">SharedStorageWorklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type" id="ref-for-worklet-global-scope-type">worklet global scope type</a> is <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope">SharedStorageWorkletGlobalScope</a></code>.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global" id="ref-for-Global"><c- g>Global</c-></a>=<a data-link-type="idl-name" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet③"><c- n>SharedStorageWorklet</c-></a>]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageworkletglobalscope"><code><c- g>SharedStorageWorkletGlobalScope</c-></code></dfn> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope" id="ref-for-workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sharedstorageworkletglobalscope-register" id="ref-for-dom-sharedstorageworkletglobalscope-register"><c- g>register</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageWorkletGlobalScope/register(name, operationCtor)" data-dfn-type="argument" data-export id="dom-sharedstorageworkletglobalscope-register-name-operationctor-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-sharedstorageworkletglobalscope-register-name-operationctor-name"></a></dfn>,
                     <a data-link-type="idl-name" href="#callbackdef-sharedstorageoperationconstructor" id="ref-for-callbackdef-sharedstorageoperationconstructor"><c- n>SharedStorageOperationConstructor</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageWorkletGlobalScope/register(name, operationCtor)" data-dfn-type="argument" data-export id="dom-sharedstorageworkletglobalscope-register-name-operationctor-operationctor"><code><c- g>operationCtor</c-></code><a class="self-link" href="#dom-sharedstorageworkletglobalscope-register-name-operationctor-operationctor"></a></dfn>);
};

<c- b>callback</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="callback" data-export id="callbackdef-sharedstorageoperationconstructor"><code><c- g>SharedStorageOperationConstructor</c-></code></dfn> = <a data-link-type="idl-name" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation"><c- n>SharedStorageOperation</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageOperationConstructor" data-dfn-type="argument" data-export id="dom-sharedstorageoperationconstructor-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-sharedstorageoperationconstructor-options"></a></dfn>);

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed②"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageoperation"><code><c- g>SharedStorageOperation</c-></code></dfn> {
};
</pre>
   <p>Each <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope①">SharedStorageWorkletGlobalScope</a></code> has an associated <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> <dfn class="dfn-paneled" data-dfn-for="SharedStorageWorkletGlobalScope" data-dfn-type="dfn" data-noexport id="sharedstorageworkletglobalscope-outside-settings">outside settings</dfn>, which is the associated <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet④">SharedStorageWorklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope②">SharedStorageWorkletGlobalScope</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#module-map" id="ref-for-module-map">module map</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#module-script" id="ref-for-module-script①">module scripts</a> should each define and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webrtc-identity/#dom-rtcidentityproviderregistrar-register" id="ref-for-dom-rtcidentityproviderregistrar-register">register</a></code> one or more <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation①">SharedStorageOperation</a></code>s.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope③">SharedStorageWorkletGlobalScope</a></code> also has an associated <dfn class="dfn-paneled" data-dfn-for="SharedStorageWorkletGlobalScope" data-dfn-type="dfn" data-noexport id="sharedstorageworkletglobalscope-operation-map">operation map</dfn>, which is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org#ordered-map" id="ref-for-ordered-map">map</a>, initially empty, of <a data-link-type="dfn" href="https://infra.spec.whatwg.org#string" id="ref-for-string">strings</a> (denoting operation names) to <a data-link-type="dfn" href="https://tc39.es/ecma262/#function-object" id="ref-for-function-object">functions</a>.</p>
   <p>Currently each <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation②">SharedStorageOperation</a></code> registered via <code class="idl"><a data-link-type="idl" href="#dom-sharedstorageworkletglobalscope-register" id="ref-for-dom-sharedstorageworkletglobalscope-register①">register()</a></code> must be one of the following two types:</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="#sharedstoragerunoperation" id="ref-for-sharedstoragerunoperation">SharedStorageRunOperation</a></code></p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="#sharedstorageselecturloperation" id="ref-for-sharedstorageselecturloperation">SharedStorageSelectURLOperation</a></code></p>
   </ul>
   <p>A <code class="idl"><a data-link-type="idl" href="#sharedstoragerunoperation" id="ref-for-sharedstoragerunoperation①">SharedStorageRunOperation</a></code> is an <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation③">SharedStorageOperation</a></code> that has no JavaScript return value, and hence is especially suited for calling into the <a data-link-type="dfn" href="https://github.com/patcg-individual-drafts/private-aggregation-api/blob/main/README.md#private-aggregation" id="ref-for-private-aggregation①">private aggregation</a> service.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#sharedstorageselecturloperation" id="ref-for-sharedstorageselecturloperation①">SharedStorageSelectURLOperation</a></code> is an <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation④">SharedStorageOperation</a></code> that takes in a <a data-link-type="dfn" href="https://infra.spec.whatwg.org#list" id="ref-for-list">list</a> of <code class="idl"><a data-link-type="idl" href="#dictdef-sharedstorageurlwithmetadata" id="ref-for-dictdef-sharedstorageurlwithmetadata">SharedStorageUrlWithMetadata</a></code>s (i.e. <a data-link-type="dfn" href="https://webidl.spec.whatwg.org#dfn-dictionary" id="ref-for-dfn-dictionary">dictionaries</a> containing <a data-link-type="dfn" href="https://infra.spec.whatwg.org#string" id="ref-for-string①">strings</a> representing <code class="idl"><a data-link-type="idl" href="https://url.spec.whatwg.org/#url" id="ref-for-url">URL</a></code>s each wrapped with metadata) and returns a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long">long</a></code> integer index specifying which of these <code class="idl"><a data-link-type="idl" href="https://url.spec.whatwg.org/#url" id="ref-for-url①">URL</a></code>s should be selected.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed③"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstoragerunoperation"><code><c- g>SharedStorageRunOperation</c-></code></dfn> : <a data-link-type="idl-name" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation⑤"><c- n>SharedStorageOperation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorageRunOperation" data-dfn-type="method" data-export data-lt="run(data)" id="dom-sharedstoragerunoperation-run"><code><c- g>run</c-></code><a class="self-link" href="#dom-sharedstoragerunoperation-run"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object①"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageRunOperation/run(data)" data-dfn-type="argument" data-export id="dom-sharedstoragerunoperation-run-data-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-sharedstoragerunoperation-run-data-data"></a></dfn>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed④"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageselecturloperation"><code><c- g>SharedStorageSelectURLOperation</c-></code></dfn> : <a data-link-type="idl-name" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation⑥"><c- n>SharedStorageOperation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long" id="ref-for-idl-long①"><c- b>long</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorageSelectURLOperation" data-dfn-type="method" data-export data-lt="run(data, urls)" id="dom-sharedstorageselecturloperation-run"><code><c- g>run</c-></code><a class="self-link" href="#dom-sharedstorageselecturloperation-run"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object②"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageSelectURLOperation/run(data, urls)" data-dfn-type="argument" data-export id="dom-sharedstorageselecturloperation-run-data-urls-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-sharedstorageselecturloperation-run-data-urls-data"></a></dfn>,
                    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array" id="ref-for-idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-sharedstorageurlwithmetadata" id="ref-for-dictdef-sharedstorageurlwithmetadata①"><c- n>SharedStorageUrlWithMetadata</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorageSelectURLOperation/run(data, urls)" data-dfn-type="argument" data-export id="dom-sharedstorageselecturloperation-run-data-urls-urls"><code><c- g>urls</c-></code><a class="self-link" href="#dom-sharedstorageselecturloperation-run-data-urls-urls"></a></dfn>);
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sharedstorageurlwithmetadata"><code><c- g>SharedStorageUrlWithMetadata</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageUrlWithMetadata" data-dfn-type="dict-member" data-export data-type="USVString " id="dom-sharedstorageurlwithmetadata-url"><code><c- g>url</c-></code><a class="self-link" href="#dom-sharedstorageurlwithmetadata-url"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object③"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageUrlWithMetadata" data-dfn-type="dict-member" data-export data-type="object " id="dom-sharedstorageurlwithmetadata-reportingmetadata"><code><c- g>reportingMetadata</c-></code><a class="self-link" href="#dom-sharedstorageurlwithmetadata-reportingmetadata"></a></dfn>;
};
</pre>
   <h3 class="heading settled" data-level="2.1" id="register-worklet"><span class="secno">2.1. </span><span class="content">Registering a Worklet</span><a class="self-link" href="#register-worklet"></a></h3>
   <div class="algorithm" data-algorithm="register(name, operationCtor)" data-algorithm-for="SharedStorageWorkletGlobalScope">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorageWorkletGlobalScope" data-dfn-type="method" data-export id="dom-sharedstorageworkletglobalscope-register"><code>register(<var>name</var>, <var>operationCtor</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>If <var>name</var> is missing or empty, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>operationMap</var> be this <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope④">SharedStorageWorkletGlobalScope</a></code>'s <a data-link-type="dfn" href="#sharedstorageworkletglobalscope-operation-map" id="ref-for-sharedstorageworkletglobalscope-operation-map">operation map</a>.</p>
     <li data-md>
      <p>If <var>operationMap</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-exists" id="ref-for-map-exists">contains</a> an <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-entry" id="ref-for-map-entry">entry</a> with <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-key" id="ref-for-map-key">key</a> <var>name</var>, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
     <li data-md>
      <p>If <var>operationCtor</var> is missing or not a <a data-link-type="dfn" href="https://tc39.es/ecma262/#constructor" id="ref-for-constructor">constructor</a>, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>prototype</var> be <var>operationCtor</var>’s class prototype.</p>
     <li data-md>
      <p>If <var>prototype</var> is not an object, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>run</var> be <var>prototype</var>’s "<code>run</code>" method.</p>
     <li data-md>
      <p>If <var>run</var> is missing or not a <a data-link-type="dfn" href="https://tc39.es/ecma262/#function-object" id="ref-for-function-object①">function</a>, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror④">TypeError</a></code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-set" id="ref-for-map-set">Set</a> the value of <var>operationMap</var>[<var>name</var>] to <var>run</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="3" id="database"><span class="secno">3. </span><span class="content">The <a data-link-type="dfn" href="#shared-storage-database" id="ref-for-shared-storage-database">Shared Storage Database</a></span><a class="self-link" href="#database"></a></h2>
    A <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent">user agent</a> holds a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="shared-storage-database">shared storage database</dfn>, which consists of a <a data-link-type="dfn" href="#shared-storage-shed" id="ref-for-shared-storage-shed">shared storage shed</a> and provides methods to <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database">store</a>, <a data-link-type="dfn" href="#shared-storage-database-retrieve-an-entry-from-the-database" id="ref-for-shared-storage-database-retrieve-an-entry-from-the-database">retrieve</a>, <a data-link-type="dfn" href="#shared-storage-database-delete-an-entry-from-the-database" id="ref-for-shared-storage-database-delete-an-entry-from-the-database">delete</a>, and <a data-link-type="dfn" href="#shared-storage-database-clear-all-entries-in-the-database" id="ref-for-shared-storage-database-clear-all-entries-in-the-database">clear</a> data, and additional methods as below. The data in the <a data-link-type="dfn" href="#shared-storage-database" id="ref-for-shared-storage-database①">database</a> take the form of <a data-link-type="dfn" href="#shared-storage-database-entry" id="ref-for-shared-storage-database-entry">entries</a>. 
   <p>Each <dfn class="dfn-paneled" data-dfn-for="shared storage database" data-dfn-type="dfn" data-noexport id="shared-storage-database-entry">entry</dfn> consists of a <a data-link-type="dfn" href="#entry-key" id="ref-for-entry-key">key</a> and <a data-link-type="dfn" href="#entry-value" id="ref-for-entry-value">value</a>.</p>
   <p>An <a data-link-type="dfn" href="#shared-storage-database-entry" id="ref-for-shared-storage-database-entry①">entry</a>'s <dfn class="dfn-paneled" data-dfn-for="entry" data-dfn-type="dfn" data-noexport id="entry-value">value</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org#string" id="ref-for-string②">string</a>. <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent①">User agents</a> may specify the maximum length of a <a data-link-type="dfn" href="#entry-value" id="ref-for-entry-value①">value</a>.</p>
   <p>An <a data-link-type="dfn" href="#shared-storage-database-entry" id="ref-for-shared-storage-database-entry②">entry</a>'s <dfn class="dfn-paneled" data-dfn-for="entry" data-dfn-type="dfn" data-noexport id="entry-key">key</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org#string" id="ref-for-string③">string</a>. <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent②">User agents</a> may specify the maximum length of a <a data-link-type="dfn" href="#entry-key" id="ref-for-entry-key①">key</a>. Since <a data-link-type="dfn" href="#entry-key" id="ref-for-entry-key②">keys</a> are used to organize and efficiently retrieve <a data-link-type="dfn" href="#shared-storage-database-entry" id="ref-for-shared-storage-database-entry③">entries</a>, <a data-link-type="dfn" href="#entry-key" id="ref-for-entry-key③">keys</a> must appear at most once on any given <a data-link-type="dfn" href="#shared-storage-shelf" id="ref-for-shared-storage-shelf">shared storage shelf</a> in a <a data-link-type="dfn" href="#shared-storage-database" id="ref-for-shared-storage-database②">database</a>'s <a data-link-type="dfn" href="#shared-storage-shed" id="ref-for-shared-storage-shed①">shared storage shed</a>.</p>
   <p><span class="XXX">TODO: Need to address persistence and expiration, along with <a data-link-type="dfn" href="#shared-storage-database-entry" id="ref-for-shared-storage-database-entry④">entry</a> timestamps. How to monkey-patch timestamps into the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#model" id="ref-for-model">Storage Model</a>?</span></p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="shared-storage-database-queue">shared storage database queue</dfn> for a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context">browsing context</a> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-enqueue" id="ref-for-parallel-enqueue">parallel queue</a> on which the each of the <a data-link-type="dfn" href="#shared-storage-database" id="ref-for-shared-storage-database③">shared storage database</a>'s methods run when calls to them are initiated from that <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context①">browsing context</a>.</p>
   <div class="algorithm" data-algorithm="store an entry in the database" data-algorithm-for="shared storage database">
     To <dfn class="dfn-paneled" data-dfn-for="shared storage database" data-dfn-type="dfn" data-noexport id="shared-storage-database-store-an-entry-in-the-database">store an entry in the database</dfn>, given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context②">browsing context</a> <var>context</var>, a <a data-link-type="dfn" href="#entry-key" id="ref-for-entry-key④">key</a> <var>key</var>, and a <a data-link-type="dfn" href="#entry-value" id="ref-for-entry-value②">value</a> <var>value</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps">enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue">shared storage database queue</a>: 
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#active-window" id="ref-for-active-window">active window</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>databaseMap</var> be the result of running <a data-link-type="dfn" href="#obtain-a-shared-storage-bottle-map" id="ref-for-obtain-a-shared-storage-bottle-map">obtain a shared storage bottle map</a> for <var>environment</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-set" id="ref-for-map-set①">Set</a> <var>databaseMap</var>[<var>key</var>] to <var>value</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="retrieve an entry from the database" data-algorithm-for="shared storage database">
     To <dfn class="dfn-paneled" data-dfn-for="shared storage database" data-dfn-type="dfn" data-noexport id="shared-storage-database-retrieve-an-entry-from-the-database">retrieve an entry from the database</dfn>, given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context③">browsing context</a> <var>context</var> and a <a data-link-type="dfn" href="#entry-key" id="ref-for-entry-key⑤">key</a> <var>key</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①">enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①">shared storage database queue</a>: 
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#active-window" id="ref-for-active-window①">active window</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object②">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>databaseMap</var> be the result of running <a data-link-type="dfn" href="#obtain-a-shared-storage-bottle-map" id="ref-for-obtain-a-shared-storage-bottle-map①">obtain a shared storage bottle map</a> for <var>environment</var>.</p>
     <li data-md>
      <p>If <var>databaseMap</var> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-exists" id="ref-for-map-exists①">contain</a> <var>key</var>, return failure.</p>
     <li data-md>
      <p>Let <var>value</var> be the result of running <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-get" id="ref-for-map-get">Get</a> on <var>databaseMap</var> with <var>key</var>.</p>
     <li data-md>
      <p>Return <var>value</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="delete an entry from the database" data-algorithm-for="shared storage database">
     To <dfn class="dfn-paneled" data-dfn-for="shared storage database" data-dfn-type="dfn" data-noexport id="shared-storage-database-delete-an-entry-from-the-database">delete an entry from the database</dfn>, given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context④">browsing context</a> <var>context</var> and a <a data-link-type="dfn" href="#entry-key" id="ref-for-entry-key⑥">key</a> <var>key</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps②">enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue②">shared storage database queue</a>: 
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#active-window" id="ref-for-active-window②">active window</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object③">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>databaseMap</var> be the result of running <a data-link-type="dfn" href="#obtain-a-shared-storage-bottle-map" id="ref-for-obtain-a-shared-storage-bottle-map②">obtain a shared storage bottle map</a> for <var>environment</var>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-remove" id="ref-for-map-remove">Remove</a> <var>databaseMap</var>[<var>key</var>].</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="clear all entries in the database" data-algorithm-for="shared storage database">
     To <dfn class="dfn-paneled" data-dfn-for="shared storage database" data-dfn-type="dfn" data-noexport id="shared-storage-database-clear-all-entries-in-the-database">clear all entries in the database</dfn>, given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context⑤">browsing context</a> <var>context</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps③">enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue③">shared storage database queue</a>: 
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#active-window" id="ref-for-active-window③">active window</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object④">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>databaseMap</var> be the result of running <a data-link-type="dfn" href="#obtain-a-shared-storage-bottle-map" id="ref-for-obtain-a-shared-storage-bottle-map③">obtain a shared storage bottle map</a> for <var>environment</var>.</p>
     <li data-md>
      <p>Run <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-clear" id="ref-for-map-clear">Clear</a> on <var>databaseMap</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="retrieve all keys from the database" data-algorithm-for="shared storage database">
     To <dfn class="dfn-paneled" data-dfn-for="shared storage database" data-dfn-type="dfn" data-noexport id="shared-storage-database-retrieve-all-keys-from-the-database">retrieve all keys from the database</dfn>, given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context⑥">browsing context</a> <var>context</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps④">enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue④">shared storage database queue</a>: 
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#active-window" id="ref-for-active-window④">active window</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑤">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>databaseMap</var> be the result of running <a data-link-type="dfn" href="#obtain-a-shared-storage-bottle-map" id="ref-for-obtain-a-shared-storage-bottle-map④">obtain a shared storage bottle map</a> for <var>environment</var>.</p>
     <li data-md>
      <p>Let <var>keys</var> be the result of running <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-keys" id="ref-for-map-getting-the-keys">getting the keys</a> on <var>databaseMap</var>.</p>
     <li data-md>
      <p>Return <var>keys</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="retrieve all entries from the database" data-algorithm-for="shared storage database">
     To <dfn class="dfn-paneled" data-dfn-for="shared storage database" data-dfn-type="dfn" data-noexport id="shared-storage-database-retrieve-all-entries-from-the-database">retrieve all entries from the database</dfn>, given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context⑦">browsing context</a> <var>context</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑤">enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue⑤">shared storage database queue</a>: 
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#active-window" id="ref-for-active-window⑤">active window</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑥">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>databaseMap</var> be the result of running <a data-link-type="dfn" href="#obtain-a-shared-storage-bottle-map" id="ref-for-obtain-a-shared-storage-bottle-map⑤">obtain a shared storage bottle map</a> for <var>environment</var>.</p>
     <li data-md>
      <p>Let <var>values</var> be the result of running <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-getting-the-values" id="ref-for-map-getting-the-values">getting the values</a> on <var>databaseMap</var>.</p>
     <li data-md>
      <p>Return <var>values</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="count entries in the database" data-algorithm-for="shared storage database">
     To <dfn class="dfn-paneled" data-dfn-for="shared storage database" data-dfn-type="dfn" data-noexport id="shared-storage-database-count-entries-in-the-database">count entries in the database</dfn>, given a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context" id="ref-for-browsing-context⑧">browsing context</a> <var>context</var>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑥">enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue⑥">shared storage database queue</a>: 
    <ol>
     <li data-md>
      <p>Let <var>environment</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/document-sequences.html#active-window" id="ref-for-active-window⑥">active window</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑦">relevant settings object</a>.</p>
     <li data-md>
      <p>Let <var>databaseMap</var> be the result of running <a data-link-type="dfn" href="#obtain-a-shared-storage-bottle-map" id="ref-for-obtain-a-shared-storage-bottle-map⑥">obtain a shared storage bottle map</a> for <var>environment</var>.</p>
     <li data-md>
      <p>Let <var>count</var> be <var>databaseMap</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-size" id="ref-for-map-size">size</a>.</p>
     <li data-md>
      <p>Return <var>count</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.1" id="monkey-patch"><span class="secno">3.1. </span><span class="content">Monkey Patch for the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#model" id="ref-for-model①">Storage Model</a></span><a class="self-link" href="#monkey-patch"></a></h3>
    After adding a new <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-type" id="ref-for-storage-type">storage type</a> "<code>shared</code>" to the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#model" id="ref-for-model②">Storage Model</a>, this standard will <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#registered-storage-endpoints" id="ref-for-registered-storage-endpoints">register</a> a <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-endpoint" id="ref-for-storage-endpoint">storage endpoint</a> of <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-type" id="ref-for-storage-type①">type</a> "<code>shared</code>" with <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-identifier" id="ref-for-storage-identifier">storage identifier</a> "<code>sharedStorage</code>" and <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-endpoint-quota" id="ref-for-storage-endpoint-quota">quota</a> <code>5</code><sup><code>4</code></sup> <code>*</code> <code>2</code><sup><code>16</code></sup> bytes (i.e. 39.0625 mebibytes). 
   <p><span class="XXX">TODO: This <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-endpoint-quota" id="ref-for-storage-endpoint-quota①">quota</a> is calculated from the current implementation. Consider bringing the current implementation in line with the spec for <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-endpoint" id="ref-for-storage-endpoint①">storage endpoints</a> "<code>localStorage</code>" and "<code>sessionStorage</code>", i.e. <code>5 * 2</code><sup><code>20</code></sup> bytes. For example, decreasing the per-origin entry limit from 10,000 to 1,280 would achieve this.</span></p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent③">user agent</a> holds a <a data-link-type="dfn" href="#shared-storage-shed" id="ref-for-shared-storage-shed②">shared storage shed</a> for <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-endpoint" id="ref-for-storage-endpoint②">storage endpoints</a> of <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-type" id="ref-for-storage-type②">type</a> "<code>shared</code>".</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="shared-storage-shed">shared storage shed</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org#ordered-map" id="ref-for-ordered-map①">map</a> of <a data-link-type="dfn" href="https://url.spec.whatwg.org#concept-url-origin" id="ref-for-concept-url-origin">origins</a> to to <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-shelf" id="ref-for-storage-shelf">storage shelves</a>. It is initially empty.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Unlike <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-shed" id="ref-for-storage-shed">storage sheds</a>, whose keys are <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-key" id="ref-for-storage-key">storage keys</a>, <a data-link-type="dfn" href="#shared-storage-shed" id="ref-for-shared-storage-shed③">shared storage sheds</a> use <a data-link-type="dfn" href="https://url.spec.whatwg.org#concept-url-origin" id="ref-for-concept-url-origin①">origins</a> as keys directly. <a data-link-type="dfn" href="#shared-storage" id="ref-for-shared-storage①">Shared storage</a> will be intentionally excluded from <a data-link-type="dfn" href="https://privacycg.github.io/storage-partitioning/#client-side-storage-partitioning" id="ref-for-client-side-storage-partitioning①">client-side storage partitioning</a>.</p>
   <p>A <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent④">user agent</a>'s <a data-link-type="dfn" href="#shared-storage-shed" id="ref-for-shared-storage-shed④">shared storage shed</a> holds all <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="shared-storage">shared storage</dfn> data.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="shared-storage-shelf">shared storage shelf</dfn> is a <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-shelf" id="ref-for-storage-shelf①">storage shelf</a> in a <a data-link-type="dfn" href="#shared-storage-shed" id="ref-for-shared-storage-shed⑤">shared storage shed</a>.</p>
   <div class="algorithm" data-algorithm="obtain a shared storage shelf">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-shared-storage-shelf">obtain a shared storage shelf</dfn>, given a <a data-link-type="dfn" href="#shared-storage-shed" id="ref-for-shared-storage-shed⑥">shared storage shed</a> <var>shed</var> and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object①">environment settings object</a> <var>environment</var>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>origin</var> be <var>environment</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org#concept-url-origin" id="ref-for-concept-url-origin②">origin</a>.</p>
     <li data-md>
      <p>If <var>origin</var> is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-opaque-origin" id="ref-for-concept-opaque-origin">opaque origin</a>, then return failure.</p>
     <li data-md>
      <p>If the user has disabled <a data-link-type="dfn" href="#shared-storage" id="ref-for-shared-storage②">shared storage</a>, then return failure.</p>
     <li data-md>
      <p>If <var>shed</var>[origin] does not exist, then set <var>shed</var>[origin] to the result of running <a data-link-type="dfn" href="#create-a-shared-storage-shelf" id="ref-for-create-a-shared-storage-shelf">create a shared storage shelf</a> with <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-type" id="ref-for-storage-type③">type</a> "<code>shared</code>".</p>
     <li data-md>
      <p>Return <var>shed</var>[<var>origin</var>].</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="create a shared storage shelf">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-shared-storage-shelf">create a shared storage shelf</dfn>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>shelf</var> be a new <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-shelf" id="ref-for-storage-shelf②">storage shelf</a>.</p>
     <li data-md>
      <p>Set <var>shelf</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map">bucket map</a>["<code>default</code>"] to the result of running <a data-link-type="dfn" href="#create-a-shared-storage-bucket" id="ref-for-create-a-shared-storage-bucket">create a shared storage bucket</a>.</p>
     <li data-md>
      <p>Return <var>shelf</var>.</p>
    </ol>
   </div>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="shared-storage-bucket">shared storage bucket</dfn> is a <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bucket" id="ref-for-storage-bucket">storage bucket</a> in a <a data-link-type="dfn" href="#shared-storage-shelf" id="ref-for-shared-storage-shelf①">shared storage shelf</a>.</p>
   <div class="algorithm" data-algorithm="create a shared storage bucket">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-shared-storage-bucket">create a shared storage bucket</dfn>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>endpoint</var> be the <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-endpoint" id="ref-for-storage-endpoint③">storage endpoint</a> with <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-identifier" id="ref-for-storage-identifier①">storage identifier</a> "<code>sharedStorage</code>".</p>
     <li data-md>
      <p>Let <var>bucket</var> be a new <a data-link-type="dfn" href="#shared-storage-bucket" id="ref-for-shared-storage-bucket">shared storage bucket</a>.</p>
     <li data-md>
      <p>Set <var>bucket</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bottle-map" id="ref-for-bottle-map">bottle map</a>["<code>sharedStorage</code>"] to a new <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bottle" id="ref-for-storage-bottle">storage bottle</a> whose <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bottle-quota" id="ref-for-storage-bottle-quota">quota</a> is <var>endpoint</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-endpoint-quota" id="ref-for-storage-endpoint-quota②">quota</a>.</p>
     <li data-md>
      <p>Return <var>bucket</var>.</p>
    </ol>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> Currently, a <a data-link-type="dfn" href="#shared-storage-bucket" id="ref-for-shared-storage-bucket①">shared storage bucket</a>'s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bottle-map" id="ref-for-bottle-map①">bottle map</a> has <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-size" id="ref-for-map-size①">size</a> <code>1</code>, since there is only one <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-endpoint" id="ref-for-storage-endpoint④">storage endpoint</a> <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#registered-storage-endpoints" id="ref-for-registered-storage-endpoints①">registered</a> with <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-type" id="ref-for-storage-type④">type</a> "<code>shared</code>".</p>
   <div class="algorithm" data-algorithm="obtain a shared storage bottle map">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-a-shared-storage-bottle-map">obtain a shared storage bottle map</dfn>, given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object②">environment settings object</a> <var>environment</var>, run these steps: 
    <ol>
     <li data-md>
      <p>Let <var>shed</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent⑤">user agent</a>'s <a data-link-type="dfn" href="#shared-storage-shed" id="ref-for-shared-storage-shed⑦">shared storage shed</a>.</p>
     <li data-md>
      <p>Let <var>shelf</var> be the result of running <a data-link-type="dfn" href="#obtain-a-shared-storage-shelf" id="ref-for-obtain-a-shared-storage-shelf">obtain a shared storage shelf</a> with <var>shed</var> and <var>environment</var>.</p>
     <li data-md>
      <p>If <var>shelf</var> is failure, then return failure.</p>
     <li data-md>
      <p>Let <var>bucket</var> be <var>shelf</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bucket-map" id="ref-for-bucket-map①">bucket map</a>["<code>default</code>"].</p>
     <li data-md>
      <p>Let <var>bottle</var> be <var>bucket</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#bottle-map" id="ref-for-bottle-map②">bottle map</a>["<code>sharedStorage</code>"].</p>
     <li data-md>
      <p>Let <var>proxyMap</var> be a new <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-proxy-map" id="ref-for-storage-proxy-map">storage proxy map</a> whose <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-proxy-map-backing-map" id="ref-for-storage-proxy-map-backing-map">backing map</a> is <var>bottle</var>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org#ordered-map" id="ref-for-ordered-map②">map</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org#set-append" id="ref-for-set-append">Append</a> <var>proxyMap</var> to <var>bottle</var>’s <a data-link-type="dfn" href="https://storage.spec.whatwg.org/#storage-bottle-proxy-map-reference-set" id="ref-for-storage-bottle-proxy-map-reference-set">proxy map reference set</a>.</p>
     <li data-md>
      <p>Return <var>proxyMap</var>.</p>
    </ol>
   </div>
   <p><span class="XXX">TODO: Use <a data-link-type="dfn" href="#obtain-a-shared-storage-bottle-map" id="ref-for-obtain-a-shared-storage-bottle-map⑦">obtain a shared storage bottle map</a> below.</span></p>
   <h2 class="heading settled" data-level="4" id="shared-storage-interface"><span class="secno">4. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#sharedstorage" id="ref-for-sharedstorage">SharedStorage</a></code> Interface</span><a class="self-link" href="#shared-storage-interface"></a></h2>
    The <code class="idl"><a data-link-type="idl" href="#sharedstorage" id="ref-for-sharedstorage①">SharedStorage</a></code> interface is the base for derived interfaces <code class="idl"><a data-link-type="idl" href="#windowsharedstorage" id="ref-for-windowsharedstorage">WindowSharedStorage</a></code> and <code class="idl"><a data-link-type="idl" href="#workletsharedstorage" id="ref-for-workletsharedstorage">WorkletSharedStorage</a></code>, which are exposed to the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window">Window</a></code> and the <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑤">SharedStorageWorklet</a></code>, respectively. 
   <p>Methods that allow the setting and/or deleting of data are exposed to both the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window①">Window</a></code> and the <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑥">SharedStorageWorklet</a></code> and hence are declared in the base <code class="idl"><a data-link-type="idl" href="#sharedstorage" id="ref-for-sharedstorage②">SharedStorage</a></code> interface, although their implementations may vary depending on their <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment" id="ref-for-environment">environment</a>. This makes it possible to modify the data in Shared Storage from multiple contexts.</p>
   <p>Meanwhile, methods for running <code class="idl"><a data-link-type="idl" href="#sharedstorageoperation" id="ref-for-sharedstorageoperation⑦">SharedStorageOperation</a></code>s, along with the <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-worklet" id="ref-for-dom-windowsharedstorage-worklet">worklet</a></code> attribute which is used to call <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule">addModule()</a></code>, are declared in <code class="idl"><a data-link-type="idl" href="#windowsharedstorage" id="ref-for-windowsharedstorage①">WindowSharedStorage</a></code> and exposed to the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window②">Window</a></code> only, as these are the means by which the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window③">Window</a></code> interacts with the <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑦">SharedStorageWorklet</a></code>.</p>
   <p>On the other hand, methods for getting data from the <a data-link-type="dfn" href="#shared-storage-database" id="ref-for-shared-storage-database④">shared storage database</a> are declared in <code class="idl"><a data-link-type="idl" href="#workletsharedstorage" id="ref-for-workletsharedstorage①">WorkletSharedStorage</a></code> and exposed to the <code class="idl"><a data-link-type="idl" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑧">SharedStorageWorklet</a></code> only, in order to carefully control the flow of data read from the <a data-link-type="dfn" href="#shared-storage-database" id="ref-for-shared-storage-database⑤">database</a>.</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑤"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorage"><code><c- g>SharedStorage</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise②"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any"><c- b>any</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export data-lt="set(key, value, options)|set(key, value)" id="dom-sharedstorage-set"><code><c- g>set</c-></code><a class="self-link" href="#dom-sharedstorage-set"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/set(key, value, options), SharedStorage/set(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-set-key-value-options-key"><code><c- g>key</c-></code><a class="self-link" href="#dom-sharedstorage-set-key-value-options-key"></a></dfn>,
                   <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/set(key, value, options), SharedStorage/set(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-set-key-value-options-value"><code><c- g>value</c-></code><a class="self-link" href="#dom-sharedstorage-set-key-value-options-value"></a></dfn>,
                   <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragesetmethodoptions" id="ref-for-dictdef-sharedstoragesetmethodoptions"><c- n>SharedStorageSetMethodOptions</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/set(key, value, options), SharedStorage/set(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-set-key-value-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-sharedstorage-set-key-value-options-options"></a></dfn> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise③"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any①"><c- b>any</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export data-lt="append(key, value)" id="dom-sharedstorage-append"><code><c- g>append</c-></code><a class="self-link" href="#dom-sharedstorage-append"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/append(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-append-key-value-key"><code><c- g>key</c-></code><a class="self-link" href="#dom-sharedstorage-append-key-value-key"></a></dfn>,
                      <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString④"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/append(key, value)" data-dfn-type="argument" data-export id="dom-sharedstorage-append-key-value-value"><code><c- g>value</c-></code><a class="self-link" href="#dom-sharedstorage-append-key-value-value"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise④"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any②"><c- b>any</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export data-lt="delete(key)" id="dom-sharedstorage-delete"><code><c- g>delete</c-></code><a class="self-link" href="#dom-sharedstorage-delete"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑤"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorage/delete(key)" data-dfn-type="argument" data-export id="dom-sharedstorage-delete-key-key"><code><c- g>key</c-></code><a class="self-link" href="#dom-sharedstorage-delete-key-key"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑤"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any③"><c- b>any</c-></a>> <dfn class="idl-code" data-dfn-for="SharedStorage" data-dfn-type="method" data-export data-lt="clear()" id="dom-sharedstorage-clear"><code><c- g>clear</c-></code><a class="self-link" href="#dom-sharedstorage-clear"></a></dfn>();
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sharedstoragesetmethodoptions"><code><c- g>SharedStorageSetMethodOptions</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageSetMethodOptions" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-sharedstoragesetmethodoptions-ignoreifpresent"><code><c- g>ignoreIfPresent</c-></code><a class="self-link" href="#dom-sharedstoragesetmethodoptions-ignoreifpresent"></a></dfn>;
};
</pre>
   <h3 class="heading settled" data-level="4.1" id="window"><span class="secno">4.1. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#windowsharedstorage" id="ref-for-windowsharedstorage②">WindowSharedStorage</a></code> interface</span><a class="self-link" href="#window"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑥"><c- g>Exposed</c-></a>=(<c- n>Window</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="windowsharedstorage"><code><c- g>WindowSharedStorage</c-></code></dfn> : <a data-link-type="idl-name" href="#sharedstorage" id="ref-for-sharedstorage③"><c- n>SharedStorage</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑥"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any" id="ref-for-idl-any④"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-windowsharedstorage-run" id="ref-for-dom-windowsharedstorage-run"><c- g>run</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑥"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="WindowSharedStorage/run(name, options), WindowSharedStorage/run(name)" data-dfn-type="argument" data-export id="dom-windowsharedstorage-run-name-options-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-windowsharedstorage-run-name-options-name"></a></dfn>,
                   <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragerunoperationmethodoptions" id="ref-for-dictdef-sharedstoragerunoperationmethodoptions"><c- n>SharedStorageRunOperationMethodOptions</c-></a> <dfn class="idl-code" data-dfn-for="WindowSharedStorage/run(name, options), WindowSharedStorage/run(name)" data-dfn-type="argument" data-export id="dom-windowsharedstorage-run-name-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-windowsharedstorage-run-name-options-options"></a></dfn> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑦"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-windowsharedstorage-selecturl" id="ref-for-dom-windowsharedstorage-selecturl①"><c- g>selectURL</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑦"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="WindowSharedStorage/selectURL(name, urls, options), WindowSharedStorage/selectURL(name, urls)" data-dfn-type="argument" data-export id="dom-windowsharedstorage-selecturl-name-urls-options-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-windowsharedstorage-selecturl-name-urls-options-name"></a></dfn>,
                               <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array" id="ref-for-idl-frozen-array①"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-sharedstorageurlwithmetadata" id="ref-for-dictdef-sharedstorageurlwithmetadata②"><c- n>SharedStorageUrlWithMetadata</c-></a>> <dfn class="idl-code" data-dfn-for="WindowSharedStorage/selectURL(name, urls, options), WindowSharedStorage/selectURL(name, urls)" data-dfn-type="argument" data-export id="dom-windowsharedstorage-selecturl-name-urls-options-urls"><code><c- g>urls</c-></code><a class="self-link" href="#dom-windowsharedstorage-selecturl-name-urls-options-urls"></a></dfn>,
                               <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragerunoperationmethodoptions" id="ref-for-dictdef-sharedstoragerunoperationmethodoptions①"><c- n>SharedStorageRunOperationMethodOptions</c-></a> <dfn class="idl-code" data-dfn-for="WindowSharedStorage/selectURL(name, urls, options), WindowSharedStorage/selectURL(name, urls)" data-dfn-type="argument" data-export id="dom-windowsharedstorage-selecturl-name-urls-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-windowsharedstorage-selecturl-name-urls-options-options"></a></dfn> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#sharedstorageworklet" id="ref-for-sharedstorageworklet⑨"><c- n>SharedStorageWorklet</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WindowSharedStorage" data-dfn-type="attribute" data-export data-readonly data-type="SharedStorageWorklet" id="dom-windowsharedstorage-worklet"><code><c- g>worklet</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-sharedstoragerunoperationmethodoptions"><code><c- g>SharedStorageRunOperationMethodOptions</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object④"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageRunOperationMethodOptions" data-dfn-type="dict-member" data-export data-type="object " id="dom-sharedstoragerunoperationmethodoptions-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-sharedstoragerunoperationmethodoptions-data"></a></dfn>;
};
</pre>
   <h4 class="heading settled" data-level="4.1.1" id="window-setter"><span class="secno">4.1.1. </span><span class="content">Window Setter/Deleter Methods</span><a class="self-link" href="#window-setter"></a></h4>
   <div class="algorithm" data-algorithm="set(key, value, options)" data-algorithm-for="WindowSharedStorage">
     The <dfn class="idl-code" data-dfn-for="WindowSharedStorage" data-dfn-type="method" data-export id="dom-windowsharedstorage-set"><code>set(<var>key</var>, <var>value</var>, <var>options</var>)</code><a class="self-link" href="#dom-windowsharedstorage-set"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#windowsharedstorage" id="ref-for-windowsharedstorage③">WindowSharedStorage</a></code>'s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window④">Window</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#window-bc" id="ref-for-window-bc">browsing context</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑦">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue⑦">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>value</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror①">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>options</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror②">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>options</var> is empty, create <var>options</var> with <var>options</var>["<code>ignoreIfPresent</code>"] set to false.</p>
       <li data-md>
        <p>If <var>options</var>["<code>ignoreIfPresent</code>"] is true:</p>
        <ol>
         <li data-md>
          <p>Let <var>currentValue</var> be the result of running <a data-link-type="dfn" href="#shared-storage-database-retrieve-an-entry-from-the-database" id="ref-for-shared-storage-database-retrieve-an-entry-from-the-database①">retrieve an entry from the database</a> with <var>context</var> and <var>key</var>.</p>
         <li data-md>
          <p>If <var>currentValue</var> is not failure, resolve <var>promise</var> as undefined.</p>
         <li data-md>
          <p>Otherwise, run <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database①">store an entry in the database</a> with <var>context</var>, <var>key</var>, and <var>value</var>.</p>
         <li data-md>
          <p>Resolve <var>promise</var> as undefined.</p>
        </ol>
       <li data-md>
        <p>Otherwise, run <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database②">store an entry in the database</a> with <var>context</var>, <var>key</var>, and <var>value</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="append(key, value)" data-algorithm-for="WindowSharedStorage">
     The <dfn class="idl-code" data-dfn-for="WindowSharedStorage" data-dfn-type="method" data-export id="dom-windowsharedstorage-append"><code>append(<var>key</var>, <var>value</var>)</code><a class="self-link" href="#dom-windowsharedstorage-append"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#windowsharedstorage" id="ref-for-windowsharedstorage④">WindowSharedStorage</a></code>'s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑤">Window</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#window-bc" id="ref-for-window-bc①">browsing context</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑧">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue⑧">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror③">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>value</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror④">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
       <li data-md>
        <p>Let <var>currentValue</var> be the result of running <a data-link-type="dfn" href="#shared-storage-database-retrieve-an-entry-from-the-database" id="ref-for-shared-storage-database-retrieve-an-entry-from-the-database②">retrieve an entry from the database</a> with <var>context</var> and <var>key</var>.</p>
       <li data-md>
        <p>If <var>currentValue</var> is not failure:</p>
        <ol>
         <li data-md>
          <p>Let <var>list</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org#list" id="ref-for-list①">list</a>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org#list-append" id="ref-for-list-append">Append</a> <var>currentValue</var> to <var>list</var>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org#list-append" id="ref-for-list-append①">Append</a> <var>value</var> to <var>list</var>.</p>
         <li data-md>
          <p>Let <var>newValue</var> be the result of running <a data-link-type="dfn" href="https://infra.spec.whatwg.org#string-concatenate" id="ref-for-string-concatenate">concatenate</a> on <var>list</var>.</p>
         <li data-md>
          <p>Run <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database③">store an entry in the database</a> with <var>context</var>, <var>key</var>, and <var>newValue</var>.</p>
         <li data-md>
          <p>Resolve <var>promise</var> as undefined.</p>
        </ol>
       <li data-md>
        <p>Otherwise, run <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database④">store an entry in the database</a> with <var>context</var>, <var>key</var>, and <var>value</var>..</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="delete(key)" data-algorithm-for="WindowSharedStorage">
     The <dfn class="idl-code" data-dfn-for="WindowSharedStorage" data-dfn-type="method" data-export id="dom-windowsharedstorage-delete"><code>delete(<var>key</var>)</code><a class="self-link" href="#dom-windowsharedstorage-delete"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#windowsharedstorage" id="ref-for-windowsharedstorage⑤">WindowSharedStorage</a></code>'s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑥">Window</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#window-bc" id="ref-for-window-bc②">browsing context</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps⑨">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue⑨">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror⑤">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
       <li data-md>
        <p>Run <a data-link-type="dfn" href="#shared-storage-database-delete-an-entry-from-the-database" id="ref-for-shared-storage-database-delete-an-entry-from-the-database①">delete an entry from the database</a> with <var>context</var> and <var>key</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="clear()" data-algorithm-for="WindowSharedStorage">
     The <dfn class="idl-code" data-dfn-for="WindowSharedStorage" data-dfn-type="method" data-export id="dom-windowsharedstorage-clear"><code>clear()</code><a class="self-link" href="#dom-windowsharedstorage-clear"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#windowsharedstorage" id="ref-for-windowsharedstorage⑥">WindowSharedStorage</a></code>'s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑦">Window</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#window-bc" id="ref-for-window-bc③">browsing context</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①⓪">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①⓪">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>Run <a data-link-type="dfn" href="#shared-storage-database-clear-all-entries-in-the-database" id="ref-for-shared-storage-database-clear-all-entries-in-the-database①">clear all entries in the database</a> with <var>context</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.1.2" id="budget"><span class="secno">4.1.2. </span><span class="content">Entropy Budget</span><a class="self-link" href="#budget"></a></h4>
   <p>Because <a data-link-type="dfn" href="https://en.wikipedia.org/wiki/Entropy_(information_theory)#bits-of-entropy" id="ref-for-bits-of-entropy">bits of entropy</a> can leak via <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-selecturl" id="ref-for-dom-windowsharedstorage-selecturl②">selectURL()</a></code> if a user activates the fenced frame that navigates to the resulting <a data-link-type="dfn" href="https://github.com/WICG/fenced-frame/blob/master/explainer/opaque_src.md#opaque-url" id="ref-for-opaque-url">opaque URL</a>, there is a per-<a data-link-type="dfn" href="#calling-origin" id="ref-for-calling-origin">calling origin</a> <a data-link-type="dfn" href="#entropy-allowance" id="ref-for-entropy-allowance">entropy allowance</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="calling-origin">calling origin</dfn> for <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-selecturl" id="ref-for-dom-windowsharedstorage-selecturl③">selectURL()</a></code> is the <a data-link-type="dfn" href="https://url.spec.whatwg.org#concept-url-origin" id="ref-for-concept-url-origin③">origin</a> of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment" id="ref-for-environment①">environment</a> that makes a <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-selecturl" id="ref-for-dom-windowsharedstorage-selecturl④">selectURL()</a></code> call.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="entropy-allowance">entropy allowance</dfn> is a maximum allowance of <a data-link-type="dfn" href="https://en.wikipedia.org/wiki/Entropy_(information_theory)#entropy-bits" id="ref-for-entropy-bits">entropy bits</a> that are permitted to leak during a given <a data-link-type="dfn" href="#epoch" id="ref-for-epoch">epoch</a> and for a given calling <a data-link-type="dfn" href="#calling-origin" id="ref-for-calling-origin①">calling origin</a>. This <a data-link-type="dfn" href="#entropy-allowance" id="ref-for-entropy-allowance①">allowance</a> is defined by the <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent⑥">user agent</a> and is <a data-link-type="dfn" href="#calling-origin" id="ref-for-calling-origin②">calling origin</a>-agnostic.</p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="epoch">epoch</dfn> is a time period whose duration is a fixed pretermined length.</p>
   <p>To keep track of how this <a data-link-type="dfn" href="#entropy-allowance" id="ref-for-entropy-allowance②">entropy allowance</a> is used, Shared Storage uses a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="budget-table">budget table</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org#ordered-map" id="ref-for-ordered-map③">map</a> of <a data-link-type="dfn" href="#calling-origin" id="ref-for-calling-origin③">calling origins</a> to <a data-link-type="dfn" href="#entropy-ledger" id="ref-for-entropy-ledger">entropy ledgers</a>.</p>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="entropy-ledger">entropy ledger</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org#list" id="ref-for-list②">list</a> of <a data-link-type="dfn" href="#bit-debit" id="ref-for-bit-debit">bit debits</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="bit-debit">bit debit</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org#struct" id="ref-for-struct">struct</a> containing a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double">double</a></code> indicating a value in <a data-link-type="dfn" href="https://en.wikipedia.org/wiki/Entropy_(information_theory)#entropy-bits" id="ref-for-entropy-bits①">entropy bits</a> along with a timestamp</p>
   <p>When a leak occurs, its value in <a data-link-type="dfn" href="https://en.wikipedia.org/wiki/Entropy_(information_theory)#entropy-bits" id="ref-for-entropy-bits②">entropy bits</a> is calculated and stored for that <a data-link-type="dfn" href="#calling-origin" id="ref-for-calling-origin④">calling origin</a> along with the current time as a <a data-link-type="dfn" href="#bit-debit" id="ref-for-bit-debit①">bit debit</a> in the <a data-link-type="dfn" href="#budget-table" id="ref-for-budget-table">budget table</a>.</p>
   <p>Only <a data-link-type="dfn" href="#bit-debit" id="ref-for-bit-debit②">bit debits</a> whose timestamps are within the current <a data-link-type="dfn" href="#epoch" id="ref-for-epoch①">epoch</a> are used to <a data-link-type="dfn" href="#determine-remaining-budget" id="ref-for-determine-remaining-budget">determine remaining budget</a>. When an <a data-link-type="dfn" href="#calling-origin" id="ref-for-calling-origin⑤">calling origin</a> has insufficient remaining budget, <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-selecturl" id="ref-for-dom-windowsharedstorage-selecturl⑤">selectURL()</a></code> will return its <a data-link-type="dfn" href="#default-value" id="ref-for-default-value">default value</a>.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="default-value">default value</dfn> for a call to <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-selecturl" id="ref-for-dom-windowsharedstorage-selecturl⑥">selectURL()</a></code> is implementation-defined in such a way that it is independent from the result of the associated <code class="idl"><a data-link-type="idl" href="#sharedstorageselecturloperation" id="ref-for-sharedstorageselecturloperation②">SharedStorageSelectURLOperation</a></code>'s "<code>run</code>" method.</p>
   <div class="algorithm" data-algorithm="determine remaining budget">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="determine-remaining-budget">determine remaining budget</dfn>, given a calling <a data-link-type="dfn" href="#calling-origin" id="ref-for-calling-origin⑥">calling origin</a> <var>origin</var>, run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>maxBits</var> be the value of the <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent⑦">user agent</a>'s <a data-link-type="dfn" href="#entropy-allowance" id="ref-for-entropy-allowance③">entropy allowance</a>.</p>
     <li data-md>
      <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org#user-agent" id="ref-for-user-agent⑧">user agent</a>'s <a data-link-type="dfn" href="#budget-table" id="ref-for-budget-table①">budget table</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-exists" id="ref-for-map-exists②">contain</a> <var>origin</var>, then return <var>maxBits</var>.</p>
     <li data-md>
      <p>Otherwise, let <var>ledger</var> be <a data-link-type="dfn" href="#budget-table" id="ref-for-budget-table②">budget table</a>[<var>origin</var>].</p>
     <li data-md>
      <p>Let <var>time</var> be the current time.</p>
     <li data-md>
      <p>Let <var>epochLength</var> be the length of an <a data-link-type="dfn" href="#epoch" id="ref-for-epoch②">epoch</a>.</p>
     <li data-md>
      <p>Let <var>threshold</var> be <var>time</var> - <var>epochLength</var>.</p>
     <li data-md>
      <p>Let <var>debitSum</var> be 0.</p>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="https://infra.spec.whatwg.org#list-item" id="ref-for-list-item">item</a> <var>item</var> in <var>ledger</var>, do the following steps:</p>
      <ol>
       <li data-md>
        <p>Let <var>timeStamp</var> be <var>item</var>’s timestamp.</p>
       <li data-md>
        <p>Let <var>debit</var> be <var>item</var>’s value in <a data-link-type="dfn" href="https://en.wikipedia.org/wiki/Entropy_(information_theory)#entropy-bits" id="ref-for-entropy-bits③">entropy bits</a>.</p>
       <li data-md>
        <p>If <var>timeStamp</var> >= <var>threshold</var>, then add <var>debit</var> to <var>debitSum</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>maxBits</var> - <var>debitSum</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.1.3" id="run-op"><span class="secno">4.1.3. </span><span class="content">Run Operation Methods</span><a class="self-link" href="#run-op"></a></h4>
   <div class="algorithm" data-algorithm="run(name, options)" data-algorithm-for="WindowSharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowSharedStorage" data-dfn-type="method" data-export data-lt="run(name, options)|run(name)" id="dom-windowsharedstorage-run"><code>run(<var>name</var>, <var>options</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>If <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule①">addModule()</a></code> has not yet been called, reject <var>promise</var>.</p>
       <li data-md>
        <p>Let <var>outsideSettings</var> be <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-worklet" id="ref-for-dom-windowsharedstorage-worklet①">worklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑧">relevant settings object</a>.</p>
       <li data-md>
        <p>Let <var>agent</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#obtain-a-worklet-agent" id="ref-for-obtain-a-worklet-agent">obtaining a worklet agent</a> given <var>outsideSettings</var>. Run the rest of these steps in <var>agent</var>.</p>
       <li data-md>
        <p>If <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-worklet" id="ref-for-dom-windowsharedstorage-worklet②">worklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#module-map" id="ref-for-module-map①">module map</a> is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-is-empty" id="ref-for-map-is-empty">empty</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>operationMap</var> be this <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope⑤">SharedStorageWorkletGlobalScope</a></code>'s <a data-link-type="dfn" href="#sharedstorageworkletglobalscope-operation-map" id="ref-for-sharedstorageworkletglobalscope-operation-map①">operation map</a>.</p>
         <li data-md>
          <p>Let <var>operation</var> be the operation registered to <var>name</var> in <var>operationMap</var>, if <var>operation</var> exists.</p>
         <li data-md>
          <p>If <var>operation</var> exists:</p>
          <ol>
           <li data-md>
            <p>If <var>options</var> contains <var>data</var>, invoke <var>operation</var> with argument <var>data</var>.</p>
           <li data-md>
            <p>Otherwise, invoke <var>operation</var> with an empty argument list.</p>
          </ol>
        </ol>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="selectURL(name, urls, options)" data-algorithm-for="WindowSharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="WindowSharedStorage" data-dfn-type="method" data-export data-lt="selectURL(name, urls, options)|selectURL(name, urls)" id="dom-windowsharedstorage-selecturl"><code>selectURL(<var>name</var>, <var>urls</var>, <var>options</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>configPromise</var> be a new promise.</p>
     <li data-md>
      <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>urls</var> is empty or exceeds the maximum allowed length, reject <var>configPromise</var>.</p>
       <li data-md>
        <p>Let <var>urlList</var> be an empty <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/input.html#dom-input-list" id="ref-for-dom-input-list">list</a></code>.</p>
       <li data-md>
        <p>For each <var>urlWithMetadata</var> in <var>urls</var>:</p>
        <ol>
         <li data-md>
          <p>If <var>urlWithMetadata</var> has no field "<code>url</code>", reject <var>configPromise</var>.</p>
         <li data-md>
          <p>Otherwise, let <var>urlString</var> be <var>urlWithMetadata</var>["<code>url</code>"].</p>
         <li data-md>
          <p>Let <var>url</var> be the result of running a <a data-link-type="dfn" href="https://url.spec.whatwg.org#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on <var>urlString</var>.</p>
         <li data-md>
          <p>If <var>url</var> is not a valid <code class="idl"><a data-link-type="idl" href="https://url.spec.whatwg.org/#url" id="ref-for-url②">URL</a></code>, reject <var>configPromise</var>.</p>
         <li data-md>
          <p>Otherwise, <a data-link-type="dfn" href="https://infra.spec.whatwg.org#list-append" id="ref-for-list-append②">append</a> <var>urlString</var> to <var>urlList</var>.</p>
         <li data-md>
          <p>If <var>urlWithMetadata</var> has field "<code>reportingMetadata</code>":</p>
          <ol>
           <li data-md>
            <p>Let <var>reportingMetadata</var> be <var>urlWithMetadata</var>["<code>reportingMetadata</code>"].</p>
           <li data-md>
            <p>If <var>reportingMetadata</var> is invalid, reject <var>configPromise</var>.</p>
          </ol>
        </ol>
       <li data-md>
        <p>If <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule" id="ref-for-dom-worklet-addmodule②">addModule()</a></code> has not yet been called, reject <var>configPromise</var>.</p>
       <li data-md>
        <p>Let <var>pendingUrl</var> be a newly generated <a data-link-type="dfn" href="https://www.rfc-editor.org/rfc/rfc4122#urnuuid" id="ref-for-urnuuid">urn:uuid</a>.</p>
       <li data-md>
        <p>Let <var>fencedFrameConfig</var> be a <a data-link-type="dfn" href="https://wicg.github.io/fenced-frame/#fencedframeconfig" id="ref-for-fencedframeconfig">FencedFrameConfig</a> constructed from <var>pendingUrl</var>.</p>
       <li data-md>
        <p>Resolve <var>configPromise</var> as <var>fencedFrameConfig</var>.</p>
       <li data-md>
        <p>Let <var>indexPromise</var> be a new promise.</p>
       <li data-md>
        <p>Let <var>outsideSettings</var> be <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-worklet" id="ref-for-dom-windowsharedstorage-worklet③">worklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object⑨">relevant settings object</a>.</p>
       <li data-md>
        <p>Let <var>agent</var> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#obtain-a-worklet-agent" id="ref-for-obtain-a-worklet-agent①">obtaining a worklet agent</a> given <var>outsideSettings</var>. Run the following steps in <var>agent</var>:</p>
        <ol>
         <li data-md>
          <p>Let <var>index</var> be 0.</p>
         <li data-md>
          <p>If <code class="idl"><a data-link-type="idl" href="#dom-windowsharedstorage-worklet" id="ref-for-dom-windowsharedstorage-worklet④">worklet</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#module-map" id="ref-for-module-map②">module map</a> is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-is-empty" id="ref-for-map-is-empty①">empty</a>:</p>
          <ol>
           <li data-md>
            <p>Let <var>operationMap</var> be the associated <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope⑥">SharedStorageWorkletGlobalScope</a></code>'s <a data-link-type="dfn" href="#sharedstorageworkletglobalscope-operation-map" id="ref-for-sharedstorageworkletglobalscope-operation-map②">operation map</a>.</p>
           <li data-md>
            <p>If <var>operationMap</var> <a data-link-type="dfn" href="https://infra.spec.whatwg.org#map-exists" id="ref-for-map-exists③">contains</a> <var>name</var>:</p>
            <ol>
             <li data-md>
              <p>Let <var>operation</var> be <var>operationMap</var>[<var>name</var>].</p>
             <li data-md>
              <p>If <var>options</var> contains <var>data</var>, let <var>operationResult</var> be the result of invoking <var>operation</var> with arguments <var>urlList</var> and <var>data</var>.</p>
             <li data-md>
              <p>Otherwise, let <var>operationResult</var> be the result of invoking <var>operation</var> with argument <var>urlList</var>.</p>
             <li data-md>
              <p>If there are no errors:</p>
              <ol>
               <li data-md>
                <p>Set <var>index</var> to the result of casting <var>operationResult</var> to an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long">unsigned long</a></code>. If this throws an exception, catch it and set <var>index</var> back to 0.</p>
               <li data-md>
                <p>If <var>index</var> > <var>urlList</var>.<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a>, then set <var>index</var> back to 0.</p>
              </ol>
            </ol>
          </ol>
         <li data-md>
          <p>Resolve <var>indexPromise</var> with <var>index</var>.</p>
        </ol>
       <li data-md>
        <p><a data-link-type="dfn" href="https://webidl.spec.whatwg.org#upon-fulfillment" id="ref-for-upon-fulfillment">Upon fulfillment</a> of <var>indexPromise</var>, perform the following steps:</p>
        <ol>
         <li data-md>
          <p>Let <var>resultIndex</var> be its numerical value.</p>
         <li data-md>
          <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#windowsharedstorage" id="ref-for-windowsharedstorage⑦">WindowSharedStorage</a></code>'s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window" id="ref-for-window⑧">Window</a></code>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#window-bc" id="ref-for-window-bc④">browsing context</a>.</p>
         <li data-md>
          <p>Let <var>origin</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#active-document" id="ref-for-active-document">active document</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org#concept-url-origin" id="ref-for-concept-url-origin④">origin</a>.</p>
         <li data-md>
          <p>Let <var>remainingBudget</var> be the result of running <a data-link-type="dfn" href="#determine-remaining-budget" id="ref-for-determine-remaining-budget①">determine remaining budget</a> with <var>origin</var>.</p>
         <li data-md>
          <p>Let <var>currentDebit</var> be log_2(<var>urlList</var>.<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a>).</p>
         <li data-md>
          <p>If <var>currentDebit</var> > <var>remainingBudget</var>, set <var>resultIndex</var> to 0.</p>
         <li data-md>
          <p>Store <var>currentDebit</var> so that it can be withdrawn from the database in the event of a frame created from <var>fencedFrameConfig</var> triggering a top-frame navigation.</p>
         <li data-md>
          <p>Internally map <var>pendingUrl</var> to <var>urlList</var>[<var>resultIndex</var>].</p>
        </ol>
      </ol>
     <li data-md>
      <p>Return <var>configPromise</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.2" id="worklet-shared-storage"><span class="secno">4.2. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#workletsharedstorage" id="ref-for-workletsharedstorage②">WorkletSharedStorage</a></code> interface</span><a class="self-link" href="#worklet-shared-storage"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑦"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="workletsharedstorage"><code><c- g>WorkletSharedStorage</c-></code></dfn> : <a data-link-type="idl-name" href="#sharedstorage" id="ref-for-sharedstorage④"><c- n>SharedStorage</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑧"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑧"><c- b>DOMString</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-get" id="ref-for-dom-workletsharedstorage-get"><c- g>get</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString" id="ref-for-idl-DOMString⑨"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="WorkletSharedStorage/get(key)" data-dfn-type="argument" data-export id="dom-workletsharedstorage-get-key-key"><code><c- g>key</c-></code><a class="self-link" href="#dom-workletsharedstorage-get-key-key"></a></dfn>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise⑨"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①"><c- b>unsigned</c-> <c- b>long</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-length" id="ref-for-dom-workletsharedstorage-length"><c- g>length</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①⓪"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double" id="ref-for-idl-double①"><c- b>double</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-remainingbudget" id="ref-for-dom-workletsharedstorage-remainingbudget"><c- g>remainingBudget</c-></a>();

  <a data-link-type="idl-name" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator"><c- n>SharedStorageIterator</c-></a> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-keys" id="ref-for-dom-workletsharedstorage-keys"><c- g>keys</c-></a>();

  <a data-link-type="idl-name" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator①"><c- n>SharedStorageIterator</c-></a> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-entries" id="ref-for-dom-workletsharedstorage-entries"><c- g>entries</c-></a>();
};
</pre>
   <h4 class="heading settled" data-level="4.2.1" id="worklet-setter"><span class="secno">4.2.1. </span><span class="content">Worklet Setter/Deleter Methods</span><a class="self-link" href="#worklet-setter"></a></h4>
   <div class="algorithm" data-algorithm="set(key, value, options)" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-set"><code>set(<var>key</var>, <var>value</var>, <var>options</var>)</code><a class="self-link" href="#dom-workletsharedstorage-set"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator②">SharedStorageIterator</a></code>'s <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope⑦">SharedStorageWorkletGlobalScope</a></code>'s [<a data-link-type="dfn" href="#sharedstorageworkletglobalscope-outside-settings" id="ref-for-sharedstorageworkletglobalscope-outside-settings">outside settings</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context">target browsing context</a>.</p>
     <li data-md>
      <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel②">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror⑥">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>value</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror⑦">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>options</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror⑧">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑧">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>options</var> is empty, create <var>options</var> with <var>options</var>["<code>ignoreIfPresent</code>"] set to false.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①①">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①①">shared storage database queue</a>:</p>
        <ol>
         <li data-md>
          <p>If <var>options</var>["<code>ignoreIfPresent</code>"] is true:</p>
          <ol>
           <li data-md>
            <p>Let <var>currentValue</var> be the result of running <a data-link-type="dfn" href="#shared-storage-database-retrieve-an-entry-from-the-database" id="ref-for-shared-storage-database-retrieve-an-entry-from-the-database③">retrieve an entry from the database</a> with <var>context</var> and <var>key</var>.</p>
           <li data-md>
            <p>If <var>currentValue</var> is not failure, resolve <var>promise</var> as undefined.</p>
           <li data-md>
            <p>Otherwise, run <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database⑤">store an entry in the database</a> with <var>context</var>, <var>key</var>, and <var>value</var>.</p>
           <li data-md>
            <p>Resolve <var>promise</var> as undefined.</p>
          </ol>
         <li data-md>
          <p>Otherwise, run <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database⑥">store an entry in the database</a> with <var>context</var>, <var>key</var>, and <var>value</var>.</p>
         <li data-md>
          <p>Resolve <var>promise</var> as undefined.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="append(key, value)" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-append"><code>append(<var>key</var>, <var>value</var>)</code><a class="self-link" href="#dom-workletsharedstorage-append"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator③">SharedStorageIterator</a></code>'s <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope⑧">SharedStorageWorkletGlobalScope</a></code>'s [<a data-link-type="dfn" href="#sharedstorageworkletglobalscope-outside-settings" id="ref-for-sharedstorageworkletglobalscope-outside-settings①">outside settings</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context①">target browsing context</a>.</p>
     <li data-md>
      <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel③">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror⑨">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑨">DOMException</a></code>.</p>
       <li data-md>
        <p>If <var>value</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror①⓪">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①⓪">DOMException</a></code>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①②">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①②">shared storage database queue</a>:</p>
        <ol>
         <li data-md>
          <p>Let <var>currentValue</var> be the result of running <a data-link-type="dfn" href="#shared-storage-database-retrieve-an-entry-from-the-database" id="ref-for-shared-storage-database-retrieve-an-entry-from-the-database④">retrieve an entry from the database</a> with <var>context</var> and <var>key</var>.</p>
         <li data-md>
          <p>If <var>currentValue</var> is not failure:</p>
          <ol>
           <li data-md>
            <p>Let <var>list</var> be a new <a data-link-type="dfn" href="https://infra.spec.whatwg.org#list" id="ref-for-list③">list</a>.</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org#list-append" id="ref-for-list-append③">Append</a> <var>currentValue</var> to <var>list</var>.</p>
           <li data-md>
            <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org#list-append" id="ref-for-list-append④">Append</a> <var>value</var> to <var>list</var>.</p>
           <li data-md>
            <p>Let <var>newValue</var> be the result of running <a data-link-type="dfn" href="https://infra.spec.whatwg.org#string-concatenate" id="ref-for-string-concatenate①">concatenate</a> on <var>list</var>.</p>
           <li data-md>
            <p>Run <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database⑦">store an entry in the database</a> with <var>context</var>, <var>key</var>, and <var>newValue</var>.</p>
           <li data-md>
            <p>Resolve <var>promise</var> as undefined.</p>
          </ol>
         <li data-md>
          <p>Otherwise, run <a data-link-type="dfn" href="#shared-storage-database-store-an-entry-in-the-database" id="ref-for-shared-storage-database-store-an-entry-in-the-database⑧">store an entry in the database</a> with <var>context</var>, <var>key</var>, and <var>value</var>..</p>
         <li data-md>
          <p>Resolve <var>promise</var> as undefined.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="delete(key)" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-delete"><code>delete(<var>key</var>)</code><a class="self-link" href="#dom-workletsharedstorage-delete"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator④">SharedStorageIterator</a></code>'s <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope⑨">SharedStorageWorkletGlobalScope</a></code>'s [<a data-link-type="dfn" href="#sharedstorageworkletglobalscope-outside-settings" id="ref-for-sharedstorageworkletglobalscope-outside-settings②">outside settings</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context②">target browsing context</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①③">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①③">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror①①">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①①">DOMException</a></code>.</p>
       <li data-md>
        <p>Run <a data-link-type="dfn" href="#shared-storage-database-delete-an-entry-from-the-database" id="ref-for-shared-storage-database-delete-an-entry-from-the-database②">delete an entry from the database</a> with <var>context</var> and <var>key</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="clear()" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-clear"><code>clear()</code><a class="self-link" href="#dom-workletsharedstorage-clear"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator⑤">SharedStorageIterator</a></code>'s <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope①⓪">SharedStorageWorkletGlobalScope</a></code>'s [<a data-link-type="dfn" href="#sharedstorageworkletglobalscope-outside-settings" id="ref-for-sharedstorageworkletglobalscope-outside-settings③">outside settings</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context③">target browsing context</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①④">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①④">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>Run <a data-link-type="dfn" href="#shared-storage-database-clear-all-entries-in-the-database" id="ref-for-shared-storage-database-clear-all-entries-in-the-database②">clear all entries in the database</a> with <var>context</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="4.2.2" id="getter"><span class="secno">4.2.2. </span><span class="content">Getter Methods</span><a class="self-link" href="#getter"></a></h4>
   <div class="algorithm" data-algorithm="get(key)" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-get"><code>get(<var>key</var>)</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator⑥">SharedStorageIterator</a></code>'s <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope①①">SharedStorageWorkletGlobalScope</a></code>'s [<a data-link-type="dfn" href="#sharedstorageworkletglobalscope-outside-settings" id="ref-for-sharedstorageworkletglobalscope-outside-settings④">outside settings</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context④">target browsing context</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①⑤">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①⑤">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>key</var> is invalid, reject <var>promise</var> with a "<code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#dataerror" id="ref-for-dataerror①②">DataError</a></code>" <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①②">DOMException</a></code>.</p>
       <li data-md>
        <p>Let <var>value</var> be the result of running <a data-link-type="dfn" href="#shared-storage-database-retrieve-an-entry-from-the-database" id="ref-for-shared-storage-database-retrieve-an-entry-from-the-database⑤">retrieve an entry from the database</a> with <var>context</var> and <var>key</var>..</p>
       <li data-md>
        <p>If <var>value</var> is not failure, resolve <var>promise</var> as <var>value</var>.</p>
       <li data-md>
        <p>Otherwise, resolve <var>promise</var> as undefined.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="length()" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-length"><code>length()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator⑦">SharedStorageIterator</a></code>'s <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope①②">SharedStorageWorkletGlobalScope</a></code>'s [<a data-link-type="dfn" href="#sharedstorageworkletglobalscope-outside-settings" id="ref-for-sharedstorageworkletglobalscope-outside-settings⑤">outside settings</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context⑤">target browsing context</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①⑥">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①⑥">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>numEntries</var> be the result of running <a data-link-type="dfn" href="#shared-storage-database-count-entries-in-the-database" id="ref-for-shared-storage-database-count-entries-in-the-database">count entries in the database</a> with <var>context</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as <var>numEntries</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="remainingBudget()" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-remainingbudget"><code>remainingBudget()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator⑧">SharedStorageIterator</a></code>'s <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope①③">SharedStorageWorkletGlobalScope</a></code>'s [<a data-link-type="dfn" href="#sharedstorageworkletglobalscope-outside-settings" id="ref-for-sharedstorageworkletglobalscope-outside-settings⑥">outside settings</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context⑥">target browsing context</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be <var>context</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#active-document" id="ref-for-active-document①">active document</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org#concept-url-origin" id="ref-for-concept-url-origin⑤">origin</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①⑦">Enqueue the following steps</a> on <var>context</var>’s associated <a data-link-type="dfn" href="#shared-storage-database-queue" id="ref-for-shared-storage-database-queue①⑦">shared storage database queue</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>remainingBudget</var> be the result of running <a data-link-type="dfn" href="#determine-remaining-budget" id="ref-for-determine-remaining-budget②">determine remaining budget</a> with <var>origin</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as <var>remainingBudget</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="keys()" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-keys"><code>keys()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>mode</var> be "<code class="idl"><a data-link-type="idl" href="#dom-iteratormode-key" id="ref-for-dom-iteratormode-key">key</a></code>".</p>
     <li data-md>
      <p>Construct a <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator⑨">SharedStorageIterator</a></code> object <var>iterator</var> with <var>mode</var>.</p>
     <li data-md>
      <p>Return <var>iterator</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="entries()" data-algorithm-for="WorkletSharedStorage">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="WorkletSharedStorage" data-dfn-type="method" data-export id="dom-workletsharedstorage-entries"><code>entries()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>mode</var> be "<code class="idl"><a data-link-type="idl" href="#dom-iteratormode-keyvalue" id="ref-for-dom-iteratormode-keyvalue">keyValue</a></code>".</p>
     <li data-md>
      <p>Construct a <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator①⓪">SharedStorageIterator</a></code> object <var>iterator</var> with <var>mode</var>.</p>
     <li data-md>
      <p>Return <var>iterator</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="4.3" id="iterator"><span class="secno">4.3. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator①①">SharedStorageIterator</a></code> Interface</span><a class="self-link" href="#iterator"></a></h3>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-iteratormode"><code><c- g>IteratorMode</c-></code></dfn> { <dfn class="dfn-paneled idl-code" data-dfn-for="IteratorMode" data-dfn-type="enum-value" data-export id="dom-iteratormode-key"><code><c- s>"key"</c-></code></dfn>, <dfn class="dfn-paneled idl-code" data-dfn-for="IteratorMode" data-dfn-type="enum-value" data-export id="dom-iteratormode-keyvalue"><code><c- s>"keyValue"</c-></code></dfn> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed⑧"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="sharedstorageiterator"><code><c- g>SharedStorageIterator</c-></code></dfn> {
  <dfn class="idl-code" data-dfn-for="SharedStorageIterator" data-dfn-type="constructor" data-export data-lt="SharedStorageIterator(mode)|constructor(mode)" id="dom-sharedstorageiterator-sharedstorageiterator"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-sharedstorageiterator-sharedstorageiterator"></a></dfn>(<a data-link-type="idl-name" href="#enumdef-iteratormode" id="ref-for-enumdef-iteratormode"><c- n>IteratorMode</c-></a> <dfn class="idl-code" data-dfn-for="SharedStorageIterator/SharedStorageIterator(mode), SharedStorageIterator/constructor(mode)" data-dfn-type="argument" data-export id="dom-sharedstorageiterator-sharedstorageiterator-mode-mode"><code><c- g>mode</c-></code><a class="self-link" href="#dom-sharedstorageiterator-sharedstorageiterator-mode-mode"></a></dfn>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise" id="ref-for-idl-promise①①"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object⑤"><c- b>object</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorageiterator-next" id="ref-for-dom-sharedstorageiterator-next"><c- g>next</c-></a>();
};
</pre>
   <div class="algorithm" data-algorithm="constructor(mode)" data-algorithm-for="SharedStorageIterator">
     The <dfn class="idl-code" data-dfn-for="SharedStorageIterator" data-dfn-type="method" data-export id="dom-sharedstorageiterator-constructor"><code>constructor(<var>mode</var>)</code><a class="self-link" href="#dom-sharedstorageiterator-constructor"></a></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Create an internal queue <var>pendingEntries</var>.</p>
     <li data-md>
      <p>Let <var>context</var> be <code class="idl"><a data-link-type="idl" href="#sharedstorageiterator" id="ref-for-sharedstorageiterator①②">SharedStorageIterator</a></code>'s <code class="idl"><a data-link-type="idl" href="#sharedstorageworkletglobalscope" id="ref-for-sharedstorageworkletglobalscope①④">SharedStorageWorkletGlobalScope</a></code>'s [<a data-link-type="dfn" href="#sharedstorageworkletglobalscope-outside-settings" id="ref-for-sharedstorageworkletglobalscope-outside-settings⑦">outside settings</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context" id="ref-for-concept-environment-target-browsing-context⑦">target browsing context</a>.</p>
     <li data-md>
      <p>Run the following steps <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel④">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>mode</var> is "<code class="idl"><a data-link-type="idl" href="#dom-iteratormode-key" id="ref-for-dom-iteratormode-key①">key</a></code>":</p>
        <ol>
         <li data-md>
          <p>Let <var>keys</var> be the result of running <a data-link-type="dfn" href="#shared-storage-database-retrieve-all-keys-from-the-database" id="ref-for-shared-storage-database-retrieve-all-keys-from-the-database">retrieve all keys from the database</a> with <var>context</var>.</p>
         <li data-md>
          <p>Queue <var>keys</var> in <var>pendingEntries</var>, to be returned individually with the <code class="idl"><a data-link-type="idl" href="#dom-sharedstorageiterator-next" id="ref-for-dom-sharedstorageiterator-next①">next()</a></code> method.</p>
        </ol>
       <li data-md>
        <p>Otherwise:</p>
        <ol>
         <li data-md>
          <p>Let <var>entries</var> be the result of running <a data-link-type="dfn" href="#shared-storage-database-retrieve-all-entries-from-the-database" id="ref-for-shared-storage-database-retrieve-all-entries-from-the-database">retrieve all entries from the database</a> with <var>context</var>.</p>
         <li data-md>
          <p>Queue <var>entries</var> in <var>pendingEntries</var>, to be returned individually with the <code class="idl"><a data-link-type="idl" href="#dom-sharedstorageiterator-next" id="ref-for-dom-sharedstorageiterator-next②">next()</a></code> method.</p>
        </ol>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="next()" data-algorithm-for="SharedStorageIterator">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="SharedStorageIterator" data-dfn-type="method" data-export id="dom-sharedstorageiterator-next"><code>next()</code></dfn> method steps are: 
    <ol>
     <li data-md>
      <p>Let <var>promise</var> be a new promise.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps" id="ref-for-enqueue-the-following-steps①⑧">Enqueue the following steps</a>:</p>
      <ol>
       <li data-md>
        <p>If there was an error in retrieving entries, reject <var>promise</var>.</p>
       <li data-md>
        <p>If the internal entry queue <var>pendingEntries</var> is empty:</p>
        <ol>
         <li data-md>
          <p>Create an object <var>doneObject</var> flagging that iteration has finished.</p>
         <li data-md>
          <p>Resolve <var>promise</var> with <var>doneObject</var>.</p>
        </ol>
       <li data-md>
        <p>Otherwise, let <var>entry</var> be the entry at the front of <var>pendingEntries</var>.</p>
       <li data-md>
        <p>Resolve <var>promise</var> as <var>entry</var>.</p>
      </ol>
     <li data-md>
      <p>Return <var>promise</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="5" id="privacy"><span class="secno">5. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy"></a></h2>
   <p> <span class="XXX">TODO: Add privacy considerations.</span> </p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li>
    append(key, value)
    <ul>
     <li><a href="#dom-sharedstorage-append">method for SharedStorage</a><span>, in § 4</span>
     <li><a href="#dom-windowsharedstorage-append">method for WindowSharedStorage</a><span>, in § 4.1.1</span>
     <li><a href="#dom-workletsharedstorage-append">method for WorkletSharedStorage</a><span>, in § 4.2.1</span>
    </ul>
   <li><a href="#bit-debit">bit debit</a><span>, in § 4.1.2</span>
   <li><a href="#budget-table">budget table</a><span>, in § 4.1.2</span>
   <li><a href="#calling-origin">calling origin</a><span>, in § 4.1.2</span>
   <li>
    clear()
    <ul>
     <li><a href="#dom-sharedstorage-clear">method for SharedStorage</a><span>, in § 4</span>
     <li><a href="#dom-windowsharedstorage-clear">method for WindowSharedStorage</a><span>, in § 4.1.1</span>
     <li><a href="#dom-workletsharedstorage-clear">method for WorkletSharedStorage</a><span>, in § 4.2.1</span>
    </ul>
   <li><a href="#shared-storage-database-clear-all-entries-in-the-database">clear all entries in the database</a><span>, in § 3</span>
   <li>
    constructor(mode)
    <ul>
     <li><a href="#dom-sharedstorageiterator-sharedstorageiterator">constructor for SharedStorageIterator</a><span>, in § 4.3</span>
     <li><a href="#dom-sharedstorageiterator-constructor">method for SharedStorageIterator</a><span>, in § 4.3</span>
    </ul>
   <li><a href="#shared-storage-database-count-entries-in-the-database">count entries in the database</a><span>, in § 3</span>
   <li><a href="#create-a-shared-storage-bucket">create a shared storage bucket</a><span>, in § 3.1</span>
   <li><a href="#create-a-shared-storage-shelf">create a shared storage shelf</a><span>, in § 3.1</span>
   <li><a href="#dom-sharedstoragerunoperationmethodoptions-data">data</a><span>, in § 4.1</span>
   <li><a href="#default-value">default value</a><span>, in § 4.1.2</span>
   <li><a href="#shared-storage-database-delete-an-entry-from-the-database">delete an entry from the database</a><span>, in § 3</span>
   <li>
    delete(key)
    <ul>
     <li><a href="#dom-sharedstorage-delete">method for SharedStorage</a><span>, in § 4</span>
     <li><a href="#dom-windowsharedstorage-delete">method for WindowSharedStorage</a><span>, in § 4.1.1</span>
     <li><a href="#dom-workletsharedstorage-delete">method for WorkletSharedStorage</a><span>, in § 4.2.1</span>
    </ul>
   <li><a href="#determine-remaining-budget">determine remaining budget</a><span>, in § 4.1.2</span>
   <li><a href="#dom-workletsharedstorage-entries">entries()</a><span>, in § 4.2.2</span>
   <li><a href="#entropy-allowance">entropy allowance</a><span>, in § 4.1.2</span>
   <li><a href="#entropy-ledger">entropy ledger</a><span>, in § 4.1.2</span>
   <li><a href="#shared-storage-database-entry">entry</a><span>, in § 3</span>
   <li><a href="#epoch">epoch</a><span>, in § 4.1.2</span>
   <li><a href="#dom-workletsharedstorage-get">get(key)</a><span>, in § 4.2.2</span>
   <li><a href="#dom-sharedstoragesetmethodoptions-ignoreifpresent">ignoreIfPresent</a><span>, in § 4</span>
   <li><a href="#enumdef-iteratormode">IteratorMode</a><span>, in § 4.3</span>
   <li><a href="#dom-iteratormode-key">"key"</a><span>, in § 4.3</span>
   <li><a href="#entry-key">key</a><span>, in § 3</span>
   <li><a href="#dom-workletsharedstorage-keys">keys()</a><span>, in § 4.2.2</span>
   <li><a href="#dom-iteratormode-keyvalue">"keyValue"</a><span>, in § 4.3</span>
   <li><a href="#dom-workletsharedstorage-length">length()</a><span>, in § 4.2.2</span>
   <li><a href="#dom-sharedstorageiterator-next">next()</a><span>, in § 4.3</span>
   <li><a href="#obtain-a-shared-storage-bottle-map">obtain a shared storage bottle map</a><span>, in § 3.1</span>
   <li><a href="#obtain-a-shared-storage-shelf">obtain a shared storage shelf</a><span>, in § 3.1</span>
   <li><a href="#sharedstorageworkletglobalscope-operation-map">operation map</a><span>, in § 2</span>
   <li><a href="#sharedstorageworkletglobalscope-outside-settings">outside settings</a><span>, in § 2</span>
   <li><a href="#dom-sharedstorageworkletglobalscope-register">register(name, operationCtor)</a><span>, in § 2.1</span>
   <li><a href="#dom-workletsharedstorage-remainingbudget">remainingBudget()</a><span>, in § 4.2.2</span>
   <li><a href="#dom-sharedstorageurlwithmetadata-reportingmetadata">reportingMetadata</a><span>, in § 2</span>
   <li><a href="#shared-storage-database-retrieve-all-entries-from-the-database">retrieve all entries from the database</a><span>, in § 3</span>
   <li><a href="#shared-storage-database-retrieve-all-keys-from-the-database">retrieve all keys from the database</a><span>, in § 3</span>
   <li><a href="#shared-storage-database-retrieve-an-entry-from-the-database">retrieve an entry from the database</a><span>, in § 3</span>
   <li><a href="#dom-sharedstoragerunoperation-run">run(data)</a><span>, in § 2</span>
   <li><a href="#dom-sharedstorageselecturloperation-run">run(data, urls)</a><span>, in § 2</span>
   <li><a href="#dom-windowsharedstorage-run">run(name)</a><span>, in § 4.1.3</span>
   <li><a href="#dom-windowsharedstorage-run">run(name, options)</a><span>, in § 4.1.3</span>
   <li><a href="#dom-windowsharedstorage-selecturl">selectURL(name, urls)</a><span>, in § 4.1.3</span>
   <li><a href="#dom-windowsharedstorage-selecturl">selectURL(name, urls, options)</a><span>, in § 4.1.3</span>
   <li><a href="#dom-sharedstorage-set">set(key, value)</a><span>, in § 4</span>
   <li>
    set(key, value, options)
    <ul>
     <li><a href="#dom-sharedstorage-set">method for SharedStorage</a><span>, in § 4</span>
     <li><a href="#dom-windowsharedstorage-set">method for WindowSharedStorage</a><span>, in § 4.1.1</span>
     <li><a href="#dom-workletsharedstorage-set">method for WorkletSharedStorage</a><span>, in § 4.2.1</span>
    </ul>
   <li><a href="#shared-storage">shared storage</a><span>, in § 3.1</span>
   <li><a href="#sharedstorage">SharedStorage</a><span>, in § 4</span>
   <li><a href="#shared-storage-bucket">shared storage bucket</a><span>, in § 3.1</span>
   <li><a href="#shared-storage-database">shared storage database</a><span>, in § 3</span>
   <li><a href="#shared-storage-database-queue">shared storage database queue</a><span>, in § 3</span>
   <li><a href="#sharedstorageiterator">SharedStorageIterator</a><span>, in § 4.3</span>
   <li><a href="#dom-sharedstorageiterator-sharedstorageiterator">SharedStorageIterator(mode)</a><span>, in § 4.3</span>
   <li><a href="#sharedstorageoperation">SharedStorageOperation</a><span>, in § 2</span>
   <li><a href="#callbackdef-sharedstorageoperationconstructor">SharedStorageOperationConstructor</a><span>, in § 2</span>
   <li><a href="#sharedstoragerunoperation">SharedStorageRunOperation</a><span>, in § 2</span>
   <li><a href="#dictdef-sharedstoragerunoperationmethodoptions">SharedStorageRunOperationMethodOptions</a><span>, in § 4.1</span>
   <li><a href="#sharedstorageselecturloperation">SharedStorageSelectURLOperation</a><span>, in § 2</span>
   <li><a href="#dictdef-sharedstoragesetmethodoptions">SharedStorageSetMethodOptions</a><span>, in § 4</span>
   <li><a href="#shared-storage-shed">shared storage shed</a><span>, in § 3.1</span>
   <li><a href="#shared-storage-shelf">shared storage shelf</a><span>, in § 3.1</span>
   <li><a href="#dictdef-sharedstorageurlwithmetadata">SharedStorageUrlWithMetadata</a><span>, in § 2</span>
   <li><a href="#sharedstorageworklet">SharedStorageWorklet</a><span>, in § 2</span>
   <li><a href="#sharedstorageworkletglobalscope">SharedStorageWorkletGlobalScope</a><span>, in § 2</span>
   <li><a href="#shared-storage-database-store-an-entry-in-the-database">store an entry in the database</a><span>, in § 3</span>
   <li><a href="#dom-sharedstorageurlwithmetadata-url">url</a><span>, in § 2</span>
   <li><a href="#entry-value">value</a><span>, in § 3</span>
   <li><a href="#windowsharedstorage">WindowSharedStorage</a><span>, in § 4.1</span>
   <li><a href="#dom-windowsharedstorage-worklet">worklet</a><span>, in § 4.1</span>
   <li><a href="#workletsharedstorage">WorkletSharedStorage</a><span>, in § 4.2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window">https://html.spec.whatwg.org/multipage/nav-history-apis.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">4. The SharedStorage Interface</a> <a href="#ref-for-window①">(2)</a> <a href="#ref-for-window②">(3)</a> <a href="#ref-for-window③">(4)</a>
    <li><a href="#ref-for-window④">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-window⑤">(2)</a> <a href="#ref-for-window⑥">(3)</a> <a href="#ref-for-window⑦">(4)</a>
    <li><a href="#ref-for-window⑧">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-worklet">
   <a href="https://html.spec.whatwg.org/multipage/worklets.html#worklet">https://html.spec.whatwg.org/multipage/worklets.html#worklet</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-worklet">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-workletglobalscope">
   <a href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope">https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workletglobalscope">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-document">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#active-document">https://html.spec.whatwg.org/multipage/webappapis.html#active-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-document">4.1.3. Run Operation Methods</a>
    <li><a href="#ref-for-active-document①">4.2.2. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-active-window">
   <a href="https://html.spec.whatwg.org/multipage/document-sequences.html#active-window">https://html.spec.whatwg.org/multipage/document-sequences.html#active-window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-active-window">3. The Shared Storage Database</a> <a href="#ref-for-active-window①">(2)</a> <a href="#ref-for-active-window②">(3)</a> <a href="#ref-for-active-window③">(4)</a> <a href="#ref-for-active-window④">(5)</a> <a href="#ref-for-active-window⑤">(6)</a> <a href="#ref-for-active-window⑥">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-worklet-addmodule">
   <a href="https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule">https://html.spec.whatwg.org/multipage/worklets.html#dom-worklet-addmodule</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-worklet-addmodule">4. The SharedStorage Interface</a>
    <li><a href="#ref-for-dom-worklet-addmodule①">4.1.3. Run Operation Methods</a> <a href="#ref-for-dom-worklet-addmodule②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-append">
   <a href="https://infra.spec.whatwg.org#list-append">https://infra.spec.whatwg.org#list-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-append">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-list-append①">(2)</a>
    <li><a href="#ref-for-list-append②">4.1.3. Run Operation Methods</a>
    <li><a href="#ref-for-list-append③">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-list-append④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-set-append">
   <a href="https://infra.spec.whatwg.org#set-append">https://infra.spec.whatwg.org#set-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-append">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-proxy-map-backing-map">
   <a href="https://storage.spec.whatwg.org/#storage-proxy-map-backing-map">https://storage.spec.whatwg.org/#storage-proxy-map-backing-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-proxy-map-backing-map">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-bits-of-entropy">
   <a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)#bits-of-entropy">https://en.wikipedia.org/wiki/Entropy_(information_theory)#bits-of-entropy</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bits-of-entropy">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-bottle-map">
   <a href="https://storage.spec.whatwg.org/#bottle-map">https://storage.spec.whatwg.org/#bottle-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bottle-map">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-bottle-map①">(2)</a> <a href="#ref-for-bottle-map②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context">https://html.spec.whatwg.org/multipage/document-sequences.html#browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-browsing-context">3. The Shared Storage Database</a> <a href="#ref-for-browsing-context①">(2)</a> <a href="#ref-for-browsing-context②">(3)</a> <a href="#ref-for-browsing-context③">(4)</a> <a href="#ref-for-browsing-context④">(5)</a> <a href="#ref-for-browsing-context⑤">(6)</a> <a href="#ref-for-browsing-context⑥">(7)</a> <a href="#ref-for-browsing-context⑦">(8)</a> <a href="#ref-for-browsing-context⑧">(9)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window-bc">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#window-bc">https://html.spec.whatwg.org/multipage/webappapis.html#window-bc</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window-bc">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-window-bc①">(2)</a> <a href="#ref-for-window-bc②">(3)</a> <a href="#ref-for-window-bc③">(4)</a>
    <li><a href="#ref-for-window-bc④">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-bucket-map">
   <a href="https://storage.spec.whatwg.org/#bucket-map">https://storage.spec.whatwg.org/#bucket-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bucket-map">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-bucket-map①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-clear">
   <a href="https://infra.spec.whatwg.org#map-clear">https://infra.spec.whatwg.org#map-clear</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-clear">3. The Shared Storage Database</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-client-side-storage-partitioning">
   <a href="https://privacycg.github.io/storage-partitioning/#client-side-storage-partitioning">https://privacycg.github.io/storage-partitioning/#client-side-storage-partitioning</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-client-side-storage-partitioning">1. Introduction</a>
    <li><a href="#ref-for-client-side-storage-partitioning①">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-string-concatenate">
   <a href="https://infra.spec.whatwg.org#string-concatenate">https://infra.spec.whatwg.org#string-concatenate</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-string-concatenate">4.1.1. Window Setter/Deleter Methods</a>
    <li><a href="#ref-for-string-concatenate①">4.2.1. Worklet Setter/Deleter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-constructor">
   <a href="https://tc39.es/ecma262/#constructor">https://tc39.es/ecma262/#constructor</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-constructor">2.1. Registering a Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-exists">
   <a href="https://infra.spec.whatwg.org#map-exists">https://infra.spec.whatwg.org#map-exists</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-exists">2.1. Registering a Worklet</a>
    <li><a href="#ref-for-map-exists①">3. The Shared Storage Database</a>
    <li><a href="#ref-for-map-exists②">4.1.2. Entropy Budget</a>
    <li><a href="#ref-for-map-exists③">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-dictionary">
   <a href="https://webidl.spec.whatwg.org#dfn-dictionary">https://webidl.spec.whatwg.org#dfn-dictionary</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-dictionary">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-is-empty">
   <a href="https://infra.spec.whatwg.org#map-is-empty">https://infra.spec.whatwg.org#map-is-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-is-empty">4.1.3. Run Operation Methods</a> <a href="#ref-for-map-is-empty①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-enqueue-the-following-steps">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps">https://html.spec.whatwg.org/multipage/infrastructure.html#enqueue-the-following-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enqueue-the-following-steps">3. The Shared Storage Database</a> <a href="#ref-for-enqueue-the-following-steps①">(2)</a> <a href="#ref-for-enqueue-the-following-steps②">(3)</a> <a href="#ref-for-enqueue-the-following-steps③">(4)</a> <a href="#ref-for-enqueue-the-following-steps④">(5)</a> <a href="#ref-for-enqueue-the-following-steps⑤">(6)</a> <a href="#ref-for-enqueue-the-following-steps⑥">(7)</a>
    <li><a href="#ref-for-enqueue-the-following-steps⑦">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-enqueue-the-following-steps⑧">(2)</a> <a href="#ref-for-enqueue-the-following-steps⑨">(3)</a> <a href="#ref-for-enqueue-the-following-steps①⓪">(4)</a>
    <li><a href="#ref-for-enqueue-the-following-steps①①">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-enqueue-the-following-steps①②">(2)</a> <a href="#ref-for-enqueue-the-following-steps①③">(3)</a> <a href="#ref-for-enqueue-the-following-steps①④">(4)</a>
    <li><a href="#ref-for-enqueue-the-following-steps①⑤">4.2.2. Getter Methods</a> <a href="#ref-for-enqueue-the-following-steps①⑥">(2)</a> <a href="#ref-for-enqueue-the-following-steps①⑦">(3)</a>
    <li><a href="#ref-for-enqueue-the-following-steps①⑧">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-entropy-bits">
   <a href="https://en.wikipedia.org/wiki/Entropy_(information_theory)#entropy-bits">https://en.wikipedia.org/wiki/Entropy_(information_theory)#entropy-bits</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-entropy-bits">4.1.2. Entropy Budget</a> <a href="#ref-for-entropy-bits①">(2)</a> <a href="#ref-for-entropy-bits②">(3)</a> <a href="#ref-for-entropy-bits③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-entry">
   <a href="https://infra.spec.whatwg.org#map-entry">https://infra.spec.whatwg.org#map-entry</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-entry">2.1. Registering a Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-environment">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment">https://html.spec.whatwg.org/multipage/webappapis.html#environment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-environment">4. The SharedStorage Interface</a>
    <li><a href="#ref-for-environment①">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-environment-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-environment-settings-object">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-environment-settings-object①">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-environment-settings-object②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fencedframeconfig">
   <a href="https://wicg.github.io/fenced-frame/#fencedframeconfig">https://wicg.github.io/fenced-frame/#fencedframeconfig</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fencedframeconfig">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-function-object">
   <a href="https://tc39.es/ecma262/#function-object">https://tc39.es/ecma262/#function-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-function-object">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-function-object①">2.1. Registering a Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-get">
   <a href="https://infra.spec.whatwg.org#map-get">https://infra.spec.whatwg.org#map-get</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-get">3. The Shared Storage Database</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">4.1.3. Run Operation Methods</a> <a href="#ref-for-in-parallel①">(2)</a>
    <li><a href="#ref-for-in-parallel②">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-in-parallel③">(2)</a>
    <li><a href="#ref-for-in-parallel④">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-item">
   <a href="https://infra.spec.whatwg.org#list-item">https://infra.spec.whatwg.org#list-item</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-item">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-key">
   <a href="https://infra.spec.whatwg.org#map-key">https://infra.spec.whatwg.org#map-key</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-key">2.1. Registering a Worklet</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list">
   <a href="https://infra.spec.whatwg.org#list">https://infra.spec.whatwg.org#list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-list①">4.1.1. Window Setter/Deleter Methods</a>
    <li><a href="#ref-for-list②">4.1.2. Entropy Budget</a>
    <li><a href="#ref-for-list③">4.2.1. Worklet Setter/Deleter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-input-list">
   <a href="https://html.spec.whatwg.org/multipage/input.html#dom-input-list">https://html.spec.whatwg.org/multipage/input.html#dom-input-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-input-list">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-map">
   <a href="https://infra.spec.whatwg.org#ordered-map">https://infra.spec.whatwg.org#ordered-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-map">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-ordered-map①">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-ordered-map②">(2)</a>
    <li><a href="#ref-for-ordered-map③">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-module-map">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#module-map">https://html.spec.whatwg.org/multipage/webappapis.html#module-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-module-map">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-module-map①">4.1.3. Run Operation Methods</a> <a href="#ref-for-module-map②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-module-script">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#module-script">https://html.spec.whatwg.org/multipage/webappapis.html#module-script</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-module-script">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-module-script①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-obtain-a-worklet-agent">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#obtain-a-worklet-agent">https://html.spec.whatwg.org/multipage/webappapis.html#obtain-a-worklet-agent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-obtain-a-worklet-agent">4.1.3. Run Operation Methods</a> <a href="#ref-for-obtain-a-worklet-agent①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-opaque-origin">
   <a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-opaque-origin">https://html.spec.whatwg.org/multipage/browsers.html#concept-opaque-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-opaque-origin">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-origin">
   <a href="https://url.spec.whatwg.org#concept-url-origin">https://url.spec.whatwg.org#concept-url-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-origin">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-concept-url-origin①">(2)</a> <a href="#ref-for-concept-url-origin②">(3)</a>
    <li><a href="#ref-for-concept-url-origin③">4.1.2. Entropy Budget</a>
    <li><a href="#ref-for-concept-url-origin④">4.1.3. Run Operation Methods</a>
    <li><a href="#ref-for-concept-url-origin⑤">4.2.2. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-parallel-enqueue">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-enqueue">https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-enqueue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-parallel-enqueue">3. The Shared Storage Database</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-bottle-proxy-map-reference-set">
   <a href="https://storage.spec.whatwg.org/#storage-bottle-proxy-map-reference-set">https://storage.spec.whatwg.org/#storage-bottle-proxy-map-reference-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-bottle-proxy-map-reference-set">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-bottle-quota">
   <a href="https://storage.spec.whatwg.org/#storage-bottle-quota">https://storage.spec.whatwg.org/#storage-bottle-quota</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-bottle-quota">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-endpoint-quota">
   <a href="https://storage.spec.whatwg.org/#storage-endpoint-quota">https://storage.spec.whatwg.org/#storage-endpoint-quota</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-endpoint-quota">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-storage-endpoint-quota①">(2)</a> <a href="#ref-for-storage-endpoint-quota②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-registered-storage-endpoints">
   <a href="https://storage.spec.whatwg.org/#registered-storage-endpoints">https://storage.spec.whatwg.org/#registered-storage-endpoints</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-registered-storage-endpoints">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-registered-storage-endpoints①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relevant-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relevant-settings-object">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-relevant-settings-object①">3. The Shared Storage Database</a> <a href="#ref-for-relevant-settings-object②">(2)</a> <a href="#ref-for-relevant-settings-object③">(3)</a> <a href="#ref-for-relevant-settings-object④">(4)</a> <a href="#ref-for-relevant-settings-object⑤">(5)</a> <a href="#ref-for-relevant-settings-object⑥">(6)</a> <a href="#ref-for-relevant-settings-object⑦">(7)</a>
    <li><a href="#ref-for-relevant-settings-object⑧">4.1.3. Run Operation Methods</a> <a href="#ref-for-relevant-settings-object⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-set">
   <a href="https://infra.spec.whatwg.org#map-set">https://infra.spec.whatwg.org#map-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-set">2.1. Registering a Worklet</a>
    <li><a href="#ref-for-map-set①">3. The Shared Storage Database</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-size">
   <a href="https://infra.spec.whatwg.org#map-size">https://infra.spec.whatwg.org#map-size</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-size">3. The Shared Storage Database</a>
    <li><a href="#ref-for-map-size①">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-bottle">
   <a href="https://storage.spec.whatwg.org/#storage-bottle">https://storage.spec.whatwg.org/#storage-bottle</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-bottle">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-bucket">
   <a href="https://storage.spec.whatwg.org/#storage-bucket">https://storage.spec.whatwg.org/#storage-bucket</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-bucket">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-endpoint">
   <a href="https://storage.spec.whatwg.org/#storage-endpoint">https://storage.spec.whatwg.org/#storage-endpoint</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-endpoint">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-storage-endpoint①">(2)</a> <a href="#ref-for-storage-endpoint②">(3)</a> <a href="#ref-for-storage-endpoint③">(4)</a> <a href="#ref-for-storage-endpoint④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-identifier">
   <a href="https://storage.spec.whatwg.org/#storage-identifier">https://storage.spec.whatwg.org/#storage-identifier</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-identifier">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-storage-identifier①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-key">
   <a href="https://storage.spec.whatwg.org/#storage-key">https://storage.spec.whatwg.org/#storage-key</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-key">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-model">
   <a href="https://storage.spec.whatwg.org/#model">https://storage.spec.whatwg.org/#model</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-model">3. The Shared Storage Database</a>
    <li><a href="#ref-for-model①">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-model②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-proxy-map">
   <a href="https://storage.spec.whatwg.org/#storage-proxy-map">https://storage.spec.whatwg.org/#storage-proxy-map</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-proxy-map">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-shed">
   <a href="https://storage.spec.whatwg.org/#storage-shed">https://storage.spec.whatwg.org/#storage-shed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-shed">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-shelf">
   <a href="https://storage.spec.whatwg.org/#storage-shelf">https://storage.spec.whatwg.org/#storage-shelf</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-shelf">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-storage-shelf①">(2)</a> <a href="#ref-for-storage-shelf②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-storage-type">
   <a href="https://storage.spec.whatwg.org/#storage-type">https://storage.spec.whatwg.org/#storage-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-storage-type">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-storage-type①">(2)</a> <a href="#ref-for-storage-type②">(3)</a> <a href="#ref-for-storage-type③">(4)</a> <a href="#ref-for-storage-type④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-string">
   <a href="https://infra.spec.whatwg.org#string">https://infra.spec.whatwg.org#string</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-string">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-string①">(2)</a>
    <li><a href="#ref-for-string②">3. The Shared Storage Database</a> <a href="#ref-for-string③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-struct">
   <a href="https://infra.spec.whatwg.org#struct">https://infra.spec.whatwg.org#struct</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-struct">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-environment-target-browsing-context">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context">https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-environment-target-browsing-context">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-concept-environment-target-browsing-context①">(2)</a> <a href="#ref-for-concept-environment-target-browsing-context②">(3)</a> <a href="#ref-for-concept-environment-target-browsing-context③">(4)</a>
    <li><a href="#ref-for-concept-environment-target-browsing-context④">4.2.2. Getter Methods</a> <a href="#ref-for-concept-environment-target-browsing-context⑤">(2)</a> <a href="#ref-for-concept-environment-target-browsing-context⑥">(3)</a>
    <li><a href="#ref-for-concept-environment-target-browsing-context⑦">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-upon-fulfillment">
   <a href="https://webidl.spec.whatwg.org#upon-fulfillment">https://webidl.spec.whatwg.org#upon-fulfillment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-upon-fulfillment">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-parser">
   <a href="https://url.spec.whatwg.org#concept-url-parser">https://url.spec.whatwg.org#concept-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-parser">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-urnuuid">
   <a href="https://www.rfc-editor.org/rfc/rfc4122#urnuuid">https://www.rfc-editor.org/rfc/rfc4122#urnuuid</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-urnuuid">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-user-agent">
   <a href="https://infra.spec.whatwg.org#user-agent">https://infra.spec.whatwg.org#user-agent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-user-agent">3. The Shared Storage Database</a> <a href="#ref-for-user-agent①">(2)</a> <a href="#ref-for-user-agent②">(3)</a>
    <li><a href="#ref-for-user-agent③">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-user-agent④">(2)</a> <a href="#ref-for-user-agent⑤">(3)</a>
    <li><a href="#ref-for-user-agent⑥">4.1.2. Entropy Budget</a> <a href="#ref-for-user-agent⑦">(2)</a> <a href="#ref-for-user-agent⑧">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-worklet-global-scope-type">
   <a href="https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type">https://html.spec.whatwg.org/multipage/worklets.html#worklet-global-scope-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-worklet-global-scope-type">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-getting-the-keys">
   <a href="https://infra.spec.whatwg.org/#map-getting-the-keys">https://infra.spec.whatwg.org/#map-getting-the-keys</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-getting-the-keys">3. The Shared Storage Database</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-getting-the-values">
   <a href="https://infra.spec.whatwg.org/#map-getting-the-values">https://infra.spec.whatwg.org/#map-getting-the-values</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-getting-the-values">3. The Shared Storage Database</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-map-remove">
   <a href="https://infra.spec.whatwg.org/#map-remove">https://infra.spec.whatwg.org/#map-remove</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-map-remove">3. The Shared Storage Database</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-size">
   <a href="https://infra.spec.whatwg.org/#list-size">https://infra.spec.whatwg.org/#list-size</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-size">4.1.3. Run Operation Methods</a> <a href="#ref-for-list-size①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-opaque-url">
   <a href="https://github.com/WICG/fenced-frame/blob/master/explainer/opaque_src.md#opaque-url">https://github.com/WICG/fenced-frame/blob/master/explainer/opaque_src.md#opaque-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-opaque-url">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-private-aggregation">
   <a href="https://github.com/patcg-individual-drafts/private-aggregation-api/blob/main/README.md#private-aggregation">https://github.com/patcg-individual-drafts/private-aggregation-api/blob/main/README.md#private-aggregation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-private-aggregation">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-private-aggregation①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-url">
   <a href="https://url.spec.whatwg.org/#url">https://url.spec.whatwg.org/#url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-url">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-url①">(2)</a>
    <li><a href="#ref-for-url②">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMException">https://webidl.spec.whatwg.org/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-idl-DOMException①">(2)</a> <a href="#ref-for-idl-DOMException②">(3)</a> <a href="#ref-for-idl-DOMException③">(4)</a> <a href="#ref-for-idl-DOMException④">(5)</a> <a href="#ref-for-idl-DOMException⑤">(6)</a>
    <li><a href="#ref-for-idl-DOMException⑥">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-idl-DOMException⑦">(2)</a> <a href="#ref-for-idl-DOMException⑧">(3)</a> <a href="#ref-for-idl-DOMException⑨">(4)</a> <a href="#ref-for-idl-DOMException①⓪">(5)</a> <a href="#ref-for-idl-DOMException①①">(6)</a>
    <li><a href="#ref-for-idl-DOMException①②">4.2.2. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMString">https://webidl.spec.whatwg.org/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-idl-DOMString①">4. The SharedStorage Interface</a> <a href="#ref-for-idl-DOMString②">(2)</a> <a href="#ref-for-idl-DOMString③">(3)</a> <a href="#ref-for-idl-DOMString④">(4)</a> <a href="#ref-for-idl-DOMString⑤">(5)</a>
    <li><a href="#ref-for-idl-DOMString⑥">4.1. The WindowSharedStorage interface</a> <a href="#ref-for-idl-DOMString⑦">(2)</a>
    <li><a href="#ref-for-idl-DOMString⑧">4.2. The WorkletSharedStorage interface</a> <a href="#ref-for-idl-DOMString⑨">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dataerror">
   <a href="https://webidl.spec.whatwg.org/#dataerror">https://webidl.spec.whatwg.org/#dataerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dataerror">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-dataerror①">(2)</a> <a href="#ref-for-dataerror②">(3)</a> <a href="#ref-for-dataerror③">(4)</a> <a href="#ref-for-dataerror④">(5)</a> <a href="#ref-for-dataerror⑤">(6)</a>
    <li><a href="#ref-for-dataerror⑥">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-dataerror⑦">(2)</a> <a href="#ref-for-dataerror⑧">(3)</a> <a href="#ref-for-dataerror⑨">(4)</a> <a href="#ref-for-dataerror①⓪">(5)</a> <a href="#ref-for-dataerror①①">(6)</a>
    <li><a href="#ref-for-dataerror①②">4.2.2. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://webidl.spec.whatwg.org/#Exposed">https://webidl.spec.whatwg.org/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-Exposed①">(2)</a> <a href="#ref-for-Exposed②">(3)</a> <a href="#ref-for-Exposed③">(4)</a> <a href="#ref-for-Exposed④">(5)</a>
    <li><a href="#ref-for-Exposed⑤">4. The SharedStorage Interface</a>
    <li><a href="#ref-for-Exposed⑥">4.1. The WindowSharedStorage interface</a>
    <li><a href="#ref-for-Exposed⑦">4.2. The WorkletSharedStorage interface</a>
    <li><a href="#ref-for-Exposed⑧">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-frozen-array">
   <a href="https://webidl.spec.whatwg.org/#idl-frozen-array">https://webidl.spec.whatwg.org/#idl-frozen-array</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-frozen-array">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-idl-frozen-array①">4.1. The WindowSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Global">
   <a href="https://webidl.spec.whatwg.org/#Global">https://webidl.spec.whatwg.org/#Global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Global">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-promise">
   <a href="https://webidl.spec.whatwg.org/#idl-promise">https://webidl.spec.whatwg.org/#idl-promise</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-promise">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-idl-promise①">(2)</a>
    <li><a href="#ref-for-idl-promise②">4. The SharedStorage Interface</a> <a href="#ref-for-idl-promise③">(2)</a> <a href="#ref-for-idl-promise④">(3)</a> <a href="#ref-for-idl-promise⑤">(4)</a>
    <li><a href="#ref-for-idl-promise⑥">4.1. The WindowSharedStorage interface</a> <a href="#ref-for-idl-promise⑦">(2)</a>
    <li><a href="#ref-for-idl-promise⑧">4.2. The WorkletSharedStorage interface</a> <a href="#ref-for-idl-promise⑨">(2)</a> <a href="#ref-for-idl-promise①⓪">(3)</a>
    <li><a href="#ref-for-idl-promise①①">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror">https://webidl.spec.whatwg.org/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">2.1. Registering a Worklet</a> <a href="#ref-for-exceptiondef-typeerror①">(2)</a> <a href="#ref-for-exceptiondef-typeerror②">(3)</a> <a href="#ref-for-exceptiondef-typeerror③">(4)</a> <a href="#ref-for-exceptiondef-typeerror④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-USVString">
   <a href="https://webidl.spec.whatwg.org/#idl-USVString">https://webidl.spec.whatwg.org/#idl-USVString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-USVString">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-idl-USVString①">4.1. The WindowSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-any">
   <a href="https://webidl.spec.whatwg.org/#idl-any">https://webidl.spec.whatwg.org/#idl-any</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-any">4. The SharedStorage Interface</a> <a href="#ref-for-idl-any①">(2)</a> <a href="#ref-for-idl-any②">(3)</a> <a href="#ref-for-idl-any③">(4)</a>
    <li><a href="#ref-for-idl-any④">4.1. The WindowSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-boolean">
   <a href="https://webidl.spec.whatwg.org/#idl-boolean">https://webidl.spec.whatwg.org/#idl-boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-boolean">4. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-double">
   <a href="https://webidl.spec.whatwg.org/#idl-double">https://webidl.spec.whatwg.org/#idl-double</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-double">4.1.2. Entropy Budget</a>
    <li><a href="#ref-for-idl-double①">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-long">
   <a href="https://webidl.spec.whatwg.org/#idl-long">https://webidl.spec.whatwg.org/#idl-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-long">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-idl-long①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-object">
   <a href="https://webidl.spec.whatwg.org/#idl-object">https://webidl.spec.whatwg.org/#idl-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-object">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-idl-object①">(2)</a> <a href="#ref-for-idl-object②">(3)</a> <a href="#ref-for-idl-object③">(4)</a>
    <li><a href="#ref-for-idl-object④">4.1. The WindowSharedStorage interface</a>
    <li><a href="#ref-for-idl-object⑤">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://webidl.spec.whatwg.org/#idl-undefined">https://webidl.spec.whatwg.org/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-idl-undefined①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-long">
   <a href="https://webidl.spec.whatwg.org/#idl-unsigned-long">https://webidl.spec.whatwg.org/#idl-unsigned-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-long">4.1.3. Run Operation Methods</a>
    <li><a href="#ref-for-idl-unsigned-long①">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-rtcidentityproviderregistrar-register">
   <a href="https://w3c.github.io/webrtc-identity/#dom-rtcidentityproviderregistrar-register">https://w3c.github.io/webrtc-identity/#dom-rtcidentityproviderregistrar-register</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-rtcidentityproviderregistrar-register">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-window">Window</span>
     <li><span class="dfn-paneled" id="term-for-worklet">Worklet</span>
     <li><span class="dfn-paneled" id="term-for-workletglobalscope">WorkletGlobalScope</span>
     <li><span class="dfn-paneled" id="term-for-active-document">active document</span>
     <li><span class="dfn-paneled" id="term-for-active-window">active window</span>
     <li><span class="dfn-paneled" id="term-for-dom-worklet-addmodule">addModule(moduleURL, options)</span>
     <li><span class="dfn-paneled" id="term-for-list-append">append <small>(for list)</small></span>
     <li><span class="dfn-paneled" id="term-for-set-append">append <small>(for set)</small></span>
     <li><span class="dfn-paneled" id="term-for-storage-proxy-map-backing-map">backing map</span>
     <li><span class="dfn-paneled" id="term-for-bits-of-entropy">bits of entropy</span>
     <li><span class="dfn-paneled" id="term-for-bottle-map">bottle map</span>
     <li><span class="dfn-paneled" id="term-for-browsing-context">browsing context</span>
     <li><span class="dfn-paneled" id="term-for-window-bc">browsing context <small>(for Window)</small></span>
     <li><span class="dfn-paneled" id="term-for-bucket-map">bucket map</span>
     <li><span class="dfn-paneled" id="term-for-map-clear">clear</span>
     <li><span class="dfn-paneled" id="term-for-client-side-storage-partitioning">client-side storage partitioning</span>
     <li><span class="dfn-paneled" id="term-for-string-concatenate">concatenate</span>
     <li><span class="dfn-paneled" id="term-for-constructor">constructor</span>
     <li><span class="dfn-paneled" id="term-for-map-exists">contains</span>
     <li><span class="dfn-paneled" id="term-for-dfn-dictionary">dictionary</span>
     <li><span class="dfn-paneled" id="term-for-map-is-empty">empty</span>
     <li><span class="dfn-paneled" id="term-for-enqueue-the-following-steps">enqueue the following steps</span>
     <li><span class="dfn-paneled" id="term-for-entropy-bits">entropy bits</span>
     <li><span class="dfn-paneled" id="term-for-map-entry">entry</span>
     <li><span class="dfn-paneled" id="term-for-environment">environment</span>
     <li><span class="dfn-paneled" id="term-for-environment-settings-object">environment settings object</span>
     <li><span class="dfn-paneled" id="term-for-fencedframeconfig">fencedframeconfig</span>
     <li><span class="dfn-paneled" id="term-for-function-object">function</span>
     <li><span class="dfn-paneled" id="term-for-map-get">get</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-list-item">item</span>
     <li><span class="dfn-paneled" id="term-for-map-key">key</span>
     <li><span class="dfn-paneled" id="term-for-list">list</span>
     <li><span class="dfn-paneled" id="term-for-dom-input-list">list <small>(for HTMLInputElement)</small></span>
     <li><span class="dfn-paneled" id="term-for-ordered-map">map</span>
     <li><span class="dfn-paneled" id="term-for-module-map">module map</span>
     <li><span class="dfn-paneled" id="term-for-module-script">module script</span>
     <li><span class="dfn-paneled" id="term-for-obtain-a-worklet-agent">obtaining a worklet agent</span>
     <li><span class="dfn-paneled" id="term-for-concept-opaque-origin">opaque origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-parallel-enqueue">parallel queue</span>
     <li><span class="dfn-paneled" id="term-for-storage-bottle-proxy-map-reference-set">proxy map reference set</span>
     <li><span class="dfn-paneled" id="term-for-storage-bottle-quota">quota <small>(for storage bottle)</small></span>
     <li><span class="dfn-paneled" id="term-for-storage-endpoint-quota">quota <small>(for storage endpoint)</small></span>
     <li><span class="dfn-paneled" id="term-for-registered-storage-endpoints">register</span>
     <li><span class="dfn-paneled" id="term-for-relevant-settings-object">relevant settings object</span>
     <li><span class="dfn-paneled" id="term-for-map-set">set</span>
     <li><span class="dfn-paneled" id="term-for-map-size">size</span>
     <li><span class="dfn-paneled" id="term-for-storage-bottle">storage bottle</span>
     <li><span class="dfn-paneled" id="term-for-storage-bucket">storage bucket</span>
     <li><span class="dfn-paneled" id="term-for-storage-endpoint">storage endpoint</span>
     <li><span class="dfn-paneled" id="term-for-storage-identifier">storage identifier</span>
     <li><span class="dfn-paneled" id="term-for-storage-key">storage key</span>
     <li><span class="dfn-paneled" id="term-for-model">storage model</span>
     <li><span class="dfn-paneled" id="term-for-storage-proxy-map">storage proxy map</span>
     <li><span class="dfn-paneled" id="term-for-storage-shed">storage shed</span>
     <li><span class="dfn-paneled" id="term-for-storage-shelf">storage shelf</span>
     <li><span class="dfn-paneled" id="term-for-storage-type">storage type</span>
     <li><span class="dfn-paneled" id="term-for-string">string</span>
     <li><span class="dfn-paneled" id="term-for-struct">struct</span>
     <li><span class="dfn-paneled" id="term-for-concept-environment-target-browsing-context">target browsing context</span>
     <li><span class="dfn-paneled" id="term-for-upon-fulfillment">upon fulfillment</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-parser">url parser</span>
     <li><span class="dfn-paneled" id="term-for-urnuuid">urn:uuid</span>
     <li><span class="dfn-paneled" id="term-for-user-agent">user agent</span>
     <li><span class="dfn-paneled" id="term-for-worklet-global-scope-type">worklet global scope type</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-map-getting-the-keys">getting the keys</span>
     <li><span class="dfn-paneled" id="term-for-map-getting-the-values">getting the values</span>
     <li><span class="dfn-paneled" id="term-for-map-remove">remove</span>
     <li><span class="dfn-paneled" id="term-for-list-size">size</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MD]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-opaque-url">opaque url</span>
     <li><span class="dfn-paneled" id="term-for-private-aggregation">private aggregation</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-url">URL</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-dataerror">DataError</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-idl-frozen-array">FrozenArray</span>
     <li><span class="dfn-paneled" id="term-for-Global">Global</span>
     <li><span class="dfn-paneled" id="term-for-idl-promise">Promise</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-idl-USVString">USVString</span>
     <li><span class="dfn-paneled" id="term-for-idl-any">any</span>
     <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-idl-double">double</span>
     <li><span class="dfn-paneled" id="term-for-idl-long">long</span>
     <li><span class="dfn-paneled" id="term-for-idl-object">object</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-long">unsigned long</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBRTC-IDENTITY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-rtcidentityproviderregistrar-register">register()</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
   <dt id="biblio-webrtc-identity">[WEBRTC-IDENTITY]
   <dd>Cullen Jennings; Martin Thomson. <a href="https://w3c.github.io/webrtc-identity/"><cite>Identity for WebRTC 1.0</cite></a>. URL: <a href="https://w3c.github.io/webrtc-identity/">https://w3c.github.io/webrtc-identity/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->)]
<c- b>interface</c-> <a href="#sharedstorageworklet"><code><c- g>SharedStorageWorklet</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#worklet"><c- n>Worklet</c-></a> {
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Global"><c- g>Global</c-></a>=<a data-link-type="idl-name" href="#sharedstorageworklet"><c- n>SharedStorageWorklet</c-></a>]
<c- b>interface</c-> <a href="#sharedstorageworkletglobalscope"><code><c- g>SharedStorageWorkletGlobalScope</c-></code></a> : <a data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/worklets.html#workletglobalscope"><c- n>WorkletGlobalScope</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-sharedstorageworkletglobalscope-register"><c- g>register</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorageworkletglobalscope-register-name-operationctor-name"><code><c- g>name</c-></code></a>,
                     <a data-link-type="idl-name" href="#callbackdef-sharedstorageoperationconstructor"><c- n>SharedStorageOperationConstructor</c-></a> <a href="#dom-sharedstorageworkletglobalscope-register-name-operationctor-operationctor"><code><c- g>operationCtor</c-></code></a>);
};

<c- b>callback</c-> <a href="#callbackdef-sharedstorageoperationconstructor"><code><c- g>SharedStorageOperationConstructor</c-></code></a> = <a data-link-type="idl-name" href="#sharedstorageoperation"><c- n>SharedStorageOperation</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-sharedstorageoperationconstructor-options"><code><c- g>options</c-></code></a>);

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <a href="#sharedstorageoperation"><code><c- g>SharedStorageOperation</c-></code></a> {
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <a href="#sharedstoragerunoperation"><code><c- g>SharedStorageRunOperation</c-></code></a> : <a data-link-type="idl-name" href="#sharedstorageoperation"><c- n>SharedStorageOperation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a>> <a href="#dom-sharedstoragerunoperation-run"><code><c- g>run</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-sharedstoragerunoperation-run-data-data"><code><c- g>data</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>SharedStorageWorklet</c->]
<c- b>interface</c-> <a href="#sharedstorageselecturloperation"><code><c- g>SharedStorageSelectURLOperation</c-></code></a> : <a data-link-type="idl-name" href="#sharedstorageoperation"><c- n>SharedStorageOperation</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-long"><c- b>long</c-></a>> <a href="#dom-sharedstorageselecturloperation-run"><code><c- g>run</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-sharedstorageselecturloperation-run-data-urls-data"><code><c- g>data</c-></code></a>,
                    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-sharedstorageurlwithmetadata"><c- n>SharedStorageUrlWithMetadata</c-></a>> <a href="#dom-sharedstorageselecturloperation-run-data-urls-urls"><code><c- g>urls</c-></code></a>);
};

<c- b>dictionary</c-> <a href="#dictdef-sharedstorageurlwithmetadata"><code><c- g>SharedStorageUrlWithMetadata</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a data-type="USVString " href="#dom-sharedstorageurlwithmetadata-url"><code><c- g>url</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a data-type="object " href="#dom-sharedstorageurlwithmetadata-reportingmetadata"><code><c- g>reportingMetadata</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <a href="#sharedstorage"><code><c- g>SharedStorage</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a href="#dom-sharedstorage-set"><code><c- g>set</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-set-key-value-options-key"><code><c- g>key</c-></code></a>,
                   <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-set-key-value-options-value"><code><c- g>value</c-></code></a>,
                   <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragesetmethodoptions"><c- n>SharedStorageSetMethodOptions</c-></a> <a href="#dom-sharedstorage-set-key-value-options-options"><code><c- g>options</c-></code></a> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a href="#dom-sharedstorage-append"><code><c- g>append</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-append-key-value-key"><code><c- g>key</c-></code></a>,
                      <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-append-key-value-value"><code><c- g>value</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a href="#dom-sharedstorage-delete"><code><c- g>delete</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-sharedstorage-delete-key-key"><code><c- g>key</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a href="#dom-sharedstorage-clear"><code><c- g>clear</c-></code></a>();
};

<c- b>dictionary</c-> <a href="#dictdef-sharedstoragesetmethodoptions"><code><c- g>SharedStorageSetMethodOptions</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a data-type="boolean " href="#dom-sharedstoragesetmethodoptions-ignoreifpresent"><code><c- g>ignoreIfPresent</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->)]
<c- b>interface</c-> <a href="#windowsharedstorage"><code><c- g>WindowSharedStorage</c-></code></a> : <a data-link-type="idl-name" href="#sharedstorage"><c- n>SharedStorage</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-any"><c- b>any</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-windowsharedstorage-run"><c- g>run</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-windowsharedstorage-run-name-options-name"><code><c- g>name</c-></code></a>,
                   <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragerunoperationmethodoptions"><c- n>SharedStorageRunOperationMethodOptions</c-></a> <a href="#dom-windowsharedstorage-run-name-options-options"><code><c- g>options</c-></code></a> = {});

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-windowsharedstorage-selecturl"><c- g>selectURL</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-windowsharedstorage-selecturl-name-urls-options-name"><code><c- g>name</c-></code></a>,
                               <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-frozen-array"><c- b>FrozenArray</c-></a>&lt;<a data-link-type="idl-name" href="#dictdef-sharedstorageurlwithmetadata"><c- n>SharedStorageUrlWithMetadata</c-></a>> <a href="#dom-windowsharedstorage-selecturl-name-urls-options-urls"><code><c- g>urls</c-></code></a>,
                               <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-sharedstoragerunoperationmethodoptions"><c- n>SharedStorageRunOperationMethodOptions</c-></a> <a href="#dom-windowsharedstorage-selecturl-name-urls-options-options"><code><c- g>options</c-></code></a> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#sharedstorageworklet"><c- n>SharedStorageWorklet</c-></a> <a data-readonly data-type="SharedStorageWorklet" href="#dom-windowsharedstorage-worklet"><code><c- g>worklet</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-sharedstoragerunoperationmethodoptions"><code><c- g>SharedStorageRunOperationMethodOptions</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a data-type="object " href="#dom-sharedstoragerunoperationmethodoptions-data"><code><c- g>data</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <a href="#workletsharedstorage"><code><c- g>WorkletSharedStorage</c-></code></a> : <a data-link-type="idl-name" href="#sharedstorage"><c- n>SharedStorage</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-get"><c- g>get</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-workletsharedstorage-get-key-key"><code><c- g>key</c-></code></a>);

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-length"><c- g>length</c-></a>();

  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-double"><c- b>double</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-remainingbudget"><c- g>remainingBudget</c-></a>();

  <a data-link-type="idl-name" href="#sharedstorageiterator"><c- n>SharedStorageIterator</c-></a> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-keys"><c- g>keys</c-></a>();

  <a data-link-type="idl-name" href="#sharedstorageiterator"><c- n>SharedStorageIterator</c-></a> <a class="idl-code" data-link-type="method" href="#dom-workletsharedstorage-entries"><c- g>entries</c-></a>();
};

<c- b>enum</c-> <a href="#enumdef-iteratormode"><code><c- g>IteratorMode</c-></code></a> { <a href="#dom-iteratormode-key"><code><c- s>"key"</c-></code></a>, <a href="#dom-iteratormode-keyvalue"><code><c- s>"keyValue"</c-></code></a> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>SharedStorageWorklet</c->)]
<c- b>interface</c-> <a href="#sharedstorageiterator"><code><c- g>SharedStorageIterator</c-></code></a> {
  <a href="#dom-sharedstorageiterator-sharedstorageiterator"><code><c- g>constructor</c-></code></a>(<a data-link-type="idl-name" href="#enumdef-iteratormode"><c- n>IteratorMode</c-></a> <a href="#dom-sharedstorageiterator-sharedstorageiterator-mode-mode"><code><c- g>mode</c-></code></a>);
  <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-promise"><c- b>Promise</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a>> <a class="idl-code" data-link-type="method" href="#dom-sharedstorageiterator-next"><c- g>next</c-></a>();
};

</pre>
  <aside class="dfn-panel" data-for="sharedstorageworklet">
   <b><a href="#sharedstorageworklet">#sharedstorageworklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageworklet">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstorageworklet①">(2)</a> <a href="#ref-for-sharedstorageworklet②">(3)</a> <a href="#ref-for-sharedstorageworklet③">(4)</a> <a href="#ref-for-sharedstorageworklet④">(5)</a>
    <li><a href="#ref-for-sharedstorageworklet⑤">4. The SharedStorage Interface</a> <a href="#ref-for-sharedstorageworklet⑥">(2)</a> <a href="#ref-for-sharedstorageworklet⑦">(3)</a> <a href="#ref-for-sharedstorageworklet⑧">(4)</a>
    <li><a href="#ref-for-sharedstorageworklet⑨">4.1. The WindowSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageworkletglobalscope">
   <b><a href="#sharedstorageworkletglobalscope">#sharedstorageworkletglobalscope</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageworkletglobalscope">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstorageworkletglobalscope①">(2)</a> <a href="#ref-for-sharedstorageworkletglobalscope②">(3)</a> <a href="#ref-for-sharedstorageworkletglobalscope③">(4)</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope④">2.1. Registering a Worklet</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope⑤">4.1.3. Run Operation Methods</a> <a href="#ref-for-sharedstorageworkletglobalscope⑥">(2)</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope⑦">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-sharedstorageworkletglobalscope⑧">(2)</a> <a href="#ref-for-sharedstorageworkletglobalscope⑨">(3)</a> <a href="#ref-for-sharedstorageworkletglobalscope①⓪">(4)</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope①①">4.2.2. Getter Methods</a> <a href="#ref-for-sharedstorageworkletglobalscope①②">(2)</a> <a href="#ref-for-sharedstorageworkletglobalscope①③">(3)</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope①④">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="callbackdef-sharedstorageoperationconstructor">
   <b><a href="#callbackdef-sharedstorageoperationconstructor">#callbackdef-sharedstorageoperationconstructor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-callbackdef-sharedstorageoperationconstructor">2. The SharedStorageWorklet Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageoperation">
   <b><a href="#sharedstorageoperation">#sharedstorageoperation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageoperation">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstorageoperation①">(2)</a> <a href="#ref-for-sharedstorageoperation②">(3)</a> <a href="#ref-for-sharedstorageoperation③">(4)</a> <a href="#ref-for-sharedstorageoperation④">(5)</a> <a href="#ref-for-sharedstorageoperation⑤">(6)</a> <a href="#ref-for-sharedstorageoperation⑥">(7)</a>
    <li><a href="#ref-for-sharedstorageoperation⑦">4. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageworkletglobalscope-outside-settings">
   <b><a href="#sharedstorageworkletglobalscope-outside-settings">#sharedstorageworkletglobalscope-outside-settings</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageworkletglobalscope-outside-settings">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-sharedstorageworkletglobalscope-outside-settings①">(2)</a> <a href="#ref-for-sharedstorageworkletglobalscope-outside-settings②">(3)</a> <a href="#ref-for-sharedstorageworkletglobalscope-outside-settings③">(4)</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope-outside-settings④">4.2.2. Getter Methods</a> <a href="#ref-for-sharedstorageworkletglobalscope-outside-settings⑤">(2)</a> <a href="#ref-for-sharedstorageworkletglobalscope-outside-settings⑥">(3)</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope-outside-settings⑦">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageworkletglobalscope-operation-map">
   <b><a href="#sharedstorageworkletglobalscope-operation-map">#sharedstorageworkletglobalscope-operation-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageworkletglobalscope-operation-map">2.1. Registering a Worklet</a>
    <li><a href="#ref-for-sharedstorageworkletglobalscope-operation-map①">4.1.3. Run Operation Methods</a> <a href="#ref-for-sharedstorageworkletglobalscope-operation-map②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstoragerunoperation">
   <b><a href="#sharedstoragerunoperation">#sharedstoragerunoperation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstoragerunoperation">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstoragerunoperation①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageselecturloperation">
   <b><a href="#sharedstorageselecturloperation">#sharedstorageselecturloperation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageselecturloperation">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-sharedstorageselecturloperation①">(2)</a>
    <li><a href="#ref-for-sharedstorageselecturloperation②">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sharedstorageurlwithmetadata">
   <b><a href="#dictdef-sharedstorageurlwithmetadata">#dictdef-sharedstorageurlwithmetadata</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sharedstorageurlwithmetadata">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-dictdef-sharedstorageurlwithmetadata①">(2)</a>
    <li><a href="#ref-for-dictdef-sharedstorageurlwithmetadata②">4.1. The WindowSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorageworkletglobalscope-register">
   <b><a href="#dom-sharedstorageworkletglobalscope-register">#dom-sharedstorageworkletglobalscope-register</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorageworkletglobalscope-register">2. The SharedStorageWorklet Interface</a> <a href="#ref-for-dom-sharedstorageworkletglobalscope-register①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database">
   <b><a href="#shared-storage-database">#shared-storage-database</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database">3. The Shared Storage Database</a> <a href="#ref-for-shared-storage-database①">(2)</a> <a href="#ref-for-shared-storage-database②">(3)</a> <a href="#ref-for-shared-storage-database③">(4)</a>
    <li><a href="#ref-for-shared-storage-database④">4. The SharedStorage Interface</a> <a href="#ref-for-shared-storage-database⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-entry">
   <b><a href="#shared-storage-database-entry">#shared-storage-database-entry</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-entry">3. The Shared Storage Database</a> <a href="#ref-for-shared-storage-database-entry①">(2)</a> <a href="#ref-for-shared-storage-database-entry②">(3)</a> <a href="#ref-for-shared-storage-database-entry③">(4)</a> <a href="#ref-for-shared-storage-database-entry④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="entry-value">
   <b><a href="#entry-value">#entry-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-entry-value">3. The Shared Storage Database</a> <a href="#ref-for-entry-value①">(2)</a> <a href="#ref-for-entry-value②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="entry-key">
   <b><a href="#entry-key">#entry-key</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-entry-key">3. The Shared Storage Database</a> <a href="#ref-for-entry-key①">(2)</a> <a href="#ref-for-entry-key②">(3)</a> <a href="#ref-for-entry-key③">(4)</a> <a href="#ref-for-entry-key④">(5)</a> <a href="#ref-for-entry-key⑤">(6)</a> <a href="#ref-for-entry-key⑥">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-queue">
   <b><a href="#shared-storage-database-queue">#shared-storage-database-queue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-queue">3. The Shared Storage Database</a> <a href="#ref-for-shared-storage-database-queue①">(2)</a> <a href="#ref-for-shared-storage-database-queue②">(3)</a> <a href="#ref-for-shared-storage-database-queue③">(4)</a> <a href="#ref-for-shared-storage-database-queue④">(5)</a> <a href="#ref-for-shared-storage-database-queue⑤">(6)</a> <a href="#ref-for-shared-storage-database-queue⑥">(7)</a>
    <li><a href="#ref-for-shared-storage-database-queue⑦">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-shared-storage-database-queue⑧">(2)</a> <a href="#ref-for-shared-storage-database-queue⑨">(3)</a> <a href="#ref-for-shared-storage-database-queue①⓪">(4)</a>
    <li><a href="#ref-for-shared-storage-database-queue①①">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-shared-storage-database-queue①②">(2)</a> <a href="#ref-for-shared-storage-database-queue①③">(3)</a> <a href="#ref-for-shared-storage-database-queue①④">(4)</a>
    <li><a href="#ref-for-shared-storage-database-queue①⑤">4.2.2. Getter Methods</a> <a href="#ref-for-shared-storage-database-queue①⑥">(2)</a> <a href="#ref-for-shared-storage-database-queue①⑦">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-store-an-entry-in-the-database">
   <b><a href="#shared-storage-database-store-an-entry-in-the-database">#shared-storage-database-store-an-entry-in-the-database</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-store-an-entry-in-the-database">3. The Shared Storage Database</a>
    <li><a href="#ref-for-shared-storage-database-store-an-entry-in-the-database①">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-shared-storage-database-store-an-entry-in-the-database②">(2)</a> <a href="#ref-for-shared-storage-database-store-an-entry-in-the-database③">(3)</a> <a href="#ref-for-shared-storage-database-store-an-entry-in-the-database④">(4)</a>
    <li><a href="#ref-for-shared-storage-database-store-an-entry-in-the-database⑤">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-shared-storage-database-store-an-entry-in-the-database⑥">(2)</a> <a href="#ref-for-shared-storage-database-store-an-entry-in-the-database⑦">(3)</a> <a href="#ref-for-shared-storage-database-store-an-entry-in-the-database⑧">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-retrieve-an-entry-from-the-database">
   <b><a href="#shared-storage-database-retrieve-an-entry-from-the-database">#shared-storage-database-retrieve-an-entry-from-the-database</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-retrieve-an-entry-from-the-database">3. The Shared Storage Database</a>
    <li><a href="#ref-for-shared-storage-database-retrieve-an-entry-from-the-database①">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-shared-storage-database-retrieve-an-entry-from-the-database②">(2)</a>
    <li><a href="#ref-for-shared-storage-database-retrieve-an-entry-from-the-database③">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-shared-storage-database-retrieve-an-entry-from-the-database④">(2)</a>
    <li><a href="#ref-for-shared-storage-database-retrieve-an-entry-from-the-database⑤">4.2.2. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-delete-an-entry-from-the-database">
   <b><a href="#shared-storage-database-delete-an-entry-from-the-database">#shared-storage-database-delete-an-entry-from-the-database</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-delete-an-entry-from-the-database">3. The Shared Storage Database</a>
    <li><a href="#ref-for-shared-storage-database-delete-an-entry-from-the-database①">4.1.1. Window Setter/Deleter Methods</a>
    <li><a href="#ref-for-shared-storage-database-delete-an-entry-from-the-database②">4.2.1. Worklet Setter/Deleter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-clear-all-entries-in-the-database">
   <b><a href="#shared-storage-database-clear-all-entries-in-the-database">#shared-storage-database-clear-all-entries-in-the-database</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-clear-all-entries-in-the-database">3. The Shared Storage Database</a>
    <li><a href="#ref-for-shared-storage-database-clear-all-entries-in-the-database①">4.1.1. Window Setter/Deleter Methods</a>
    <li><a href="#ref-for-shared-storage-database-clear-all-entries-in-the-database②">4.2.1. Worklet Setter/Deleter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-retrieve-all-keys-from-the-database">
   <b><a href="#shared-storage-database-retrieve-all-keys-from-the-database">#shared-storage-database-retrieve-all-keys-from-the-database</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-retrieve-all-keys-from-the-database">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-retrieve-all-entries-from-the-database">
   <b><a href="#shared-storage-database-retrieve-all-entries-from-the-database">#shared-storage-database-retrieve-all-entries-from-the-database</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-retrieve-all-entries-from-the-database">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-database-count-entries-in-the-database">
   <b><a href="#shared-storage-database-count-entries-in-the-database">#shared-storage-database-count-entries-in-the-database</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-database-count-entries-in-the-database">4.2.2. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-shed">
   <b><a href="#shared-storage-shed">#shared-storage-shed</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-shed">3. The Shared Storage Database</a> <a href="#ref-for-shared-storage-shed①">(2)</a>
    <li><a href="#ref-for-shared-storage-shed②">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-shared-storage-shed③">(2)</a> <a href="#ref-for-shared-storage-shed④">(3)</a> <a href="#ref-for-shared-storage-shed⑤">(4)</a> <a href="#ref-for-shared-storage-shed⑥">(5)</a> <a href="#ref-for-shared-storage-shed⑦">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage">
   <b><a href="#shared-storage">#shared-storage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-shared-storage①">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-shared-storage②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-shelf">
   <b><a href="#shared-storage-shelf">#shared-storage-shelf</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-shelf">3. The Shared Storage Database</a>
    <li><a href="#ref-for-shared-storage-shelf①">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="obtain-a-shared-storage-shelf">
   <b><a href="#obtain-a-shared-storage-shelf">#obtain-a-shared-storage-shelf</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-obtain-a-shared-storage-shelf">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-shared-storage-shelf">
   <b><a href="#create-a-shared-storage-shelf">#create-a-shared-storage-shelf</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-shared-storage-shelf">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="shared-storage-bucket">
   <b><a href="#shared-storage-bucket">#shared-storage-bucket</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-shared-storage-bucket">3.1. Monkey Patch for the Storage Model</a> <a href="#ref-for-shared-storage-bucket①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-shared-storage-bucket">
   <b><a href="#create-a-shared-storage-bucket">#create-a-shared-storage-bucket</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-shared-storage-bucket">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="obtain-a-shared-storage-bottle-map">
   <b><a href="#obtain-a-shared-storage-bottle-map">#obtain-a-shared-storage-bottle-map</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-obtain-a-shared-storage-bottle-map">3. The Shared Storage Database</a> <a href="#ref-for-obtain-a-shared-storage-bottle-map①">(2)</a> <a href="#ref-for-obtain-a-shared-storage-bottle-map②">(3)</a> <a href="#ref-for-obtain-a-shared-storage-bottle-map③">(4)</a> <a href="#ref-for-obtain-a-shared-storage-bottle-map④">(5)</a> <a href="#ref-for-obtain-a-shared-storage-bottle-map⑤">(6)</a> <a href="#ref-for-obtain-a-shared-storage-bottle-map⑥">(7)</a>
    <li><a href="#ref-for-obtain-a-shared-storage-bottle-map⑦">3.1. Monkey Patch for the Storage Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorage">
   <b><a href="#sharedstorage">#sharedstorage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorage">4. The SharedStorage Interface</a> <a href="#ref-for-sharedstorage①">(2)</a> <a href="#ref-for-sharedstorage②">(3)</a>
    <li><a href="#ref-for-sharedstorage③">4.1. The WindowSharedStorage interface</a>
    <li><a href="#ref-for-sharedstorage④">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sharedstoragesetmethodoptions">
   <b><a href="#dictdef-sharedstoragesetmethodoptions">#dictdef-sharedstoragesetmethodoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sharedstoragesetmethodoptions">4. The SharedStorage Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="windowsharedstorage">
   <b><a href="#windowsharedstorage">#windowsharedstorage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-windowsharedstorage">4. The SharedStorage Interface</a> <a href="#ref-for-windowsharedstorage①">(2)</a>
    <li><a href="#ref-for-windowsharedstorage②">4.1. The WindowSharedStorage interface</a>
    <li><a href="#ref-for-windowsharedstorage③">4.1.1. Window Setter/Deleter Methods</a> <a href="#ref-for-windowsharedstorage④">(2)</a> <a href="#ref-for-windowsharedstorage⑤">(3)</a> <a href="#ref-for-windowsharedstorage⑥">(4)</a>
    <li><a href="#ref-for-windowsharedstorage⑦">4.1.3. Run Operation Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windowsharedstorage-worklet">
   <b><a href="#dom-windowsharedstorage-worklet">#dom-windowsharedstorage-worklet</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windowsharedstorage-worklet">4. The SharedStorage Interface</a>
    <li><a href="#ref-for-dom-windowsharedstorage-worklet①">4.1.3. Run Operation Methods</a> <a href="#ref-for-dom-windowsharedstorage-worklet②">(2)</a> <a href="#ref-for-dom-windowsharedstorage-worklet③">(3)</a> <a href="#ref-for-dom-windowsharedstorage-worklet④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-sharedstoragerunoperationmethodoptions">
   <b><a href="#dictdef-sharedstoragerunoperationmethodoptions">#dictdef-sharedstoragerunoperationmethodoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-sharedstoragerunoperationmethodoptions">4.1. The WindowSharedStorage interface</a> <a href="#ref-for-dictdef-sharedstoragerunoperationmethodoptions①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="calling-origin">
   <b><a href="#calling-origin">#calling-origin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-calling-origin">4.1.2. Entropy Budget</a> <a href="#ref-for-calling-origin①">(2)</a> <a href="#ref-for-calling-origin②">(3)</a> <a href="#ref-for-calling-origin③">(4)</a> <a href="#ref-for-calling-origin④">(5)</a> <a href="#ref-for-calling-origin⑤">(6)</a> <a href="#ref-for-calling-origin⑥">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="entropy-allowance">
   <b><a href="#entropy-allowance">#entropy-allowance</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-entropy-allowance">4.1.2. Entropy Budget</a> <a href="#ref-for-entropy-allowance①">(2)</a> <a href="#ref-for-entropy-allowance②">(3)</a> <a href="#ref-for-entropy-allowance③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="epoch">
   <b><a href="#epoch">#epoch</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-epoch">4.1.2. Entropy Budget</a> <a href="#ref-for-epoch①">(2)</a> <a href="#ref-for-epoch②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="budget-table">
   <b><a href="#budget-table">#budget-table</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-budget-table">4.1.2. Entropy Budget</a> <a href="#ref-for-budget-table①">(2)</a> <a href="#ref-for-budget-table②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="entropy-ledger">
   <b><a href="#entropy-ledger">#entropy-ledger</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-entropy-ledger">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="bit-debit">
   <b><a href="#bit-debit">#bit-debit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-bit-debit">4.1.2. Entropy Budget</a> <a href="#ref-for-bit-debit①">(2)</a> <a href="#ref-for-bit-debit②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="default-value">
   <b><a href="#default-value">#default-value</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-default-value">4.1.2. Entropy Budget</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="determine-remaining-budget">
   <b><a href="#determine-remaining-budget">#determine-remaining-budget</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-determine-remaining-budget">4.1.2. Entropy Budget</a>
    <li><a href="#ref-for-determine-remaining-budget①">4.1.3. Run Operation Methods</a>
    <li><a href="#ref-for-determine-remaining-budget②">4.2.2. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windowsharedstorage-run">
   <b><a href="#dom-windowsharedstorage-run">#dom-windowsharedstorage-run</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windowsharedstorage-run">4.1. The WindowSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-windowsharedstorage-selecturl">
   <b><a href="#dom-windowsharedstorage-selecturl">#dom-windowsharedstorage-selecturl</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-windowsharedstorage-selecturl">2. The SharedStorageWorklet Interface</a>
    <li><a href="#ref-for-dom-windowsharedstorage-selecturl①">4.1. The WindowSharedStorage interface</a>
    <li><a href="#ref-for-dom-windowsharedstorage-selecturl②">4.1.2. Entropy Budget</a> <a href="#ref-for-dom-windowsharedstorage-selecturl③">(2)</a> <a href="#ref-for-dom-windowsharedstorage-selecturl④">(3)</a> <a href="#ref-for-dom-windowsharedstorage-selecturl⑤">(4)</a> <a href="#ref-for-dom-windowsharedstorage-selecturl⑥">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="workletsharedstorage">
   <b><a href="#workletsharedstorage">#workletsharedstorage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-workletsharedstorage">4. The SharedStorage Interface</a> <a href="#ref-for-workletsharedstorage①">(2)</a>
    <li><a href="#ref-for-workletsharedstorage②">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-workletsharedstorage-get">
   <b><a href="#dom-workletsharedstorage-get">#dom-workletsharedstorage-get</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-workletsharedstorage-get">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-workletsharedstorage-length">
   <b><a href="#dom-workletsharedstorage-length">#dom-workletsharedstorage-length</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-workletsharedstorage-length">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-workletsharedstorage-remainingbudget">
   <b><a href="#dom-workletsharedstorage-remainingbudget">#dom-workletsharedstorage-remainingbudget</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-workletsharedstorage-remainingbudget">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-workletsharedstorage-keys">
   <b><a href="#dom-workletsharedstorage-keys">#dom-workletsharedstorage-keys</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-workletsharedstorage-keys">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-workletsharedstorage-entries">
   <b><a href="#dom-workletsharedstorage-entries">#dom-workletsharedstorage-entries</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-workletsharedstorage-entries">4.2. The WorkletSharedStorage interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-iteratormode">
   <b><a href="#enumdef-iteratormode">#enumdef-iteratormode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-iteratormode">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-iteratormode-key">
   <b><a href="#dom-iteratormode-key">#dom-iteratormode-key</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-iteratormode-key">4.2.2. Getter Methods</a>
    <li><a href="#ref-for-dom-iteratormode-key①">4.3. The SharedStorageIterator Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-iteratormode-keyvalue">
   <b><a href="#dom-iteratormode-keyvalue">#dom-iteratormode-keyvalue</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-iteratormode-keyvalue">4.2.2. Getter Methods</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="sharedstorageiterator">
   <b><a href="#sharedstorageiterator">#sharedstorageiterator</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sharedstorageiterator">4.2. The WorkletSharedStorage interface</a> <a href="#ref-for-sharedstorageiterator①">(2)</a>
    <li><a href="#ref-for-sharedstorageiterator②">4.2.1. Worklet Setter/Deleter Methods</a> <a href="#ref-for-sharedstorageiterator③">(2)</a> <a href="#ref-for-sharedstorageiterator④">(3)</a> <a href="#ref-for-sharedstorageiterator⑤">(4)</a>
    <li><a href="#ref-for-sharedstorageiterator⑥">4.2.2. Getter Methods</a> <a href="#ref-for-sharedstorageiterator⑦">(2)</a> <a href="#ref-for-sharedstorageiterator⑧">(3)</a> <a href="#ref-for-sharedstorageiterator⑨">(4)</a> <a href="#ref-for-sharedstorageiterator①⓪">(5)</a>
    <li><a href="#ref-for-sharedstorageiterator①①">4.3. The SharedStorageIterator Interface</a> <a href="#ref-for-sharedstorageiterator①②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-sharedstorageiterator-next">
   <b><a href="#dom-sharedstorageiterator-next">#dom-sharedstorageiterator-next</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-sharedstorageiterator-next">4.3. The SharedStorageIterator Interface</a> <a href="#ref-for-dom-sharedstorageiterator-next①">(2)</a> <a href="#ref-for-dom-sharedstorageiterator-next②">(3)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    "use strict";
    {
        document.addEventListener("click", e=>{
            if(e.target.nodeName == "VAR") {
                highlightSameAlgoVars(e.target);
            }
        });
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>